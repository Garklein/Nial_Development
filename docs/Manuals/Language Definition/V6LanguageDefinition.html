<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>QNial the Language Definition</title>
  <meta name="Author" content="Michael Jenkins">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1404.47">
  <style type="text/css">
    p.p5 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 14.0px; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Courier; color: #000000; -webkit-text-stroke: #000000}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; line-height: 14.0px; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Courier; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    li.li4 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 14.0px; font: 12.0px Times; color: #0000ee; -webkit-text-stroke: #0000ee}
    li.li5 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 14.0px; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
    span.s2 {-webkit-text-stroke: 0px #000000}
    span.s3 {text-decoration: underline ; font-kerning: none}
    span.s4 {font: 10.0px Times; font-kerning: none}
    td.td1 {width: 47.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td2 {width: 61.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td3 {width: 144.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td4 {width: 60.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td5 {width: 37.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td6 {width: 30.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td7 {width: 39.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td8 {width: 81.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td9 {width: 57.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td10 {width: 259.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td11 {width: 267.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td12 {width: 236.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td13 {width: 88.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td14 {width: 74.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td15 {width: 63.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td16 {width: 41.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td17 {width: 49.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td18 {width: 53.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td19 {width: 44.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td20 {width: 82.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td21 {width: 474.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td22 {width: 629.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td23 {width: 160.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td24 {width: 126.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td25 {width: 245.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td26 {width: 313.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td27 {width: 29.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td28 {width: 66.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td29 {width: 65.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td30 {width: 89.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td31 {width: 48.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td32 {width: 80.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td33 {width: 6.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td34 {width: 127.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td35 {width: 27.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td36 {width: 130.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td37 {width: 19.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td38 {width: 136.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td39 {width: 69.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td40 {width: 199.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td41 {width: 303.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td42 {width: 344.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td43 {width: 397.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td44 {width: 289.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td45 {width: 280.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td46 {width: 108.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td47 {width: 205.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td48 {width: 120.0px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    ol.ol1 {list-style-type: decimal}
    ul.ul1 {list-style-type: disc}
    ul.ul2 {list-style-type: circle}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>QNial the Language Definition</b></span></h1>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Michael Jenkins</b></span></h2>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; line-height: 17.0px; font: 14.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>01 August 2015</b></span></h3>
<ul class="ul1">
  <li class="li4"><span class="s2"></span><span class="s3">The Language Definition</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Version 6.3</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 1 Introduction</span></li>
  <li class="li4"><span class="s2"></span><span class="s3">Language Concepts and Terminology</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">The Objects of Nial</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 2 Data Objects</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Atomic Arrays</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Rectangularity Structure</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Nesting Structure</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Empty Arrays</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Array Diagrams</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 3 Predefined Data Operations</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Properties of Data</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Logic Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Arithmetic Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Linear Algebra Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Comparison Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Type Testing Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Set-like Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Conversion Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Structure Testing Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Measurement Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Array Construction Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Reshaping Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Array Generation Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Selection Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Insertion Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Searching Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Nesting Restructuring Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Data Rearrangement Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">String Manipulation Operations using Regular Expressions</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 4 Predefined Transformers</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Each and Related Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Partitioning Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Applicative Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Sorting Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Reduction Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Control Structure Transformers</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Selection Transformer</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 5 The Formal Description of Nial Programs</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Environment</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Action</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Definition</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">External Declaration</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Remark</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Array Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Expression Sequence</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Simple Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Primary Expressions</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Constant</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Variable</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Scope of a Variable</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Indexed Variable</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Named Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Expression List</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Parenthesized Expression Sequence</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Block</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Local and Nonlocal Declaration</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Nested Definition</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Cast</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Assign Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Selection Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Loop Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Comment</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Operation Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Simple Operation</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Operation Form</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Transformer Expression</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Transformer Form</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Summary of Juxtapositional Syntax</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Synonyms</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 6 File Input and Output Operations</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Sequential Files</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Q'Nial Specific Direct Access File Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Direct Access Operations for Host Files</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 7 Operations for the Interpreter Mechanisms</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Top Level Loop</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Picture Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Phrases, Names and Casts</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Dynamic Execution of Name Associations</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 8 Management of the Programming Environment</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">The Q'Nial Programming Environment</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Invoking Q'Nial</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Naming the Latest Result</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Session Related Expressions and Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Restarting a Q'Nial Session</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Ending a Q'Nial Session</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Interrupts and Error Recovery</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Fault Triggering</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Workspace Management</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Saving and Loading the Workspace</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Loading a Definition File</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Setting Workspace Switches</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Workspace Status</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Symbol Table</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Logging the Work of the Session</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Time Related Expressions</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Display Related Settings</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Real Number Formatting</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">System Related Expressions</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Host Interface Operations</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Session and Workspace Variables</span></li>
  </ul>
  <li class="li4"><span class="s2"></span><span class="s3">Chapter 9 Debugging and Profiling Nial Definitions</span></li>
  <ul class="ul2">
    <li class="li4"><span class="s2"></span><span class="s3">Debugging Definitions</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Defining a Break Point</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Access to Intermediate Scopes</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Debugging Commands</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Repeating Debug Commands</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Monitoring Execution Flow</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Watch Mechanism</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Trace Mechanism</span></li>
    <li class="li4"><span class="s2"></span><span class="s3">Profiling Capability</span></li>
  </ul>
</ul>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>The Language Definition</b></span></h1>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Version 6.3</b></span></h2>
<p class="p5"><span class="s1"><b>August 2006</b></span></p>
<p class="p5"><span class="s1"><b>Nial Systems Limited</b></span></p>
<p class="p5"><span class="s1"><b>Preface</b></span></p>
<p class="p5"><span class="s1">The Language Definition manual consists of nine chapters that describe the Nial language at a technical level and provides summary informa tion on the capabilities of the Q'Nial interpreter.</span></p>
<p class="p5"><span class="s1"><i>Chapter 1</i> introduces some of the concepts and terminology of Nial. <i>Chapter 2</i> describes the data objects of the language. <i>Chapters 3 and 4</i> cover the predefined operations and transformers in Nial. <i>Chapter 5</i> gives a formal description of the syntax and semantics of Nial using BNF style syntax descriptions and natural language descriptions of the meaning of the constructs. <i>Chapter 6</i> covers the file input and output operations. <i>Chapter 7</i> describes the operations that provide access to the mechanisms of the Q'Nial interpreter. <i>Chapter 8</i> introduces the Q'Nial environment. <i>Chapter 9</i> describes the debugging and profiling capabilities of the Q'Nial interpreter.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 1 Introduction</b></span></h1>
<p class="p5"><span class="s1"><b>Nial</b> is an acronym for the <b>N</b>ested <b>I</b>nteractive <b>A</b>rray <b>L</b>anguage. Nial is a <i>language</i> intended for users of computers who wish to describe a computational procedure (often called an algorithm) to solve a particular problem or process data in a desired way. The word <i>interactive</i> refers to the idea of having a conversation of sorts with the computer. In essence, the program mer types a fragment of a program into the computer and the computer replies immediately indicating the result of processing that part of the program. The word <i>array</i> refers to a data structure which is manipulated by Nial. An array can be a single number or character, a list of numbers, a table of numbers or almost any other structure desired. The word <i>nested</i> refers to the fact that an item of an array can be another array or an operation can contain another operation. The idea is akin to Russian dolls that can be taken apart to reveal a smaller doll inside.</span></p>
<p class="p5"><span class="s1">The Nial language was designed by Mike Jenkins and Trenchard More during a collaborating that began in 1979 and continued for many years. The current version is a refinement developed by NIAL Systems Limited based on its experience with the practical use in many application areas.</span></p>
<p class="p5"><span class="s1"><b>Q'Nial</b> is a computer program initially developed at Queen's University, Kingston that implements the Nial language. It was used to support research in computer science on programming languages, knowledge-based systems and other topics at Queen's and other universities. NIAL Systems Limited has took over responsibility for the development and marketing of Q'Nial and delivered it to customers in many countries. Mike Jenkins continues to use Q'Nial and has made it freely available through the GitHub project QNial7.</span></p>
<p class="p5"><span class="s1">Q'Nial is intended for use as both a rapid prototyping tool for exploring how to design a program to address a particular problem, and as a rapid development tool to build a program for a known task quickly. It implements a very high level language in that many details of programming are done by Q'Nial without explicit specification. A programmer can think about and work on whole data structures rather than just the individual items that make up the structure. By using a prototyping approach, many of the design considerations in a large program can be resolved before a great investment in programming occurs. As well, users can work with a prototype version of the ultimate system, using a working model that has the screens and some of the functionality of the final system.</span></p>
<p class="p5"><span class="s1">The emphasis in Nial on powerful data operations that apply to entire data sets means that Nial programs tend to be 1/5 of the size or smaller of an equivalent C or Pascal program. This makes Nial well-suited for rapid development of data intensive programs.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Language Concepts and Terminology</b></span></h1>
<p class="p5"><span class="s1">The programming language Nial and its implementation, Q'Nial, are designed to make the learning of programming concepts easy. In normal use of Q'Nial, a programmer enters a small fragment of a program through the keyboard. Q'Nial interprets the entry and returns the result immediately. This instant response provides feedback on the correctness of the program text. Programs can be entered interactively and a workspace of functional and data objects can be built while exploring how to handle a programming requirement. As well, Q'Nial is designed to support the creation of programs as text stored in one or more text files.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>The Objects of Nial</b></span></h2>
<p class="p5"><span class="s1">The major focus of Nial is on the creation and manipulation of data objects which are organised under a structuring scheme known as <b>nested rectangular arrays</b> (or <b>arrays</b> for short).</span></p>
<p class="p5"><span class="s1">An <b>expression</b> is a construction used to create arrays. Operations and transformers are functional objects used in the construction of expressions.</span></p>
<p class="p5"><span class="s1">When the Q'Nial interpreter evaluates a program fragment that is a Nial expression, it returns an array data structure. Examples of expressions are constants, list constructions, conditional expressions, loops, assignment expressions and operation calls. An expres sion may also be made up of a number of steps which describe an algorithm or procedure for computing an array.</span></p>
<p class="p5"><span class="s1">An <b>operation</b> is a <i>functional</i> object that is given an argument array and returns a result array. An operation is used by <b>applying</b> it to an argument; this process of executing an operation by giving it an argument value is called an <b>operation call</b>.</span></p>
<p class="p5"><span class="s1">An operation can be constructed by defining one or more parameters and giving an algorithm to compute the result in terms of the parameters. There are also program fragments (operation expressions) that construct unnamed operations by composing operations, forming a list of operations, or modifying an operation by use of a transformer.</span></p>
<p class="p5"><span class="s1">A <b>transformer</b> is a <i>functional</i> object that is used to construct a new operation from a given operation argument, producing a modified version of the given operation. Most transformers used in Nial are provided in the core language. However, there is a mechanism to construct a new transformer in terms of one or more operation parameters. A user-defined transformer describes the modified operation as a parameterized algorithm (a <b>schema</b>) for manipulating data.</span></p>
<p class="p5"><span class="s1">The process of evaluating an operation call of an operation modified by a transformer requires two steps. The modified operation is formed; and then the modified operation is given the array argument which it uses to produce the result.</span></p>
<p class="p5"><span class="s1">The object construction mechanisms are extended by two naming conventions: <b>variable assignment</b> and <b>definition</b>. A variable assignment associates a name with an array value dynamically during execution of expressions. A definition associates a name with a program fragment in a static manner.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 2 Data Objects</b></span></h1>
<p class="p5"><span class="s1">The data objects of Nial are nested rectangular arrays. Atomic data objects such as numbers and characters are included within this description by virtue of an atom being considered as a self-containing array object with no dimensions.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Atomic Arrays</b></span></h2>
<p class="p5"><span class="s1">There are six types of atoms in Nial. They are boolean, integer, real, character, phrase and fault. The first three are <b>numeric</b> types and are used for arithmetic operations. The last three are <b>literal</b> types and are used for symbol manipulation. All six types of atoms are used in comparisons.</span></p>
<p class="p5"><span class="s1">A <b>boolean</b> atom is the result of a comparison of array values; or the result of a test relating to a characteris tic of an array or the content of an array. There are two boolean atoms: <b>true</b> and <b>false</b>, denoted by<b>l</b> and<b>o</b> respectively. When boolean atoms are treated as numbers, <i>true</i> corresponds to one and <i>false</i> to zero.</span></p>
<p class="p5"><span class="s1">An <b>integer</b> atom is a positive or negative whole number representing a quantity of units. A dash symbol (-) immediately preceding the integer denotes a negative integer. No space is permitted between the dash and the number, otherwise the dash is interpre ted as the arithmetical operation of subtraction. Conversely, a space is required when subtraction is intended and the right argument is a number. An integer is represented by an internal form that limits its range of values in the Q'Nial implementation of Nial.</span></p>
<p class="p5"><span class="s1">A <b>real</b> atom is a number which can represent any position on the real line. It may be written with a fractional part and/or with a decimal exponent. It is represented internally by a floating point number.</span></p>
<p class="p5"><span class="s1">A <b>character</b> atom represents a single glyph within the standard character set in use. The notation for a single character in Nial is the grave symbol ( ` ), preceding the character.</span></p>
<p class="p5"><span class="s1">A <b>phrase</b> is an atom of literal information in which a sequence of characters is taken as a unit. Phrases are used in the place of character strings when the internal structure of the string does not need to be manipulated. Constant phrases are denoted in Nial text by placing the double quote symbol ( " ) before the sequence of characters. Phrases may also be constructed by applying the operation <i>phrase</i> to a character string.</span></p>
<p class="p5"><span class="s1">A <b>fault</b> is an atom of literal information similar to a phrase, used to identify data concerning extraordinary or erroneous conditions. Constant faults are denoted in Nial by placing the question mark symbol ( ? ) before the sequence of characters. Faults may also be constructed by applying the operation <i>fault</i> to a character string. By convention, the text of a fault normally begins with a question mark. For example, <i>?A</i> denotes an arithmetic fault and <i>?L</i> denotes a fault in a logic operation. To denote<i>?A</i> in Nial text ??A is typed.</span></p>
<p class="p5"><span class="s1">There are a small number of special fault values <i>?noexpr, ?eof, ?O</i> and <i>?I</i>. These arise in the execution of Nial expressions to indicate that no value is available for the expression. All other faults can be viewed as error conditions. A fault triggering mechanism is available in Q'Nial to detect when faults other than the four special ones are created. The triggering mechanism is on by default but can be turned on or off under program control or at start up.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Rectangularity Structure</b></span></h2>
<p class="p5"><span class="s1">An <b>array</b> is a collection of data objects having its items held at locations in a rectangular structure. The items are viewed as being objects at locations that are positioned relative to a set of directions at right angles to each other. In mathematical terminology, an array is said to have a set of orthogonal axes. The items may be arranged along zero, one, two or more directions. For example, the following array is a 4 by 6 table of numbers. It has 24 items arranged along two directions of length 4 and 6 respectively.</span></p>
<p class="p6"><span class="s1">+---+---+---+---+---+---+</span></p>
<p class="p6"><span class="s1">|499|434|122|770|733|890|</span></p>
<p class="p6"><span class="s1">+---+---+---+---+---+---+</span></p>
<p class="p6"><span class="s1">|660| 32|808| 24|<span class="Apple-converted-space">  </span>5|473|</span></p>
<p class="p6"><span class="s1">+---+---+---+---+---+---+</span></p>
<p class="p6"><span class="s1">|499|434|122|770|733|890|</span></p>
<p class="p6"><span class="s1">+---+---+---+---+---+---+</span></p>
<p class="p6"><span class="s1">|660| 32|808| 24|<span class="Apple-converted-space">  </span>5|473|</span></p>
<p class="p6"><span class="s1">+---+---+---+---+---+---+</span></p>
<p class="p5"><span class="s1">The number of axes of an array is referred to as its dimensionality. The number of axes is the number of dimensions. In mathematical terminology this dimensionality is called the <b>valence</b> of the array. The following terms describe arrays by their valence:</span></p>
<p class="p7"><span class="s1"><b>Valence Table</b></span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p8"><span class="s1"><b>Valence</b></span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p8"><span class="s1"><b>Description</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p8"><span class="s1">single</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p8"><span class="s1">list, vector</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p8"><span class="s1">table, matrix</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p8"><span class="s1">2 or more</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p8"><span class="s1">multivalent</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The concept of a structure with no directions is, at first glance, paradoxical. If a structure has no directions, how can it have a location? However, allowing a structure to have no directions permits atomic data such as an integer or a character to be treated as a data structure in a manner consistent with the treatment of structures having one or more directions.</span></p>
<p class="p5"><span class="s1">The rectangular structure of an array can be des cribed by its length in each direction. The list of these lengths is called the <b>shape</b> of the array. The <i>shape</i> of an array has one item for each direction and hence is of length equal to the dimensionality, or <i>valence</i>, of the array. The <i>shape</i> of an array is itself an array.</span></p>
<p class="p5"><span class="s1">The array displayed above is a table that has, as its shape, the array:</span></p>
<p class="p6"><span class="s1">+-+-+</span></p>
<p class="p6"><span class="s1">|4|6|</span></p>
<p class="p6"><span class="s1">+-+-+</span></p>
<p class="p5"><span class="s1">The shape of an array with no axes, a <b>single</b>, is the predefined empty list <b>Null</b>. All atoms are defined to be singles and hence have <i>Null</i> as their shape.</span></p>
<p class="p5"><span class="s1">The number of items in an array is called the <b>tally</b> of the array. Because an array is rectangular, the tally is the product of the shape. By convention in mathematics, the product of the empty list <i>Null</i> is one; thus, a single always contains exactly one item. An atom is characterized by the fact that it is self-containing, that is, an atom is its own item.</span></p>
<p class="p5"><span class="s1"><b>Lists</b>, arrays with one dimension, are encountered frequently in Nial. The following terminology is used for the most common ones:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1"><b>Number of Items In the List</b></span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1"><b>Description</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1">empty list</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1">solitary</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1">pair</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1">3</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1">triple</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p8"><span class="s1">4</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p8"><span class="s1">quadruple</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The shape of a list is a solitary list holding the length of the list. The notation [A, B,...] is used to denote a list whose items are A, B, ... etc. Thus, the expression [4, 6] is a pair and its shape is the solitary list [2].</span></p>
<p class="p5"><span class="s1">A solitary and a single both have one item. They differ in rectangular structure in the following way:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td5">
        <p class="p9"><span class="s1"><b></b></span><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1"><b>single</b></span></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p8"><span class="s1"><b>solitary</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td5">
        <p class="p8"><span class="s1">valence</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p8"><span class="s1">1</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td5">
        <p class="p8"><span class="s1">shape</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">Null</span></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p8"><span class="s1">[1]</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td5">
        <p class="p8"><span class="s1">tally</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p8"><span class="s1">1</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">Two forms of lists are also classified by their content. A <b>string</b> is a list of characters. A <b>bitstring</b> is a list of booleans.</span></p>
<p class="p5"><span class="s1">A <b>location</b> in an array is described by a list of integers. Each item of the list of integers indicates the position of the location along the corresponding axis. The list of integers is called the <b>address</b> of the location in the array. The counting scheme uses zero origin indexing. Thus, in the table above, the address of 496 is [2,3]. For simplicity, the addresses of a list are integers: 0, 1, etc. For convenience, in situations where an address or a shape of a list is expected, an integer and the solitary holding the integer are treated equivalently. The operation <i>gage</i> is used to convert a solitary list of integers to an integer and returns any other list of integers directly.</span></p>
<p class="p5"><span class="s1">All the addresses of an array can be stored in an array of the same rectangular structure as the array itself. Such an array is called the <b>grid</b> of an array. The grid of a list is a list of integers. The grid of table <i>T</i>above is the following table of pairs of integers.</span></p>
<p class="p6"><span class="s1">+-----+-----+-----+-----+-----+-----+</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">||0|0|||0|1|||0|2|||0|3|||0|4|||0|5||</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">+-----+-----+-----+-----+-----+-----+</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">||1|0|||1|1|||1|2|||1|3|||1|4|||1|5||</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">+-----+-----+-----+-----+-----+-----+</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">||2|0|||2|1|||2|2|||2|3|||2|4|||2|5||</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">+-----+-----+-----+-----+-----+-----+</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">||3|0|||3|1|||3|2|||3|3|||3|4|||3|5||</span></p>
<p class="p6"><span class="s1">|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|+-+-+|</span></p>
<p class="p6"><span class="s1">+-----+-----+-----+-----+-----+-----+</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Nesting Structure</b></span></h2>
<p class="p5"><span class="s1">The arrays of Nial are a <b>recursive data type</b>, that is, the items of an array are also arrays. The above example of the grid of a 4 by 6 table is an example of a nested array. Each of the items is a pair, a list of length two, of integers.</span></p>
<p class="p5"><span class="s1">Since an array has arrays as items, it may contain data at lower levels than the top one. A <b>path</b> is a list of addresses that describes the <b>site</b> of a data object at some depth within the array. For example, the path [[2, 5], 1] is the path to the second item in the pair at address [2, 5] in the grid of <i>T</i> shown above.</span></p>
<p class="p5"><span class="s1">An array is said to be <b>simple</b> if all its items are atomic. The table of numbers, <i>T</i> above is simple but the table of its grid is not.</span></p>
<p class="p5"><span class="s1">A <b>part</b>of an array is a data object that is contained at some level within the array. The atomic parts of an array are called the <b>leaves</b> of the array. The simple parts are called <b>twigs</b>.</span></p>
<p class="p5"><span class="s1">The term <b>level</b> is used informally to describe the relative position of a part within the nesting structure of an array. An item is at the first or top level, an item of an item is at the second level, etc.</span></p>
<p class="p5"><span class="s1">An atom is viewed in two ways. As an indivisible data object it is viewed as having no levels and cannot be broken into subarrays. As an array data structure it is viewed as a single holding itself and therefore has an infinity of levels. This view is necessary for atomic arrays to fit the theory of nested array mathematics.</span></p>
<p class="p5"><span class="s1">The number of levels to reach an atom along each path need not be the same. For example, in the following array, the phrase "hello is at the first level, the integer 23 is at the second level and the character `b is at the third level.</span></p>
<p class="p6"><span class="s1">[ 23 'abc', "hello , tell 2 2 ]</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+------------+-----+-------------+</span></p>
<p class="p6"><span class="s1">|+--+-------+|hello|+-----+-----+|</span></p>
<p class="p6"><span class="s1">||23|+-+-+-+|| <span class="Apple-converted-space">    </span>||+-+-+|+-+-+||</span></p>
<p class="p6"><span class="s1">||<span class="Apple-converted-space">  </span>||a|b|c||| <span class="Apple-converted-space">    </span>|||0|0|||0|1|||</span></p>
<p class="p6"><span class="s1">||<span class="Apple-converted-space">  </span>|+-+-+-+|| <span class="Apple-converted-space">    </span>||+-+-+|+-+-+||</span></p>
<p class="p6"><span class="s1">|+--+-------+| <span class="Apple-converted-space">    </span>|+-----+-----+|</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">            </span>| <span class="Apple-converted-space">    </span>||+-+-+|+-+-+||</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">            </span>| <span class="Apple-converted-space">    </span>|||1|0|||1|1|||</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">            </span>| <span class="Apple-converted-space">    </span>||+-+-+|+-+-+||</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">            </span>| <span class="Apple-converted-space">    </span>|+-----+-----+|</span></p>
<p class="p6"><span class="s1">+------------+-----+-------------+</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Empty Arrays</b></span></h2>
<p class="p5"><span class="s1">An <b>empty</b> array is one that has no items. The most commonly encountered empty array is the empty list; it is the shape of a single. The empty list can be denoted in three ways in Nial: by the predefined symbol <i>Null</i>; by the list constructor notation with no items; and by the string notation with no characters. This is summarized by:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1"><b>Construction</b></span></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p8"><span class="s1"><b>Denotation</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1">Predefined name</span></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p8"><span class="s1">Null</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1">List Constructor</span></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p8"><span class="s1">[ ]</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1">String Notation</span></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p8"><span class="s1">''</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1"><b>Figure 2-6 Ways of Denoting the Empty List</b></span></p>
<p class="p5"><span class="s1">An empty array may have length in some directions. For example, an empty table of shape [2,0] is one with two rows but no columns. Two empty arrays are equal only if their shapes are equal. By definition, an empty array is simple.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Array Diagrams</b></span></h2>
<p class="p5"><span class="s1">The result of a Nial expression is indicated by displaying a <b>picture</b> of the result. An array picture is a table of characters that shows the content and structure of an array. The structure of the array is displayed by laying out pictures of the items in a two-dimensional format with or without a frame. The size of the layout is adjusted to leave room for the size of the pictures of the items, which may themselves be pictures of arbitrary complexity.</span></p>
<p class="p5"><span class="s1">The form of the picture display is controlled by two independent mode switches. The first switch has two settings, <b>diagram</b> and <b>sketch</b>. The picture of an atom shows the atom itself in either sketch or diagram mode. <b>Diagram</b>mode shows the complete nesting structure of an array. It provides a frame around each item. <b>Sketch</b>mode eliminates the frame around the items of a simple array.</span></p>
<p class="p5"><span class="s1">The other switch has two settings, <b>decor</b> and <b>nodecor</b>. When decor is set, characters, phrases and faults are decorated so that the type of data is obvious. Once a mode is set, it remains in use until it is reset.</span></p>
<p class="p5"><span class="s1">The picture of an array of three or more dimensions is displayed by a tabular layout of the pictures of the two-dimensional subarrays along the last two dimensions. An array with three axes is displayed as three tables across the page with space between each table. An array with four axes is displayed as a table of pictures of the two-dimensional subarrays with space between each table. As the dimensionality increases, the process of alternating the direction of display continues with increasing space between the pictures of lower dimensional arrays.</span></p>
<p class="p5"><span class="s1">The sketch displays of an array of integers of shape 2 3 2 3 and of a 2 3 table of 2 3 tables are:</span></p>
<p class="p6"><span class="s1">a := 2 3 2 3 reshape count 36</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">1 <span class="Apple-converted-space">  </span>2<span class="Apple-converted-space">  </span>3<span class="Apple-converted-space">  </span>7<span class="Apple-converted-space">  </span>8<span class="Apple-converted-space">  </span>9 13 14 15</span></p>
<p class="p6"><span class="s1">4 <span class="Apple-converted-space">  </span>5<span class="Apple-converted-space">  </span>6 10 11 12 16 17 18</span></p>
<p class="p6"><span class="s1">19 20 21 25 26 27 31 32 33</span></p>
<p class="p6"><span class="s1">22 23 24 28 29 30 34 35 36</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">2 raise A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+--------+--------+--------+</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">  </span>1 2 3 | <span class="Apple-converted-space">  </span>7 8 9|13 14 15|</span></p>
<p class="p6"><span class="s1">|<span class="Apple-converted-space">  </span>4 5 6 |10 11 12|16 17 18|</span></p>
<p class="p6"><span class="s1">+--------+--------+--------+</span></p>
<p class="p6"><span class="s1">|19 20 21|25 26 27|31 32 33|</span></p>
<p class="p6"><span class="s1">|22 23 24|28 29 30|34 35 36|</span></p>
<p class="p6"><span class="s1">+--------+--------+--------+</span></p>
<p class="p5"><span class="s1">A single has no axes and hence cannot be diagrammed in a conventional way. If a non-atomic array is a single, its picture has the character o in the upper left corner.</span></p>
<p class="p6"><span class="s1">single 1 2 3</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">o-----+</span></p>
<p class="p6"><span class="s1">|1 2 3|</span></p>
<p class="p6"><span class="s1">+-----+</span></p>
<p class="p5"><span class="s1">The diagram of a solitary has the usual corner box character in the upper left corner.</span></p>
<p class="p6"><span class="s1">solitary 1 2 3</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+-----+</span></p>
<p class="p6"><span class="s1">|1 2 3|</span></p>
<p class="p6"><span class="s1">+-----+</span></p>
<p class="p5"><span class="s1">In sketch mode, the display of an empty array is suppressed. In diagram mode, the display of an empty array shows the frame border. For example, the display of an empty list is the left border of the frame diagram for a list.</span></p>
<p class="p6"><span class="s1">set "diagram; Null</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+</span></p>
<p class="p6"><span class="s1">|</span></p>
<p class="p6"><span class="s1">+</span></p>
<p class="p5"><span class="s1">The display of an empty table is the upper left corner of the frame and if the table has a non zero length, the display includes the frame along one side. The array <i>A</i>, defined below, is displayed in the four mode combinations as follows:</span></p>
<p class="p6"><span class="s1">A := 2 3 reshape [5 'PC', "hello, single 2 4, tell 1 2, solitary 'Hi', tell 0 2];</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">set "diagram; set "decor; A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+--------------+---------+-------+</span></p>
<p class="p6"><span class="s1">|+-+---------+|"hello <span class="Apple-converted-space">  </span>|o-----+|</span></p>
<p class="p6"><span class="s1">||5|+---+---+|| <span class="Apple-converted-space">        </span>||+-+-+||</span></p>
<p class="p6"><span class="s1">|| ||`P |`C ||| <span class="Apple-converted-space">        </span>|||2|4|||</span></p>
<p class="p6"><span class="s1">|| |+---+---+|| <span class="Apple-converted-space">        </span>||+-+-+||</span></p>
<p class="p6"><span class="s1">|+-+---------+| <span class="Apple-converted-space">        </span>|+-----+|</span></p>
<p class="p6"><span class="s1">+-------------+---------+-------+ <span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1">|+-----+-----+|+-------+|+-+-+<span class="Apple-converted-space">  </span>|</span></p>
<p class="p6"><span class="s1">||+-+-+|+-+-+|||+--+--+|| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">|||0|0|||0|1|||||`H|`i||| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">||+-+-+|+-+-+|||+--+--+|| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">|+-----+-----+|+-------+| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">+-------------+---------+-------+</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">set"diagram; set "nodecor; A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+-------------+-------+-------+</span></p>
<p class="p6"><span class="s1">|+-+-----+ |hello <span class="Apple-converted-space">    </span>|o-----+|</span></p>
<p class="p6"><span class="s1">||5|+-+-+| |<span class="Apple-converted-space">          </span>||+-+-+||</span></p>
<p class="p6"><span class="s1">|| ||P|C|| |<span class="Apple-converted-space">          </span>|||2|4|||</span></p>
<p class="p6"><span class="s1">|| |+-+-+| |<span class="Apple-converted-space">          </span>||+-+-+||</span></p>
<p class="p6"><span class="s1">|+-+-----+ |<span class="Apple-converted-space">          </span>|+-----+|</span></p>
<p class="p6"><span class="s1">+-------------+-------+-------+</span></p>
<p class="p6"><span class="s1">|+-----+-----+|+-----+|+-+-+<span class="Apple-converted-space">  </span>|</span></p>
<p class="p6"><span class="s1">||+-+-+|+-+-+|||+-+-+|| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">|||0|0|||0|1|||||H|i||| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">||+-+-+|+-+-+|||+-+-+|| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">|+-----+-----+|+-----+| <span class="Apple-converted-space">      </span>|</span></p>
<p class="p6"><span class="s1">+-------------+-------+-------+</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">set "sketch; set "decor; A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+---------+------+-----+</span></p>
<p class="p6"><span class="s1">|+-+----+ |"hello|o---+|</span></p>
<p class="p6"><span class="s1">||5|'PC'| |<span class="Apple-converted-space">      </span>||2 4||</span></p>
<p class="p6"><span class="s1">|+-+----+ |<span class="Apple-converted-space">      </span>|+---+|</span></p>
<p class="p6"><span class="s1">+---------+------+-----+</span></p>
<p class="p6"><span class="s1">|+---+---+|+----+| <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">||0 0|0 1|||'Hi'|| <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">|+---+---+|+----+| <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">+---------+------+-----+</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">set "sketch; set "nodecor; A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+---------+-----+-----+</span></p>
<p class="p6"><span class="s1">|+-+--+ |"hello |o---+|</span></p>
<p class="p6"><span class="s1">||5|PC| | <span class="Apple-converted-space">      </span>||2 4||</span></p>
<p class="p6"><span class="s1">|+-+--+ | <span class="Apple-converted-space">      </span>|+---+|</span></p>
<p class="p6"><span class="s1">+---------+-----+-----+</span></p>
<p class="p6"><span class="s1">|+---+---+|+--+ | <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">||0 0|0 1|||Hi| | <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">|+---+---+|+--+ | <span class="Apple-converted-space">    </span>|</span></p>
<p class="p6"><span class="s1">+---------+-----+-----+</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 3 Predefined Data Operations</b></span></h1>
<p class="p5"><span class="s1">Programming in Nial is mainly done by creating operations that carry out data transformations from some input data to desired output data and then combining these using the expression mechanisms to find the solution to a given problem. The programming task is accomplished by making use of the predefined operations of Nial.</span></p>
<p class="p5"><span class="s1">This chapter gives a brief description of the data operations provided with Q'Nial, grouped by topic area. Detailed descriptions of the operations, organized alphabetically, are given in the <i>Nial Dictionary</i>.</span></p>
<p class="p5"><span class="s1">Most of the predefined operations are directly implemented in the Q'Nial interpreter. However, a few of them are written in Nial itself and are defined in a file that can be modified by a Q'Nial user. The file <i>defs.ndf</i> in the <i>initial</i> directory holds these definitions.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Properties of Data</b></span></h2>
<p class="p5"><span class="s1">A <b>binary operation</b> is one that must have a pair of arrays as its argument. If the argument is not a pair, a fault is returned.</span></p>
<p class="p5"><span class="s1">Some of the operations of Nial that operate on simple arrays are extended to arbitrarily nested arrays by being applied to the atoms at the deepest level. These are called <b>pervasive</b> <b>operations</b>. There are three classes of pervasive operations: unary pervasive, binary pervasive and multi pervasive.</span></p>
<p class="p5"><span class="s1">An example of a <b>unary pervasive</b> operation is <i>abs</i> which returns the absolute value of a numeric atom. When a unary pervasive operation is applied to a non-atomic argument, it returns an array of the same structure as the argument. The atoms of the result are the result of applying the operation to the corresponding atoms of the argument. A unary pervasive operation <i>f</i> applied to a non-atomic array A gives the same result as applying f to each item of A. That is,</span></p>
<p class="p6"><span class="s1">f A = EACH f A</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">abs -3.5 27 -8</span></p>
<p class="p6"><span class="s1">3.5 27 8</span></p>
<p class="p5"><span class="s1">An example of a <b>binary pervasive</b> operation is <i>minus</i>, also denoted by -, which returns the difference of two numbers.</span></p>
<p class="p5"><span class="s1">Consider two nonatomic arrays, <i>A</i> and <i>B</i>, of identical structure. When a binary pervasive operation such as <i>minus</i> is applied to them as in <i>A minus B</i>, the resulting array <i>C</i> has the same structure as <i>A</i> or <i>B</i>. <i>C</i> has atoms that are the result of applying <i>minus</i> to the pairs of atoms in corresponding positions of <i>A</i> and <i>B</i>.</span></p>
<p class="p6"><span class="s1">3 5 7 - 2 8 3</span></p>
<p class="p6"><span class="s1">1 -3 4</span></p>
<p class="p5"><span class="s1">A binary pervasive operation <i>f</i> satisfies the equation</span></p>
<p class="p5"><span class="s1">   <i>A f B = A EACHBOTH f B</i></span></p>
<p class="p5"><span class="s1">A unary operation which reduces a simple array to an atom is <b>multi pervasive</b>.</span></p>
<p class="p5"><span class="s1">When a multi pervasive operation, such as <i>sum</i>, is applied to an array <i>A</i> with items all of identical structure, it returns an array of that same structure. The atoms of the result are computed by applying <i>sum</i> to the simple arrays formed by taking the atoms from positions in the corresponding items of the argument.</span></p>
<p class="p5"><span class="s1">Thus, for example, if <i>T</i> is a table, <i>sum rows T</i> returns the column totals for <i>T</i>.</span></p>
<p class="p6"><span class="s1">T := 2 4 reshape count 8</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">1 2 3 4</span></p>
<p class="p6"><span class="s1">5 6 7 8</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">rows T</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+-------+-------+</span></p>
<p class="p6"><span class="s1">|1 2 3 4|5 6 7 8|</span></p>
<p class="p6"><span class="s1">+-------+-------+</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">sum rows T</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">6 8 10 12</span></p>
<p class="p5"><span class="s1">A multi pervasive operation used on a pair behaves in precisely the same manner as a binary pervasive operation.</span></p>
<p class="p5"><span class="s1">A multi pervasive operation <i>f</i> satisfies the equations</span></p>
<p class="p5"><span class="s1">   <i>f A = EACHALL f A</i><br>
   <i>f A = REDUCE f A</i></span></p>
<p class="p5"><span class="s1">In binary pervasive and multi pervasive operations, the items of the argument must all be of the same shape and structure. If they are not, items that have only one item, (eg. atoms, singles and solitaries), are reshaped to the common shape. If all items with more than one item are not the same shape, the fault <i>?conform</i> is returned.</span></p>
<p class="p5"><span class="s1">A <b>predicate</b> is an operation that tests a condition and returns <i>true</i> if the condition holds and <i>false</i> otherwise. A predicate is not pervasive.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Logic Operations</b></span></h2>
<p class="p5"><span class="s1">A <b>logic</b> operation is one that combines arrays of booleans or produces a result of booleans. The predefined logic operations follow:</span></p>
<p class="p8"><span class="s1"><b><i>A = B</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if <i>A</i> and <i>B</i> are the same array value; <i>false</i> otherwise</span></p>
<p class="p8"><span class="s1"><b><i>A ~= B</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if <i>A</i> and <i>B</i> are not the same array value; <i>false</i> otherwise</span></p>
<p class="p8"><span class="s1"><b><i>= A</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if all the items of A are equal; <i>false</i> otherwise,</span></p>
<p class="p8"><span class="s1"><b><i>diverse A</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if no two items of <i>A</i> are the same array value; <i>false</i> otherwise</span></p>
<p class="p8"><span class="s1"><b><i>and A</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if all the items of <i>A</i> are <i>true</i>; <i>false</i> otherwise</span></p>
<p class="p8"><span class="s1"><b><i>or A</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if at least one item of <i>A</i> is <i>true</i>; <i>false</i> otherwise</span></p>
<p class="p8"><span class="s1"><b><i>not A</i></b></span></p>
<p class="p5"><span class="s1">the opposite boolean from <i>A</i></span></p>
<p class="p5"><span class="s1">The operations <i>equal</i> and <i>unequal</i> are synonyms for <i>=</i> and <i>~=</i> respectively. The infix use of <i>equal</i> is a special case of the prefix use that tests if all the items of an array are the same. The operation <i>diverse</i> is the opposite test. The operations <i>and</i> and <i>or</i> are multi pervasive; <i>not</i> is unary pervasive. They provide the fundamental operations of boolean logic in a very general setting.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Arithmetic Operations</b></span></h2>
<p class="p5"><span class="s1">The <i>arithmetic</i> operations include elementary and modular arithmetic<br>
operations and operations for real number computations in science and engineering.</span></p>
<p class="p5"><span class="s1">Arithmetic formulae may be applied to single numbers or to nested collections of numbers. There is also a random number generation operation. The arithmetic operations are given below by class of pervasiveness:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1"><b>Unary Pervasive</b></span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1"><b>Binary Pervasive</b></span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p8"><span class="s1"><b>Multi Pervasive</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">opposite, sin</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">plus</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p8"><span class="s1">sum +</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">reciprocal, cos</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">minus -</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p8"><span class="s1">product *</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">floor, tan</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">times</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">ceiling, arcsin</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">divide /</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">sqrt, arccos</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">mod</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">abs, arctan</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">quotient</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">exp, sinh</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p8"><span class="s1">power</span></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">ln, cosh</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td10">
        <p class="p8"><span class="s1">log, tanh</span></p>
      </td>
      <td valign="middle" class="td11">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
      <td valign="middle" class="td12">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">All of the above operation names and syonyms represent the corresponding mathematical functions where <i>sqrt</i> is square root, <i>abs</i> is absolute value, <i>exp</i> is exponent, <i>ln</i> is natural logarithm, <i>log</i> is logarithm to the base 10 and <i>mod</i> is modulus.</span></p>
<p class="p5"><span class="s1">The standard programming symbols for arithmetic can be used. The symbol <i>+</i> is a synonym for <i>sum</i>. It can be used both in a prefix way to sum an array of numbers or in an infix way to add two numbers together. Since <i>sum</i> is pervasive, its meaning is extended to do itemwise additions.</span></p>
<p class="p5"><span class="s1">The symbol <i>-</i> must be used with care in Nial. It is a synonym for <i>minus</i> and can form part of a negative number. When used as <i>minus</i> it must be separated from a following number by at least one space to avoid ambiguity.</span></p>
<p class="p5"><span class="s1">The operation <i>opposite</i> reverses the sign of a number.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Linear Algebra Operations</b></span></h2>
<p class="p5"><span class="s1">Q'Nial supports the following linear algebra operations; as well, <i>inv</i> is provided as a synonym for <i>inverse</i> and <i>ip</i> is one for<i>innerproduct</i>:</span></p>
<p class="p8"><span class="s1"><b><i>inverse A</i></b></span></p>
<p class="p5"><span class="s1">The inverse of square matrix <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>innerproduct A B</i></b></span></p>
<p class="p5"><span class="s1">The inner product of A and B.</span></p>
<p class="p8"><span class="s1"><b><i>solve A B</i></b></span></p>
<p class="p5"><span class="s1">The values of <i>X</i> that satisfy the set of linear equations <i>AX=B</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Comparison Operations</b></span></h2>
<p class="p5"><span class="s1">The <b>comparison</b> operations compare numeric or literal atoms according to an implicit ordering. All the comparison operations are pervasive. They are given below by class of pervasiveness:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td13">
        <p class="p8"><span class="s1"><b>Binary Pervasive</b></span></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1"><b>Multi Pervasive</b></span></p>
      </td>
      <td valign="middle" class="td14">
        <p class="p8"><span class="s1"><b>Non Pervasive</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td13">
        <p class="p8"><span class="s1">&lt; &lt;=</span></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1">max</span></p>
      </td>
      <td valign="middle" class="td14">
        <p class="p8"><span class="s1">up</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td13">
        <p class="p8"><span class="s1">&gt; &gt;=</span></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p8"><span class="s1">min</span></p>
      </td>
      <td valign="middle" class="td14">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td13">
        <p class="p8"><span class="s1">match</span></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
      <td valign="middle" class="td14">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td13">
        <p class="p8"><span class="s1">mate</span></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
      <td valign="middle" class="td14">
        <p class="p9"><span class="s1"></span><br></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The operations <i>gt</i>, <i>lt</i>, <i>gte</i> and <i>lte</i> are synonyms for <i>&gt;</i>, <i>&lt;</i>, <i>&gt;=</i> and <i>&lt;=</i>, respectively.</span></p>
<p class="p5"><span class="s1">The comparison operations are defined for all atomic types. For numeric types, the comparison reflects the usual ordering of the numbers. For characters and phrases, the comparison is made by using a predefined collating sequence. For phrases and faults, the comparison is judged on the first character that differs.</span></p>
<p class="p5"><span class="s1">Comparisons between numeric types and nonnumeric types are defined to be <i>false</i>, as are comparisons between phrases and single characters.</span></p>
<p class="p5"><span class="s1">The operations <i>&lt;, &lt;=, &gt;, &gt;=,</i> and <i>mate</i> convert numeric arguments to be the same type before doing the comparison. The operation <i>match</i> does an equal comparison of atoms without conversion whereas <i>mate</i> does an equal comparison with conversion.</span></p>
<p class="p5"><span class="s1">The operations <i>max</i> and <i>min</i> find the upper and lower bounds of the items of the argument, respectively. Special faults are returned to indicate the top (<i>?I</i>) and bottom (<i>?O</i>) of the pre-lattice of atomic objects if there are no items or if the items are incomparable.</span></p>
<p class="p5"><span class="s1">The operation <i>up</i> defines a total ordering on the arrays of Nial. It compares valence, then length of axes in order, and then items. Atomic items are compared by type, and if of equal type by <i>lte</i>. Non-atomic items are compared by applying <i>up</i> recursively.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Type Testing Operations</b></span></h2>
<p class="p5"><span class="s1">The operation <i>type</i> is unary pervasive and returns a representative atom corresponding to its argument type as defined by the following table.</span></p>
<p class="p5"><span class="s1"><b>Representative</b></span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1"><b>Atomic type</b></span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1"><b>Atom</b></span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1"><b>Predicate</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">boolean</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">o</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">isboolean</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">integer</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">isinteger</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">real number</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">0.</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">isreal</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">character</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">&lt;blank&gt;</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">ischar</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">phrase</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">""</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">isphrase</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td15">
        <p class="p8"><span class="s1">fault</span></p>
      </td>
      <td valign="middle" class="td16">
        <p class="p8"><span class="s1">??</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">isfault</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The operation <i>type</i> can be used to test whether an atom is of a particular type. For convenience a predicate is provided for testing each atomic type directly. For convenience, there is an additional predicate operation, <i>isstring</i> to test whether or not an array is a string.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Set-like Operations</b></span></h2>
<p class="p5"><span class="s1">There are two set-like operations defined in <i>defs.ndf</i>.</span></p>
<p class="p8"><span class="s1"><b><i>allin A B</i></b></span></p>
<p class="p5"><span class="s1">Tests whether or not all items of <i>A</i> are in <i>B</i>.</span></p>
<p class="p8"><span class="s1"><b><i>like A B</i></b></span></p>
<p class="p5"><span class="s1">Tests whether or not all items of <i>A</i> are in <i>B</i> and vice versa.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Conversion Operations</b></span></h2>
<p class="p5"><span class="s1">A common requirement in programming is to convert data from one representation to another. For example, numbers are read from a file in literal form as a string but are required in numeric form for arithmetic calculations. Alternately, numbers are converted to a string representation before they are written to a file.</span></p>
<p class="p5"><span class="s1">The <b>conversion</b> operations return a result of the type specified by the operation name.</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1"><b>Operation</b></span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1"><b>From</b></span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1"><b>To</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">atom</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">string</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">phrase</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">phrase</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">fault</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">fault</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">quiet_fault</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">fault</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">char</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">integer</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">character</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">charrep</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">character</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">integer</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">tonumber</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">number</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">tolower</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">lower case string</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">toupper</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">string</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">upper case string</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">toraw</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">simple</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">bitstring</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">fromraw</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">bitstring</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">simple</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td18">
        <p class="p8"><span class="s1">gage</span></p>
      </td>
      <td valign="middle" class="td19">
        <p class="p8"><span class="s1">array</span></p>
      </td>
      <td valign="middle" class="td20">
        <p class="p8"><span class="s1">simple integers</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">Operations <i>toupper</i> and <i>tolower</i> take an atomic character or a string argument and return one in which the letters have been changed to upper or lower case respectively. The operations <i>char</i> and <i>charrep</i> are unary pervasive. The operations <i>toraw</i> and <i>fromraw</i> are used to convert simple arrays of characters or numbers into bitstrings in order to do low level bit manipulation. The operation <i>gage</i> is used to remove unnecessary structure from an array representing a shape or address.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Structure Testing Operations</b></span></h2>
<p class="p5"><span class="s1">The following table describes operations that test the structure of an array. The test that an array is simple always holds if an array is atomic or if it is empty.</span></p>
<p class="p8"><span class="s1"><b><i>atomic A</i></b></span></p>
<p class="p5"><span class="s1"><i>A</i> is an atom.</span></p>
<p class="p8"><span class="s1"><b><i>simple A</i></b></span></p>
<p class="p5"><span class="s1">All items of <i>A</i> are atoms.</span></p>
<p class="p8"><span class="s1"><b><i>empty A</i></b></span></p>
<p class="p5"><span class="s1"><i>A</i> has no items.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Measurement Operations</b></span></h2>
<p class="p5"><span class="s1">The following table describes operations that measure the structure of an ar ray. They can be used to construct other tests on the structure of an array.</span></p>
<p class="p8"><span class="s1"><b><i>tally A</i></b></span></p>
<p class="p5"><span class="s1">number of items in <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>valence A</i></b></span></p>
<p class="p5"><span class="s1">number of axes that <i>A</i> has</span></p>
<p class="p8"><span class="s1"><b><i>shape A</i></b></span></p>
<p class="p5"><span class="s1">list of the lengths of axes of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>axes A</i></b></span></p>
<p class="p5"><span class="s1">list of the axis numbers for <i>A</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Array Construction Operations</b></span></h2>
<p class="p5"><span class="s1">The following table describes several operations that <b>construct</b> an array from one or more components. These include the unary operations, <i>single</i> and <i>solitary</i>, that add a level and enclose an argument array as an item, the binary operations, <i>pair</i>, <i>hitch</i> and <i>append</i>, that join two arrays into a new structure, and four operations, <i>link</i>, <i>cart</i>, <i>laminate</i>, and <i>catenate</i> that combine an arbitrary number of arrays into a new structure. The operations <i>link</i> and <i>cart</i> are unary, but are often used in infix mode to combine two arrays.</span></p>
<p class="p8"><span class="s1"><b><i>single A</i></b></span></p>
<p class="p5"><span class="s1">single holding <i>A</i> as its item</span></p>
<p class="p8"><span class="s1"><b><i>solitary A</i></b></span></p>
<p class="p5"><span class="s1">solitary holding <i>A</i> as its item</span></p>
<p class="p8"><span class="s1"><b><i>A pair B</i></b></span></p>
<p class="p5"><span class="s1">list of 2 items having items <i>A</i> and <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>A hitch B</i></b></span></p>
<p class="p5"><span class="s1">list having <i>A</i> as the first item and the items of <i>B</i> as the remaining items</span></p>
<p class="p8"><span class="s1"><b><i>A append B</i></b></span></p>
<p class="p5"><span class="s1">list with items of <i>A</i> as the beginning items followed by <i>B</i> as the last item</span></p>
<p class="p8"><span class="s1"><b><i>link A</i></b></span></p>
<p class="p5"><span class="s1">list with items of items of <i>A</i> in orde</span></p>
<p class="p8"><span class="s1"><b><i>cart A</i></b></span></p>
<p class="p5"><span class="s1">array of all arrays of the same shape as <i>A</i> taking one item from each of the items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>I laminate A</i></b></span></p>
<p class="p5"><span class="s1">merged items of <i>A</i> along a new axis before axis <i>I</i> of the items</span></p>
<p class="p8"><span class="s1"><b><i>I catenate A</i></b></span></p>
<p class="p5"><span class="s1">items of <i>A</i> joined along axis <i>I</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Reshaping Operations</b></span></h2>
<p class="p5"><span class="s1">The following table describes the operations that preserve the level structure and ordering of items of an array, but possibly alter the shape. The operation <i>reshape</i> is used both for providing shape and for replicating items if there are not enough to fill out the desired shape. The operation <i>pass</i> serves as the identity operation on arrays and is provided for mathematical completeness.</span></p>
<p class="p8"><span class="s1"><b><i>A reshape B</i></b></span></p>
<p class="p5"><span class="s1">array having shape <i>A</i> and items taken from <i>B</i> cyclically</span></p>
<p class="p8"><span class="s1"><b><i>list A</i></b></span></p>
<p class="p5"><span class="s1">list of items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>pass A</i></b></span></p>
<p class="p5"><span class="s1"><i>A</i>, unchanged</span></p>
<p class="p8"><span class="s1"><b><i>post A</i></b></span></p>
<p class="p5"><span class="s1">table with tally <i>A</i> rows and one column holding the items of <i>A</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Array Generation Operations</b></span></h2>
<p class="p5"><span class="s1">The operations that are used to generate arrays are described in next.</span></p>
<p class="p8"><span class="s1"><b><i>tell A</i></b></span></p>
<p class="p5"><span class="s1">array of addresses for an array of shape <i>A</i> in 0 origin</span></p>
<p class="p8"><span class="s1"><b><i>count A</i></b></span></p>
<p class="p5"><span class="s1">array of shape <i>A</i> equal to <i>1 + tell A</i></span></p>
<p class="p8"><span class="s1"><b><i>grid A</i></b></span></p>
<p class="p5"><span class="s1">array with the same shape as <i>A</i> holding the addresses of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>random S</i></b></span></p>
<p class="p5"><span class="s1">An array of uniformly distributed random real numbers between 0.0 and 1.0 of shape <i>S</i>. The value returned depends on the current value of the internal seed.</span></p>
<p class="p8"><span class="s1"><b><i>seed A</i></b></span></p>
<p class="p5"><span class="s1">Sets the random number seed to <i>A</i>, a real number between 0. and 1.</span></p>
<p class="p5"><span class="s1">The operations <i>tell</i> and <i>grid</i> generate arrays of addresses. The operation random is used to generate pseudo random numbers. A seed number is initialized when a Nial session is started and subsequent numbers are generated using a linear congruential method. The operation <i>seed</i> can be used to reset the generator.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Selection Operations</b></span></h2>
<p class="p5"><span class="s1">Many of the operations involve the <b>selection</b> of an array from a given array according to some control argument. The selected array may be an item, an array of items of the given array or an array deep in the nesting structure of the array. The selection operations are described below.</span></p>
<p class="p5"><span class="s1">The operations <i>take</i> and <i>drop</i> use a negative value to indicate that the right end or bottom parts of the array are to be taken or dropped. Earlier versions had operations <i>takeright</i> and <i>dropright</i> that defined in <i>defs.ndf</i> for compatibility.</span></p>
<p class="p8"><span class="s1"><b><i>first A</i></b></span></p>
<p class="p5"><span class="s1">first item of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>second A</i></b></span></p>
<p class="p5"><span class="s1">second item of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>third A</i></b></span></p>
<p class="p5"><span class="s1">third item of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>last A</i></b></span></p>
<p class="p5"><span class="s1">last item of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A pick B</i></b></span></p>
<p class="p5"><span class="s1">item of <i>B</i> at address <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A choose B</i></b></span></p>
<p class="p5"><span class="s1">array of the same shape as <i>A</i> with items selected from <i>B</i> according to addresses <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A reach B</i></b></span></p>
<p class="p5"><span class="s1">part of <i>B</i> that is reached by succes sive <i>pick</i> operations using the items of path <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A take B</i></b></span></p>
<p class="p5"><span class="s1">corner of <i>B</i> with shape <i>abs A</i> chosen by signs of items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A drop B</i></b></span></p>
<p class="p5"><span class="s1">corner of <i>B</i> left after dropping extents of length <i>abs A</i> from the ends speci fied by the signs of items of A</span></p>
<p class="p8"><span class="s1"><b><i>A sublist B</i></b></span></p>
<p class="p5"><span class="s1">list of items of <i>B</i> selected according to the boolean pattern <i>A</i>, where <i>true</i> indicates selection</span></p>
<p class="p8"><span class="s1"><b><i>A except B</i></b></span></p>
<p class="p5"><span class="s1">list of items of <i>A</i> not in <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>front A</i></b></span></p>
<p class="p5"><span class="s1">list of items of <i>A</i> excluding the last</span></p>
<p class="p8"><span class="s1"><b><i>rest A</i></b></span></p>
<p class="p5"><span class="s1">list of items of <i>A</i> excluding the first</span></p>
<p class="p8"><span class="s1"><b><i>cull A</i></b></span></p>
<p class="p5"><span class="s1">list of unique items in <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A cut B</i></b></span></p>
<p class="p5"><span class="s1">list of lists of items of <i>B</i> separated at positionscorresponding to <i>true</i> values in <i>A</i>, eliminating items of <i>B</i> inpositions corresponding to <i>true</i></span></p>
<p class="p8"><span class="s1"><b><i>A cutall B</i></b></span></p>
<p class="p5"><span class="s1">list of lists of items of <i>B</i> separated at positions corresponding to <i>true</i> values in <i>A,</i> with all items of <i>B</i> retained in the result</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Insertion Operations</b></span></h2>
<p class="p5"><span class="s1">The operations <i>pick, choose</i> and <i>reach</i> select an array from a given array using addresses. The corresponding operations that insert items according to addresses are <i>place, placeall</i> and <i>deepplace</i>.</span></p>
<p class="p8"><span class="s1"><b><i>A B place C</i></b></span></p>
<p class="p5"><span class="s1">array that is the same as <i>C</i> except that the item at address <i>B</i> is replaced by <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A B placeall C</i></b></span></p>
<p class="p5"><span class="s1">array that is the same as <i>C</i> except that items at addresses <i>B</i> are repla ced by items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A B deepplace C</i></b></span></p>
<p class="p5"><span class="s1">array the same as <i>C</i> except that the part at path <i>B</i> is replaced by <i>A</i></span></p>
<p class="p5"><span class="s1">The notations described in Chapter 5 provide an alternative way to achieve selection and insertion in arrays.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Searching Operations</b></span></h2>
<p class="p5"><span class="s1">The table below describes operations that locate one array in another. The operation <i>seek</i> combines the work of <i>find</i> and <i>in</i> since both can be done with one search. There are two search algorithms used internally. If <i>B</i> has been sorted with <i>sortup</i>, a binary search is done; otherwise a linear is search is used.</span></p>
<p class="p8"><span class="s1"><b><i>A find B</i></b></span></p>
<p class="p5"><span class="s1">address of the first position in <i>B</i> that holds <i>A</i>; if <i>A</i> is not an item of <i>B</i>, then <i>gage</i> <i>shape B</i></span></p>
<p class="p8"><span class="s1"><b><i>A in B</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if <i>A</i> is an item of <i>B</i>; otherwise<i>false</i></span></p>
<p class="p8"><span class="s1"><b><i>A notin B</i></b></span></p>
<p class="p5"><span class="s1"><i>true</i> if <i>A</i> is not an item of <i>B</i>; otherwise<i>false</i></span></p>
<p class="p8"><span class="s1"><b><i>A seek B</i></b></span></p>
<p class="p5"><span class="s1">pair with first item <i>A in B</i> and second item <i>A find B</i></span></p>
<p class="p8"><span class="s1"><b><i>A findall</i></b></span></p>
<p class="p5"><span class="s1">list of addresses of all positions in <i>B</i> that hold <i>A</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Nesting Restructuring Operations</b></span></h2>
<p class="p5"><span class="s1">The next table describes operations that add or remove levels to an array by splitting or merging arrays along axes. The operations <i>rows</i>, <i>cols</i>, <i>raise</i> and <i>lower</i> are all special cases of <i>split</i>. The operation <i>mix</i> is a special case of <i>blend</i> in which the axes of the items are placed at the end of the axes of the result. The operation <i>content</i> removes all nesting structure from the array, returning the atoms at the leaves as a list.</span></p>
<p class="p8"><span class="s1"><b><i>rows A</i></b></span></p>
<p class="p5"><span class="s1">rows of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>cols A</i></b></span></p>
<p class="p5"><span class="s1">columns of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>mix A</i></b></span></p>
<p class="p5"><span class="s1">array formed by merging the first two levels of <i>A</i>, placing the axes of the top level first</span></p>
<p class="p8"><span class="s1"><b><i>A raise B</i></b></span></p>
<p class="p5"><span class="s1">array containing arrays of items of <i>B</i> partitioned along axes so that the result has the first <i>A</i> axes of <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>A lower B</i></b></span></p>
<p class="p5"><span class="s1">array containing arrays of items of <i>B</i> partitioned along axes so that the items have the last <i>A</i> axes of <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>A split B</i></b></span></p>
<p class="p5"><span class="s1">arrays of items of <i>B</i> where the axes mentioned in <i>A</i> become the axes of the items of the result</span></p>
<p class="p8"><span class="s1"><b><i>A blend B</i></b></span></p>
<p class="p5"><span class="s1">array of valence equal to <i>valence of B</i> plus the <i>valence</i> of an item of <i>B</i> obtained by merging <i>axes</i> of B according to axis numbers in <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>content A</i></b></span></p>
<p class="p5"><span class="s1">A list of atoms of <i>A</i> in depth-first row-major order</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Data Rearrangement Operations</b></span></h2>
<p class="p5"><span class="s1">The table below describes the operations that involve the rearrangement of items within an array. The operations <i>reverse</i> and <i>rotate</i> work on the list of items of the array, leaving the result in an array of the same shape as originally given.</span></p>
<p class="p5"><span class="s1">The operation <i>transpose</i> interchanges items in the array to produce the array with the axes in reverse order. It is a special case of the <i>fuse</i>, which does a reordering and possible fusion of axes according to the axis numbers in its left argument. If the argument is a nested array, items with 2 or more axis numbers indicate that the corresponding diagonal elements along those axes should be selected.</span></p>
<p class="p5"><span class="s1">The operation <i>pack</i> interchanges the top two levels of its argument. Thus, if its is given a pair of triples the result is a triple of pairs.</span></p>
<p class="p8"><span class="s1"><b><i>reverse A</i></b></span></p>
<p class="p5"><span class="s1">array of the same shape as <i>A</i> with the items of <i>A</i> in reverse order</span></p>
<p class="p8"><span class="s1"><b><i>N rotate A</i></b></span></p>
<p class="p5"><span class="s1"><i>A</i> with items rotated <i>N</i> places. If <i>N &gt; 0</i>, the items are rotated to the left; if <i>N &lt; 0</i>, the items are rotated to the right.</span></p>
<p class="p8"><span class="s1"><b><i>transpose A</i></b></span></p>
<p class="p5"><span class="s1">array formed by reversing axes of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A fuse B</i></b></span></p>
<p class="p5"><span class="s1">array formed from <i>B</i> with the axes reordered according to permutation <i>A</i>. Non-atomic items in <i>A</i> specify axes to be merged by diagonalization.</span></p>
<p class="p8"><span class="s1"><b><i>pack A</i></b></span></p>
<p class="p5"><span class="s1">array formed by interchanging the top two levels of <i>A</i> after replicating items with one item to the same shape as the other items</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>String Manipulation Operations using Regular Expressions</b></span></h2>
<p class="p5"><span class="s1">Regular expressions are string patterns commonly used to describe a search in a string for substrings that have some desired property. The first table below describes the notation for regular expressions used by some of the string manipulation operations described in the second table.</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1"><b>Notation</b></span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1"><b>Matching String</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">.</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">any character</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">*</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">the previous character zero or more times</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">+</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">the previous character 1 or more times</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">^</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">when at the beginning of a regular expression, matches the beginning of the string.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">$</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">when at the end of a regular expression, matches the end of the string.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">[xyz]</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">any character in the sequence of characters "xyz" where ?xyz? can be almost any sequence of characters.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">[^xyz]</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">any character NOT in the sequence of characters "xyz".</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">[x-y]</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">any character in the range of x to y.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">|</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">allows the optional match of the regular expression on the left or the right of the "|".</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">()</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">bracketing allows the specification of <i>groups</i>. Anything that is matched between a set of brackets can later be extracted. Also used for bracketing regular expressions to force order of precedence.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">&lt;other char&gt;</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">matches itself</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td21">
        <p class="p8"><span class="s1">\&lt;char&gt;</span></p>
      </td>
      <td valign="middle" class="td22">
        <p class="p8"><span class="s1">matches the character</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p8"><span class="s1"><b><i>regexp R S</i></b></span></p>
<p class="p5"><span class="s1">Applies the regular expression <i>R</i> to string <i>S</i> and returns a list. The first item is a boolean indicating if the search succeeded. The second item is the first substring matched by <i>R</i> and the remaining items, if any, are the substrings that match the subgroups indicated by parentheses in <i>R</i>.</span></p>
<p class="p8"><span class="s1"><b><i>regexp_match R S [O]</i></b></span></p>
<p class="p5"><span class="s1">Applies the regular expression <i>R</i> to string <i>S</i> and returns a boolean indicating if the search succeeded. If <i>O</i> is ?i then the search is case insensitive.</span></p>
<p class="p8"><span class="s1"><b><i>regexp_substitute R S T [O]</i></b></span></p>
<p class="p5"><span class="s1">Applies the regular expression <i>R</i> to string <i>T</i> doing substitutions based on <i>S</i>. Return the modified string if the search matches; otherwise return <i>T</i>. O provides options for case insensitive search (?i) or for doing all substitutions (?g).</span></p>
<p class="p8"><span class="s1"><b><i>string_split C S [N]</i></b></span></p>
<p class="p5"><span class="s1">Splits the string <i>S</i> whenever one of the character in <i>C</i> occurs in <i>S</i>, eliminating the character. <i>N</i> indicates a limit on the number of substrings obtained.</span></p>
<p class="p8"><span class="s1"><b><i>string_translate C D S [O]</i></b></span></p>
<p class="p5"><span class="s1">Translates characters in string <i>S</i> based on mapping characters in <i>C</i> to the corresponding ones in <i>D</i>. Options include (?d) to delete characters and (?c) to complement characters and (??s) to squeeze many occurrences to one.</span></p>
<p class="p5"><span class="s1">The string manipulation operations are based on a package of public domain C++ routines developed by Henry Spencer at the University of Toronto. The regular expressions obey the standard syntax rules for regular expressions used in Perl and Unix software.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 4 Predefined Transformers</b></span></h1>
<p class="p5"><span class="s1">The expressiveness of using operations to achieve a solution to a computational problem is enhanced by the use of transformers or operation modifiers. A <b>transformer</b> maps a predefined or user defined operation to a related operation. It is said to be a <i>second order function</i> because it has an operation (a first order function) as both its argument and its result. This chapter provides brief descriptions of the transformers or operation modifiers that are built into Q'Nial. More complete descriptions of the predefined transformers, along with examples are found in the <i>Nial Dictionary</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Each and Related Transformers</b></span></h2>
<p class="p5"><span class="s1">The most important transformer is <i>EACH</i>. It modifies an operation so that the operation is applied to the items of an array rather than the array itself. The result is an array of the same shape as the array to which the modified operation is applied. There is a family of transformers related to <i>EACH</i> in that they apply the argument operation to arrays formed from parts of the argument. The transformers <i>EACHLEFT</i>, <i>EACHRIGHT</i> and <i>EACHBOTH</i> produce binary operations. They are described in the following table:</span></p>
<p class="p8"><span class="s1"><b><i>EACH f A</i></b></span></p>
<p class="p5"><span class="s1">items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A EACHLEFT f B</i></b></span></p>
<p class="p5"><span class="s1">pairs formed from items of <i>A</i> and array <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>A EACHRIGHT f B</i></b></span></p>
<p class="p5"><span class="s1">pairs formed from array <i>A</i> and items of <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>A EACHBOTH f B</i></b></span></p>
<p class="p5"><span class="s1">pairs formed from items of <i>A</i> paired with corresponding items of <i>B</i></span></p>
<p class="p8"><span class="s1"><b><i>EACHALL f A</i></b></span></p>
<p class="p5"><span class="s1">arrays of the same shape as <i>A</i> formed from corresponding items of items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>TWIG f A</i></b></span></p>
<p class="p5"><span class="s1">deeply nested simple arrays of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>LEAF f A</i></b></span></p>
<p class="p5"><span class="s1">deeply nested atoms of <i>A</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Partitioning Transformers</b></span></h2>
<p class="p5"><span class="s1">The transformers described below apply their argument operation to partitions of an array and then build an array by using the results of the applications as partitions of the result. The transformer <i>RANK</i> is primitive and the others are defined from it in <i>defs.ndf</i>. The last two transformers do a reduction of the given operation to the partitions.</span></p>
<p class="p8"><span class="s1"><b><i>N RANK f A</i></b></span></p>
<p class="p5"><span class="s1">items of <i>N lower A; mix</i></span></p>
<p class="p8"><span class="s1"><b><i>[A,B] PARTITION f C</i></b></span></p>
<p class="p5"><span class="s1">items of <i>A split C</i>; <i>B blend</i></span></p>
<p class="p8"><span class="s1"><b><i>BYROWS f A</i></b></span></p>
<p class="p5"><span class="s1">items of <i>rows</i> <i>A; mix</i></span></p>
<p class="p8"><span class="s1"><b><i>BYCOLS f A</i></b></span></p>
<p class="p5"><span class="s1">items of <i>cols</i> <i>A; 1 blend</i></span></p>
<p class="p8"><span class="s1"><b><i>REDUCEROWS f A</i></b></span></p>
<p class="p5"><span class="s1">reduce <i>items of rows A; mix</i></span></p>
<p class="p8"><span class="s1"><b><i>REDUCECOLS f A</i></b></span></p>
<p class="p5"><span class="s1">reduce <i>items of cols A; 1 blend</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Applicative Transformers</b></span></h2>
<p class="p5"><span class="s1">There are a number of transformers described below that control how an operation or an atlas of operations is applied.</span></p>
<p class="p8"><span class="s1"><b><i>A CONVERSE f B</i></b></span></p>
<p class="p5"><span class="s1">result of <i>B f A</i></span></p>
<p class="p8"><span class="s1"><b><i>N FOLD f A</i></b></span></p>
<p class="p5"><span class="s1">apply <i>f</i> to <i>A</i>; and then to the result, etc. <i>N</i> times</span></p>
<p class="p8"><span class="s1"><b><i>TEAM f A</i></b></span></p>
<p class="p5"><span class="s1">operations in atlas <i>f</i> are applied to items in corresponding positions in <i>A</i>; if <i>f</i> is an operation other than an atlas, it is applied directly to <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>OUTER f A</i></b></span></p>
<p class="p5"><span class="s1">apply<i>f</i> to the items of <i>cart A</i>, the array of all combinations of items of items of <i>A</i></span></p>
<p class="p8"><span class="s1"><b><i>A INNER [f,g] B</i></b></span></p>
<p class="p5"><span class="s1">generalized inner product using a reductive operation <i>f</i> to reduce each list formed from the outer product of the binary pervasive operation g applied to the<br>
rows of <i>A</i> and the columns of <i>B</i></span></p>
<p class="p5"><span class="s1">The transformers <i>OUTER</i> and <i>INNER</i> generalize the outer and inner product concepts from linear algebra. The expression <i>A OUTER * B</i>, where <i>A</i> and <i>B</i> are numeric vectors, produces the matrix formed by multiplying each item of <i>A</i> with each item of <i>B</i>. <i>A INNER [+,*] B</i> does matrix multiplication if <i>A</i> and <i>B</i> are conformable matrices.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Sorting Transformers</b></span></h2>
<p class="p5"><span class="s1">The sorting of data objects depends on a comparison operation that describes the desired ordering relation on the items. The operation <i>up</i> provides a total ordering for the universe of arrays; the operation <i>lte</i> (<i>&lt;=</i>) provides a partial ordering of the universe of atoms.</span></p>
<p class="p5"><span class="s1">The transformer <i>SORT</i> expects as its argument a comparator that will partially or totally order the universe of the items to which the resulting operation will be applied. When the modified operation is applied the result is an array of the same shape as the argument with the items in order according to the comparator.</span></p>
<p class="p5"><span class="s1">The transformer <i>GRADE</i> is similar to <i>SORT</i> except applying the modified operation returns a permutation array which, if used to <i>choose</i> the argument, will result in the sorted array.</span></p>
<p class="p8"><span class="s1"><b><i>SORT f A</i></b></span></p>
<p class="p5"><span class="s1">array of <i>shape A</i> of the items of <i>A</i> sorted according to <i>f</i>. If <i>f</i> is <i>&lt;=</i>, the items are returned in ascending sequence</span></p>
<p class="p8"><span class="s1"><b><i>GRADE f A</i></b></span></p>
<p class="p5"><span class="s1">indices of the items of <i>A</i> in the sequence such that choosing the items according to the sequence of the indices returns the items sorted according to <i>f</i></span></p>
<p class="p5"><span class="s1">The operations <i>sortup</i> and <i>gradeup</i> are defined in <i>defs.ndf</i> as abbreviations for <i>SORT up</i> and <i>GRADE up</i> respectively.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Reduction Transformers</b></span></h2>
<p class="p5"><span class="s1">The reduction of a list by an operation is the same as placing the operation between each pair of items in a list and then evaluating the resulting expression. The transformer <i>REDUCE</i> applied to a binary operation <i>f</i> implements this concept. Thus,</span></p>
<p class="p5"><span class="s1"><i>REDUCE f [A, B, C] = A f (B f C)</i></span></p>
<p class="p5"><span class="s1">where the parentheses indicate that the grouping is to the right. For an associative operation, i.e. an operation <i>f</i> such that</span></p>
<p class="p5"><span class="s1"><i>(A f B) f C = A f (B f C)</i></span></p>
<p class="p5"><span class="s1">the result of applying the operation between items is the same regardless of whether the grouping is to the left or to the right. However, for a non-associative operation, the result varies depending on which way the grouping is done. Thus, <i>REDUCE</i> is a right grouping reduction.</span></p>
<p class="p5"><span class="s1">A related transformer is <i>ACCUMULATE</i>, which forms right grouping reductions of the initial lists of an array. For an associative operation<i>f</i>, the amount of work needed to compute</span></p>
<p class="p5"><span class="s1"><i>ACCUMULATE f [A, B, C]</i></span></p>
<p class="p5"><span class="s1">can be lessened by using the fact that the reductions can be done with left grouping and each item in the result can be formed by one application of <i>f</i> using the preceding reduction value.</span></p>
<p class="p5"><span class="s1">The operations <i>sum, product, and, or, max, min</i> and <i>link</i> are reductive by definition and are not affected by applying a reduction transformer to them. They are all associative operations when applied as a binary operation.</span></p>
<p class="p8"><span class="s1"><b><i>REDUCE f A</i></b></span></p>
<p class="p5"><span class="s1">reduce <i>A</i> applying <i>f</i> in a right-to-left order</span></p>
<p class="p8"><span class="s1"><b><i>ACCUMULATE f A</i></b></span></p>
<p class="p5"><span class="s1">accumulate <i>A</i> using right-to-left reductions</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Control Structure Transformers</b></span></h2>
<p class="p5"><span class="s1">One of the interesting features of Q'Nial is that it allows the user to choose a style of programming appropriate to the problem. For some purposes, an imperative style using the control structure expres sions is appropriate while for other purposes a more functional approach is simpler. Q'Nial integrates these two styles by providing transformers that have the same result as two of the control structure mechan isms. <i>ITERATE</i> is equivalent to the for-loop and <i>FORK</i> is equivalent to the if-expression.</span></p>
<p class="p8"><span class="s1"><b><i>ITERATE f A</i></b></span></p>
<p class="p5"><span class="s1"><i>f</i> is applied to the items of <i>A</i> in row major order and the result of the last application is returned</span></p>
<p class="p8"><span class="s1"><b><i>FORK [f</i></b></span><span class="s4"><b><i><sub>0</sub></i></b></span><span class="s1"><b><i>, f</i></b></span><span class="s4"><b><i><sub>1</sub></i></b></span><span class="s1"><b><i> . . . f</i></b></span><span class="s4"><b><i><sub>n</sub></i></b></span><span class="s1"><b><i>] A</i></b></span></p>
<p class="p5"><span class="s1">For even values of <i>i</i> less than or equal to <i>n</i>, <i>f</i></span><span class="s4"><i><sub>i</sub></i></span><span class="s1"> <i>A</i> is applied sequentially until one of the results is <i>true</i>; then <i>f</i></span><span class="s4"><i><sub>i+1</sub></i></span><span class="s1"> <i>A</i> is returned. If no application of <i>f</i></span><span class="s4"><i><sub>i</sub></i></span><span class="s1"> <i>A</i> evaluates to <i>true</i>, then, if <i>n</i> is even, <i>f</i></span><span class="s4"><i><sub>n</sub></i></span><span class="s1"> <i>A</i> is returned; otherwise the fault <i>?noexpr</i> is returned</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Selection Transformer</b></span></h2>
<p class="p5"><span class="s1">There is one additional built in transformer to select items of an array based on a predicate.</span></p>
<p class="p8"><span class="s1"><b><i>FILTER f A</i></b></span></p>
<p class="p5"><span class="s1"><i>f</i> is applied to the items of <i>A</i> and the resulting boolean array is used to select items of A using sublist</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 5 The Formal Description of Nial Programs</b></span></h1>
<p class="p5"><span class="s1">Nial is a programming language specifically designed for use in an interactive environment. The formal description of the language given in this chapter describes the valid language constructs that can be entered in one interaction, and explains the meaning of one such entry in terms of the environment created by earlier inter actions in the same session. The term <b>program fragment</b> is used to describe a meaningful piece of program text.</span></p>
<p class="p5"><span class="s1">The rules for writing well-formed program fragments in Nial are called the <b>syntax rules</b> of Nial. A program fragment that is well-formed is said to be syntactically correct. The syntax rules are analogous to the rules of grammar that determine the correct ness of English. Nial uses a small number of syntactic constructs that can be grouped into the following classes:</span></p>
<ul class="ul1">
  <li class="li5"><span class="s2"></span><span class="s1">juxtapositional forms<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">list forms<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">control structure expressions<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">parameterized functional forms<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">indexing forms<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">assignments<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">definitions<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">declarations<br>
</span></li>
</ul>
<p class="p5"><span class="s1">These are combined using punctuation symbols and spacing to build program fragments that can be processed by the Q'Nial interpreter. The meaning of a program fragment, its <b>semantics</b>, is explained in terms of three classes of objects:</span></p>
<p class="p5"><span class="s1"><b>arrays</b>: the data objects</span></p>
<p class="p5"><span class="s1"><b>operations</b> : functional objects that map arrays to arrays</span></p>
<p class="p5"><span class="s1"><b>transformers</b> : functional objects that modify operations</span></p>
<p class="p5"><span class="s1">The explanations are given in relationship to the global environment, which is the set of associations between names and objects formed earlier in the session; and in terms of how the objects are combined.</span></p>
<p class="p5"><span class="s1">In the remainder of this chapter, the syntax of Nial is described using an extended Backus-Naur Form (BNF) formalism using the following rules:</span></p>
<ul class="ul1">
  <li class="li5"><span class="s2"></span><span class="s1">Symbols that appear in program fragments are in <b>bold text</b>.<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">A single optional form is enclosed in brackets [ ].<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">A choice between options, where one must be chosen, is written in parentheses ( ) with a vertical bar | separating choices.<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">Alternative rules for a construct are separated by the vertical bar |.<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">Fragments that can be repeated are enclosed in curly braces {}, where {} means repeated zero or more times, and {}+ means repeated one or more times.<br>
In the following sections, the meaning given to a rule is given in a description following the rule.<br>
</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Environment</b></span></h2>
<p class="p5"><span class="s1">Nial program fragments are entered during interactive input with a process called the <b>top level loop</b>; or brought into the system under the control of a systems operation, <i>loaddefs</i>. This operation has the effect of loading a sequence of program fragments from a file. The effect is as if the fragments had been entered interactively in the order they appear in the file.</span></p>
<p class="p5"><span class="s1">The <b>global environment</b> is the collection of associations between names and objects that are known at the top level loop. Such names have <b>global scope</b> in that they can be referenced by any program text. All other names have a <b>local scope</b> that associates a meaning with the name only during execution of a specific portion of a program text.</span></p>
<p class="p5"><span class="s1">A <b>local environment</b> is a collection of associations that are known within a limited section of program text. These limited sections are formed by <i>blocks, operation-forms</i> and <i>transformer-forms</i> as discussed in the relevant sections below. A name that has a local association in one of these forms is said to have local scope.</span></p>
<p class="p5"><span class="s1">Program fragments in which local variables are being assigned can be nested, so that one local scope encloses another. A local association is not visible outside the construct in which it is defined; and a name with local scope hides associations that the name has in surrounding scopes.</span></p>
<p class="p5"><span class="s1">At any point in a program fragment, there is a <b>current environment</b> consisting of all names whose associations are visible. It includes the names having local scope in the program fragment being executed, names that are visible in the surrounding scopes and names that have global scope.</span></p>
<p class="p5"><span class="s1">In any environment, a name can have only one <b>role</b>: either a variable, an expression name, an operation name, a transformer name, or an identifier.</span></p>
<p class="p5"><span class="s1">In program text, the scope of all names is determined by the static structure of the program text. The one exception is program text in a string that has the operation <i>execute</i> applied to it under program control. Dynamic execution of program text is described in Chapter 8.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Action</b></span></h2>
<p class="p5"><span class="s1">An <b>action</b> is the construct that is entered in the interactive loop of the Q'Nial interpreter or accepted as a group of lines by the operation <i>loaddefs</i>:</span></p>
<p class="p5"><span class="s1">   <i>&lt;action&gt;</i> ::= <i>&lt;definition-sequence&gt;</i><br>
            | <i>&lt;expression-sequence&gt;</i><br>
            | <i>&lt;external-declaration&gt;</i><br>
            | <i>&lt;remark&gt;</i></span></p>
<p class="p5"><span class="s1">If an action is a <i>&lt;definition-sequence&gt;</i>, its definitions are installed in the global environment.</span></p>
<p class="p5"><span class="s1">If an action is an <i>&lt;expression-sequence&gt;</i>, it is executed and a value is returned. The value returned by an <i>&lt;expression-sequence&gt;</i> is displayed on the screen unless it is the fault <i>?noexpr</i>.</span></p>
<p class="p5"><span class="s1">An <i>&lt;external-declaration&gt;</i> assigns a role to a name in the global environment so that the name can be used in other definitions before it is completely specified.</span></p>
<p class="p5"><span class="s1">A <i>&lt;remark&gt;</i> is treated as commentary input and is ignored.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Definition</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;definition-sequence&gt;</i> ::= <i>&lt;definition&gt;</i> {<b>;</b> <i>&lt;definition&gt;</i> } [<b>;</b>]</span></p>
<p class="p5"><span class="s1">   <i>&lt;definition&gt;</i> ::= <i>&lt;identifier&gt;</i> <b>IS</b><br>
                    ( <i>&lt;simple-expression&gt;</i> | <i>&lt;operation-expression&gt;</i> | <i>&lt;transformer-expression&gt;</i> )<br>
                   | <i>&lt;comment&gt;</i></span></p>
<p class="p5"><span class="s1">Every well formed program fragment that can appear on the right of the keyword <b>IS</b> in a definition is interpreted to be one of the three kinds of semantic objects in Nial: an array, an operation or a transformer.</span></p>
<p class="p5"><span class="s1">A definition is used to associate a <b>name</b> (<b>identifier</b>) with a program fragment that is an array expression, an operation expression or a transformer expression.</span></p>
<p class="p5"><span class="s1">If the definition appears within a block, the association is made in the local environment. Otherwise, the association is made in the global environment and assigns a role to the name as representing that kind of expression.</span></p>
<p class="p5"><span class="s1">If the program fragment is syntactically correct, the name is associated with the program fragment in the environment and no result is given. If a syntax error is detected in the analysis of the program fragment, an explanatory fault message is returned and the name association is not made.</span></p>
<p class="p5"><span class="s1">If the name being associated in a definition is already in use, the new definition must be for a construct of the same role and the earlier definition is replaced. The use of a defined name always refers to its most recent definition.</span></p>
<p class="p5"><span class="s1">The name is formed according to the rules for specifying an identifier:</span></p>
<p class="p5"><span class="s1">   <i>&lt;identifier&gt;</i> ::= <i>&lt;letter&gt;</i> { ( <i>&lt;letter&gt;</i> | <i>&lt;digit&gt;</i> ) }</span></p>
<p class="p5"><span class="s1">   <i>&lt;letter&gt;</i> ::= <b>&amp;</b> | <b>_</b> | <b>a</b> | <b>b</b> | . . . | <b>Y</b> | <b>Z</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;digit&gt;</i> ::= <b>0</b> | <b>1</b> | <b>2</b> | . . . | <b>9</b></span></p>
<p class="p5"><span class="s1">In Q'Nial, identifiers are limited to 80 character positions in order to facilitate the reconstruction of program text in the canonical form used in <i>see</i> and <i>defedit</i>. They may be entered in upper or lower case. Internally, Q'Nial translates the letters of an identifier to upper case so that Data, data and DATA would all be the same identifier. An identifier displayed in canonical form is presented in upper or lower case appropriate to its role. An expression or a variable is displayed with its first letter in upper case and the rest in lower case. An operation is displayed in lower case. A transformer or a reserved word is displayed in upper case.</span></p>
<p class="p5"><span class="s1">Definitions in which the associated object is a simple-expression are used to name program fragments that return an array value but which do not need parameters. The resulting <i>named-expression</i> behaves like a function having no parameters.</span></p>
<p class="p5"><span class="s1">An operation definition associates a name with an operation expression and results in a <i>named-operation</i>. A transformer definition associates a name with a transformer expression and results in a <i>named-transformer</i>.</span></p>
<p class="p5"><span class="s1">There is no distinction in the way user-defined named objects and predefined objects are used other than the fact that predefined ones cannot be redefined in the global environment.</span></p>
<p class="p5"><span class="s1">If the expression on the right of <b>IS</b> uses the name being defined, the definition is assumed to be recursive. The name is assigned a role compatible with its use on the right if it does not already have a role. If the expression on the right of <b>IS</b> is itself a named object, the name being defined is associated with the right-hand-side name rather than the expression it has as its association.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>External Declaration</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;external-declaration&gt;</i> ::= <i>&lt;identifier&gt;</i> <b>IS</b> <b>EXTERNAL</b> (<br>
                              <b>EXPRESSION</b> | <b>OPERATION</b> |<br>
                              <b>TRANSFORMER</b> | <b>VARIABLE</b> )</span></p>
<p class="p5"><span class="s1">An <i>external-declaration</i> assigns a role to a name, allowing it to be used in a definition before its own definition is given. This mechanism is useful for creating mutually recursive definitions. An external declaration is made only in the global environment.</span></p>
<p class="p5"><span class="s1">If the name is already defined with the same role, the declaration has no effect. If the name has another role, a fault is reported. If the name is not currently defined, a default object is associated with it.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Remark</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;remark&gt;</i> ::= <b>#</b> <i>&lt; any text &gt;</i></span></p>
<p class="p5"><span class="s1">A <i>remark</i> is an input to the Q'Nial interpreter that is not processed. It begins with a line that has the symbol <b>#</b> as the first non-blank character in the line. In direct input at the top level loop, a remark ends at the end of the line unless a backslash symbol ( \ ) is used to extend the line. In a definition file, a remark ends at the first blank line. A remark cannot appear within a definition or expression-sequence. The purpose of a remark is to permit an extended textual description within a definition file for documentation purposes.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Array Expression</b></span></h2>
<p class="p5"><span class="s1">An <i>array</i> is a data element of the Nial language as described in Chapter 2.</span></p>
<p class="p5"><span class="s1">An <i>array-expression</i> is a well formed fragment of program text that returns an array when interpreted by Q'Nial. It is usually called an expression rather than an array-expression in this manual except in contexts where the abbreviated term might cause confusion.</span></p>
<p class="p5"><span class="s1">The following sections describe how expressions are formed and what they mean. In most contexts, an <i>array-expression</i> is formed as an <i>expression-sequence</i> as described in the next section. In some contexts, however, it is limited to being to be a <i>simple-expression</i> as described in the subsequent section.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Expression Sequence</b></span></h2>
<p class="p5"><span class="s1">An <i>expression-sequence</i> is sequence of one or more expressions separated by semicolons.</span></p>
<p class="p5"><span class="s1">   <i>&lt;expression-sequence&gt;</i> ::= <i>&lt;expression&gt;</i> { <b>;</b> <i>&lt;expression&gt;</i> } [<b>;</b> ]</span></p>
<p class="p5"><span class="s1">An <i>expression</i> is a <i>simple-expression</i>, a <i>comment</i>, or one of the control structure expressions.</span></p>
<p class="p5"><span class="s1">   <i>&lt;expression&gt;</i> ::= <i>&lt;simple-expression&gt;</i><br>
                  | <i>&lt;assign-expression&gt;</i><br>
                  | <i>&lt;selection-expression&gt;</i><br>
                  | <i>&lt;loop-expression&gt;</i><br>
                  | <i>&lt;comment&gt;</i></span></p>
<p class="p5"><span class="s1">The expressions in an <i>expression-sequence</i> are evaluated in left-to-right order. If the sequence does not terminate with a semicolon, the array returned is the result of the last expression. If the sequence does end with a semicolon, the array returned is the fault <i>?noexpr</i>. At the top level loop, if the array returned is the fault <i>?noexpr</i>, it is not displayed.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Simple Expression</b></span></h2>
<p class="p5"><span class="s1">A <i>simple-expression</i> is defined by a juxtaposition syntax involving <i>primary-expressions</i> and <i>operations</i>.</span></p>
<p class="p5"><span class="s1">   <i>&lt;simple-expression&gt;</i> ::= <i>&lt;primary-sequence&gt;</i><br>
                         | <i>&lt;operation-sequence&gt;</i> <i>&lt;primary-sequence&gt;</i><br>
                         | <i>&lt;simple-expression&gt;</i> <i>&lt;simple-operation&gt;</i> <i>&lt;primary-sequence&gt;</i><br>
                         | <i>&lt;simple-expression&gt;</i> <i>&lt;simple-operation&gt;</i> <i>&lt;operation-sequence&gt;</i> <i>&lt;primary-sequence&gt;</i></span></p>
<p class="p5"><span class="s1">   <i>&lt;primary-sequence&gt;</i> ::= { <i>&lt;primary-expression&gt;</i> }+</span></p>
<p class="p5"><span class="s1">   <i>&lt;primary-expression&gt;</i> ::= <i>&lt;constant&gt;</i><br>
                          | <i>&lt;variable&gt;</i><br>
                          | <i>&lt;indexed-variable&gt;</i><br>
                          | <i>&lt;named-expression&gt;</i><br>
                          | <i>&lt;expression-list&gt;</i><br>
                          | <b>(</b> <i>&lt;expression-sequence&gt;</i> <b>)</b><br>
                          | <i>&lt;block&gt;</i><br>
                          | <i>&lt;cast&gt;</i></span></p>
<p class="p5"><span class="s1">A <i>primary-expression</i> is a program fragment that denotes an array. If a <i>primary-sequence</i> has exactly one <i>primary-expression</i>, its value is the value of the one expression. A <i>primary-sequence</i> of length two or greater is called a <b>strand</b>. The value of a strand is a list of values. Each item of the list has the value of the <i>primary-expression</i> in the corresponding position in the <i>primary-sequence</i>. The value of a <i>simple-expression</i> formed by a <i>primary-sequence</i> is the value of the <i>primary-sequence</i>.</span></p>
<p class="p5"><span class="s1">The value of a <i>simple-expression</i> formed by the construct <i>operation-sequence primary-sequence</i> is determined as follows: the <i>primary-sequence</i> to the right of the <i>operation-sequence</i> is evaluated, then the operations in the <i>operation-sequence</i> are applied to the result in a right-to-left order.</span></p>
<p class="p5"><span class="s1">The construct <i>simple-expression simple-operation primary-sequence</i> corresponds to infix usage of a <i>simple-operation</i>. The value of a <i>simple-expression</i> formed by this construct is determined as follows: the <i>simple-expression</i> to the left is evaluated, then the <i>primary-sequence</i> to the right is evaluated; the two values are made into a pair and the result is obtained by applying the <i>simple-operation</i> to the pair. A <i>simple-expression</i> can be formed by the infix use of two or more <i>simple-operations</i> separating <i>primary-sequences</i>. The interpretation given for a single infix use just explained implies that the infix operations are used in a left-to-right order.</span></p>
<p class="p5"><span class="s1">The last construct for forming a simple expression describes infix usage in the case where the program fragment after the <i>simple-operation</i> involves applying an <i>operation-sequence</i> to the <i>primary-sequence</i>. It is evaluated in a fashion similar to the rule governing the previous construct except that the <i>operation-sequence</i> is applied to the value of the <i>primary-sequence</i> prior to forming the pair.</span></p>
<p class="p5"><span class="s1">The syntax rules for <i>simple-expressions</i> show three uses of the side-by-side or juxtapositional notation of Nial: strand formation, prefix operation application and infix operation application. There are no syntactic restrictions as to whether or not a particular operation may be applied in infix or prefix form. A fault is returned at run time if an operation is used inappropriately.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Primary Expressions</b></span></h2>
<p class="p5"><span class="s1">There are several forms of primary-expressions that can form a <i>simple-expression</i>. They are described in the next few sections.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Constant</b></span></h2>
<p class="p5"><span class="s1">A <i>constant</i> is a <i>primary-expression</i> that denotes an explicit data value. It is an array that has a fixed specific value throughout the computation and forms one syntactic unit in the formation of a strand. Constants provide a notation for constructing each of the six atomic types as well as a boolean list (bitstring) and a character list (string):</span></p>
<p class="p5"><span class="s1">   <i>&lt;constant&gt;</i> ::= <i>&lt;boolean-constant&gt;</i><br>
                | <i>&lt;bitstring-constant&gt;</i><br>
                | <i>&lt;integer-constant&gt;</i><br>
                | <i>&lt;real-constant&gt;</i><br>
                | <i>&lt;character-constant&gt;</i><br>
                | <i>&lt;string-constant&gt;</i><br>
                | <i>&lt;phrase-constant&gt;</i><br>
                | <i>&lt;fault-constant&gt;</i></span></p>
<p class="p5"><span class="s1">A <b>boolean-constant</b> is a numeric atom that repre sents a logical value.</span></p>
<p class="p5"><span class="s1">   <i>&lt;boolean-constant&gt;</i> ::= <b>l</b> | <b>o</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;bitstring&gt;</i> ::= <i>&lt;boolean-constant&gt;</i> { <i>&lt;boolean-constant&gt;</i> }+</span></p>
<p class="p5"><span class="s1">The two letters <i>l</i> and <i>o</i> are used to denote the abstract boolean values <b>true</b> and <b>false</b>, respectively. When used as numbers, they are treated as the integers 1 and 0. The names <i>True</i> and <i>False</i> are predefined named-expressions denoting the values.</span></p>
<p class="p5"><span class="s1">A <i>bitstring-constant</i> denotes a list of two or more booleans, called a <b>bitstring</b>. A bitstring of length one is denoted by <i>[l]</i> or <i>[o]</i>.</span></p>
<p class="p5"><span class="s1">An <i>integer-constant</i> is a numeric atom representing a whole number.</span></p>
<p class="p5"><span class="s1">   <i>&lt;integer-constant&gt;</i> ::= [<b>-</b> ] { <i>&lt;digit&gt;</i> }+</span></p>
<p class="p5"><span class="s1">The limits of the range of an integer number depend on the word size of the host computer. If an <i>integer-constant</i> exceeds the limit a real constant is used in its place.</span></p>
<p class="p5"><span class="s1">A <i>real-constant</i> is a numeric atom that denotes a real number. A number that has a decimal point or an exponent part is a <i>real-constant</i>.</span></p>
<p class="p5"><span class="s1">   <i>&lt;real-constant&gt;</i> ::= [<b>-</b> ] { <i>&lt;digit&gt;</i> }+ <b>.</b> { <i>&lt;digit&gt;</i> } [ <i>&lt;exponent&gt;</i> ]<br>
                     | [<b>-</b> ] { <i>&lt;digit&gt;</i> } <b>.</b> { <i>&lt;digit&gt;</i> }+ [ <i>&lt;exponent&gt;</i> ]<br>
                     | [<b>-</b> ] { <i>&lt;digit&gt;</i> }+ [ <i>&lt;exponent&gt;</i> ]</span></p>
<p class="p5"><span class="s1">   <i>&lt;exponent&gt;</i> ::= (<b>e</b> | <b>E</b> ) [<b>+</b> | <b>-</b> ] { <i>&lt;digit&gt;</i> }+</span></p>
<p class="p5"><span class="s1">A <i>real-constant</i> is represented by a double precision floating-point number within the computer system. It is converted to the nearest one in the floating-point number system. Because the computer has a fixed length for its representation of floating-point numbers, the precision of the number stored may be less than that specified in the constant.</span></p>
<p class="p5"><span class="s1">There is one predefined <i>real-constant</i>, <b>Pi</b>, which is defined in <i>defs.ndf</i>.</span></p>
<p class="p5"><span class="s1">A <i>character-constant</i> denotes a single atomic character; a <i>string</i> denotes a list of characters.</span></p>
<p class="p5"><span class="s1">   <i>&lt;character-constant&gt;</i> ::= <b>`</b> <i>&lt;symbol&gt;</i></span></p>
<p class="p5"><span class="s1">   <i>&lt;string-constant&gt;</i> ::= <b>'</b> { <i>&lt;symbol&gt;</i> }+ <b>'</b></span></p>
<p class="p5"><span class="s1">where <i>symbol</i> is a member of the set of characters for the host system.</span></p>
<p class="p5"><span class="s1">A <i>character-constant</i> denotes a literal atom that can be represented on the keyboard, on the screen or on the printer of the computer by a single symbol. The set of characters for Q'Nial is determined by the host system. On most systems, the 128 characters of the ASCII character set are represented in the stan dard way. On some systems, an additional 128 characters are available for special use. The ordering sequence of the characters for sorting purposes is fixed for each Q'Nial version.</span></p>
<p class="p5"><span class="s1">There is one character-constant predefined in <i>defs.ndf</i> called <b>Separator</b>. It has the value <b>/</b> on UNIX and OSX systems. It is useful for building path names for host files on these systems.</span></p>
<p class="p5"><span class="s1">A <i>string-constant</i> denotes a list of zero or more characters. A string-constant is denoted by a sequence of zero or more symbols bounded by single quote marks. A pair of adjacent single quote marks within the bounding ones denotes a single quote mark in the resulting list.</span></p>
<p class="p5"><span class="s1">The remaining two constant constructs denote literal atoms that are phrases or faults.</span></p>
<p class="p5"><span class="s1">   <i>&lt;phrase-constant&gt;</i> ::= <b>"</b> { <i>&lt;non-terminating-symbol&gt;</i> }</span></p>
<p class="p5"><span class="s1">   <i>&lt;fault-constant&gt;</i> ::= <b>?</b> { <i>&lt;non-terminating-symbol&gt;</i> }</span></p>
<p class="p5"><span class="s1">where <i>non-terminating-symbol</i> is a member of the set <i>symbols</i> excluding the characters:</span></p>
<p class="p5"><span class="s1">   &lt;blank&gt; <b>(</b> <b>)</b> <b>[</b> <b>]</b> <b>{</b> <b>}</b> <b>#</b> <b>,</b> <b>;</b></span></p>
<p class="p5"><span class="s1">The excluded symbols are omitted in <i>phrase-constants</i> and <i>fault-constants</i> because they tend to be punctuation symbols which naturally end a phrase. Omitting them avoids easily created errors. A phrase or fault containing the excluded symbols can be created using the operations <i>phrase</i> or <i>fault</i>, respectively, each taking a string as argument.</span></p>
<p class="p5"><span class="s1">A <i>phrase-constant</i> denotes an atomic literal that is treated as a unit. Phrases are stored uniquely in an internal table and represented by an internal pointer. Comparisons of phrases for equality are as efficient as integer comparisons since only the internal pointers are compared.</span></p>
<p class="p5"><span class="s1">A <i>fault-constant</i> denotes an atomic literal that is used to represent an erroneous or extraordinary result. Faults are very similar to phrases but are treated differently by the non-structural operations in order to propagate error reporting information. A fault indicates the type of error or condition detected. All faults produced by Q'Nial begin with a question mark.</span></p>
<p class="p5"><span class="s1">Not all faults indicate errors; some signal special values. The fault <i>?eof</i>, for example, indicates the end of an input file.</span></p>
<p class="p5"><span class="s1">In the default mode of operation of Q'Nial, most fault values are not created. Rather, an interrupt is triggered. A description of the fault triggering mechanism is given in Chapter 9.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Variable</b></span></h2>
<p class="p5"><span class="s1">A <i>variable</i> is a name associated with an array value. Its syntactic form is that of an identifier.</span></p>
<p class="p5"><span class="s1">   <i>&lt;variable&gt;</i> ::= <i>&lt;identifier&gt;</i><br>
              | <i>&lt;identifier&gt;</i> <b>:</b> <i>&lt;identifier&gt;</i></span></p>
<p class="p5"><span class="s1">A variable is given an association with an array value by its use on the left side of an assign-expression, its appearance in a <i>local</i> or <i>nonlocal</i> declaration, its designation as a variable in an external-declaration or its use as the first argument of the operation <i>assign</i>.</span></p>
<p class="p5"><span class="s1">When a variable is used as a <i>primary-expression</i>, its meaning is the array value associated with the identifier. If the variable exists but has not been assigned, it will have as its default value the fault <i>?no_value</i>. If an identifier is mentioned as a primary-expression but has not yet been given an association, a parse error will occur with the fault <i>?undefined identifier:</i>.</span></p>
<p class="p5"><span class="s1">The second form of variable is used to refer to a variable in a scope that has invoked the scope in which the form appears. It is useful in debugging situations where the value of variables in the calling environment need to be examined. The first identifier refers to the name of the definition and the second to the variable in scope of the definition.</span></p>
<p class="p5"><span class="s1">A variable gives a name to the result of a computation. If the same result is needed later in the program, the named variable can be used, thereby avoiding the necessity of repeating the computation. A variable can be assigned different array values throughout the computation.</span></p>
<p class="p5"><span class="s1">Although an identifier can be of any length up to 80 characters, a compromise is usually made between choosing explicit variable names and choosing brief names to avoid unnecessary typing. An identifier used as a variable cannot be a <i>reserved word</i>. (A table of the reserved words is given in the <i>Nial Dictionary</i> under <b>reserved words</b>.) In a local environment, a variable identifier can be chosen the same as a predefined or user-defined global definition name. Such a choice makes the global use of the name unavailable in the local context.</span></p>
<p class="p5"><span class="s1">In any environment, an identifier can name only one of: a variable, an array-expression, an operation-expression, or a transformer-expression. During one session, the <i>role</i> of a global identifier, i.e. the class of syntactic object it names, cannot be changed.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Scope of a Variable</b></span></h2>
<p class="p5"><span class="s1">The use of an assign-expression indicates that a name (identifier) is to be treated as a variable in the context surrounding the assign-expression. This context is called the <b>scope</b> of the variable. The context may be global, in which case the variable may be visible at all levels; or it may be local to some region of program text. A local scope is created for the parameters of operation forms and for variables created within a block.</span></p>
<p class="p5"><span class="s1">Because operation forms or blocks may appear within other operation forms or blocks, it is possible to have one scope for a name nested within another. A name is said to be visible at a point in a program text if it has a local meaning at that point or has a meaning in some surrounding scope or is a global name. When a name is used in a local scope, it is the local association in the innermost scope that is used, instead of an association with the same name in a surrounding scope.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Indexed Variable</b></span></h2>
<p class="p5"><span class="s1">An <i>indexed variable</i> is a variable for which a part of the associated array value is referenced:</span></p>
<p class="p5"><span class="s1">   <i>&lt;indexed-variable&gt;</i> ::= <i>&lt;variable&gt;</i> <b>@</b> <i>&lt;primary-expression&gt;</i><br>
                        | <i>&lt;variable&gt;</i> **@@** <i>&lt;primary-expression&gt;</i><br>
                        | <i>&lt;variable&gt;</i> <b>#</b> <i>&lt;primary-expression&gt;</i><br>
                        | <i>&lt;variable&gt;</i> <b>|</b> <i>&lt;primary-expression&gt;</i></span></p>
<p class="p5"><span class="s1">An <i>index</i> is the value of the primary-expression within an indexed-variable which specifies the location or locations of the part or parts of the array that are selected.</span></p>
<p class="p5"><span class="s1">If an indexed-variable is used as a primary-expression, its value is the value of the selected part of the variable. There are four ways to index an array in Nial as described in the following table:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td23">
        <p class="p8"><span class="s1"><b>Symbol Type</b></span></p>
      </td>
      <td valign="middle" class="td24">
        <p class="p8"><span class="s1"><b>Name</b></span></p>
      </td>
      <td valign="middle" class="td25">
        <p class="p8"><span class="s1"><b>Index</b></span></p>
      </td>
      <td valign="middle" class="td26">
        <p class="p8"><span class="s1"><b>Result</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td23">
        <p class="p8"><span class="s1">@</span></p>
      </td>
      <td valign="middle" class="td24">
        <p class="p8"><span class="s1">at</span></p>
      </td>
      <td valign="middle" class="td25">
        <p class="p8"><span class="s1">address</span></p>
      </td>
      <td valign="middle" class="td26">
        <p class="p8"><span class="s1">item at the address</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td23">
        <p class="p8"><span class="s1">@@</span></p>
      </td>
      <td valign="middle" class="td24">
        <p class="p8"><span class="s1">at-path</span></p>
      </td>
      <td valign="middle" class="td25">
        <p class="p8"><span class="s1">path</span></p>
      </td>
      <td valign="middle" class="td26">
        <p class="p8"><span class="s1">part at the path</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td23">
        <p class="p8"><span class="s1">#</span></p>
      </td>
      <td valign="middle" class="td24">
        <p class="p8"><span class="s1">at-all</span></p>
      </td>
      <td valign="middle" class="td25">
        <p class="p8"><span class="s1">array of addresses</span></p>
      </td>
      <td valign="middle" class="td26">
        <p class="p8"><span class="s1">the array of items at the addresses</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td23">
        <p class="p8"><span class="s1">|</span></p>
      </td>
      <td valign="middle" class="td24">
        <p class="p8"><span class="s1">slice</span></p>
      </td>
      <td valign="middle" class="td25">
        <p class="p8"><span class="s1">positions on axes</span></p>
      </td>
      <td valign="middle" class="td26">
        <p class="p8"><span class="s1">cross sections of items</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">Nial uses zero-origin indexing, so that the first item in a list is at address 0 and the first item in a table is at address (0 0). When the indexed-variable notation is interpreted, the primary-expression is evaluated. The result of the evaluation of the primary-expression and the form of indexing together determine the locations specified by the particular indexed-variable notation. If the primary-expression does not evaluate to a valid index for the array and the type of indexing, a fault is returned.</span></p>
<p class="p5"><span class="s1">In the <i>at</i> form of indexing, the result is the item at the given address of the array associated with the variable.</span></p>
<p class="p5"><span class="s1">In the <i>at-path</i> form of indexing, the value of the index is a list of addresses for subparts of the array on a path descending into the nesting structure of the array. The notation refers to the value of an item of an item etc. for as many levels as the length of the path.</span></p>
<p class="p5"><span class="s1">In the <i>at-all</i> form of indexing, the index is an array of addresses. An array of the same shape as the index is selected from the array associated with the variable, with items chosen using the index items as addresses.</span></p>
<p class="p5"><span class="s1">In the <i>slice</i> form of indexing, the index is a list of arrays, each array representing the positions to be chosen for one of the axes of the array being indexed. There must be as many items in the index as there are axes. If an item of the index is the fault <i>?noexpr</i> (usually generated using an expression-list with a missing position) that entry is expanded to be the list of all positions on that axis. The cartesian product of the expanded index is then used to form an array of addresses, which are used to select the corresponding items as in <i>at-all</i> indexing. The <b>cartesian product</b> of a list of arrays is an array of lists containing all the combinations formed by taking one item from each of the arrays in turn. It is implemented by the same algorithm used for the operation <i>cart</i>.</span></p>
<p class="p5"><span class="s1">The shape of the result of slice indexing is found by linking the shapes of the items of the expanded index.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Named Expression</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;named-expression&gt;</i> ::= <i>&lt;identifier&gt;</i></span></p>
<p class="p5"><span class="s1">A *named-expression** is an array-expression that is associated with a name by being predefined or through a definition. The use of a named-expression in a primary-expression causes the associated expression to be executed when the primary-sequence in which it is embedded is evaluated. Each mention of the name causes the expression to be evaluated.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Expression List</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;expression-list&gt;</i> ::= <b>[</b> <i>&lt;expression-comma-sequence&gt;</i> <b>]</b><br>
                       | <b>[</b> <i>&lt;expression-comma-sequence&gt;</i> <i>&lt;simple-expression&gt;</i> <b>]</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;expression-comma-sequence&gt;</i> ::= <i>&lt;expression-comma-sequence&gt;</i> <b>,</b><br>
                       | <i>&lt;expression-comma-sequence&gt;</i> <i>&lt;simple-expression&gt;</i> <b>,</b><br>
                       | <i>&lt;empty&gt;</i></span></p>
<p class="p5"><span class="s1">The value of an expression-list is a list of the length of the number of simple-expressions in the expression list, counting expressions omitted before or after a comma. The items of the result are the values of the simple-expressions evaluated and sequenced in left-to-right order. If there are no items in the expression list, the result is <i>Null</i>, the predefined empty list.</span></p>
<p class="p5"><span class="s1">An expression can be missing before or after a comma. The value corresponding to a missing expression is the no-expression fault: <i>?noexpr</i>. An expression-list containing omitted expressions is useful in providing an index for the <i>at-slice</i> form of indexing.</span></p>
<p class="p5"><span class="s1">A list may be constructed directly by using brackets notation or strand notation. In <b>brackets-comma notation</b>, the elements of a list are separated by commas and the list is bounded by square brackets. In <b>strand notation</b>, the elements of a list are separated by one or more blank spaces. Parentheses can be used with strand notation for grouping two or more items as a strand that forms a sublist of the list denoted by the strand notation. Extra parentheses are ignored in strands.</span></p>
<p class="p5"><span class="s1">A list may contain arrays of any type in any sequence desired. Both strand and brackets notation may occur in the same list. A list in brackets notation is one unit in the construction of a list using strand notation. Strand notation can be used to create a list with two or more items. Brackets notation can be used to create a list with no items, one item, or many items.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Parenthesized Expression Sequence</b></span></h2>
<p class="p5"><span class="s1">The value of a <i>parenthesized expression-sequence</i> is the value of the expression-sequence. The parenthe ses indicate that the expression-sequence is evaluated before inclusion in a further computation. This use of parentheses is consistent with their use in mathematical notation. An expression-sequence can be made into a primary-expression by enclosing it in parenthe ses.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Block</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;block&gt;</i> ::= <b>{</b> [ <b>LOCAL</b> { <i>&lt;identifier-sequence&gt;</i> }+; ]<br>
                [ <b>NONLOCAL</b> { <i>&lt;identifier-sequence&gt;</i> }+; ]<br>
                [ <i>&lt;definition-sequence&gt;</i> <b>;</b> ]<br>
                <i>&lt;expression-sequence&gt;</i><br>
             <b>}</b></span></p>
<p class="p5"><span class="s1">A <i>block</i> is a scope-creating mechanism that permits an expression-sequence to be created so that it has local definitions and variables which are visible only inside the block. A block may appear as a primary-expression or as the body of an operation-form.</span></p>
<p class="p5"><span class="s1">If a block is used as a primary-expression, the local environment created by a block is determined by the block itself. If it is the body of an operation-form, the local environment includes the formal parameter names of the operation-form as variables.</span></p>
<p class="p5"><span class="s1">The value of a block is the value of the expression-sequence within the block, evaluated within the local context formed by the declarations and definitions within the block, if any.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Local and Nonlocal Declaration</b></span></h2>
<p class="p5"><span class="s1">The identifiers included in the <i>local</i> and <i>nonlocal</i> declarations are declared to be variables. Both forms of declarations are optional, but if both are given, local declarations must be made first. If the block is the body of a globally defined operation-form or expression, a nonlocal declaration effectively declares its variables as global ones.</span></p>
<p class="p5"><span class="s1">A block delimits a local environment. It allows new uses of names which do not interfere with uses of those names outside the block. For example, within a block, a predefined operation name can be redefined and used for a different purpose. Only the reserved words of Q'Nial cannot be reused in this fashion.</span></p>
<p class="p5"><span class="s1">Definitions that appear within the block have local scope. That is, the definitions can be referenced only in the body of the block. Variables assigned within the block may or may not have local scope, depending on the appearance of a local and/or a nonlocal declaration. If there is no declaration, all assigned variables have local scope. Declaring some variables as local does not change the effect on undeclared variables that are used on the left of assignment; they are automatically localized.</span></p>
<p class="p5"><span class="s1">If a nonlocal declaration is used, an assigned name that is on the nonlocal list is sought in surrounding scopes. If the name is not found, a variable is created in the global environment.</span></p>
<p class="p5"><span class="s1">The determination of the scope of a variable is done when the program fragment in which it is located is analysed. The same scope is then used each time the fragment is evaluated.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Nested Definition</b></span></h2>
<p class="p5"><span class="s1">A <i>nested definition</i> is one that appears in a definition sequence within a block. The defined name is local to the block. If the name is also used outside the block, the external meaning is not known in the block.</span></p>
<p class="p5"><span class="s1">Nested definitions can be used to encapsulate supporting definitions within a larger definition that is to be made available to other users. This avoids cluttering up the name space with names that might interfere with the user's other work. It is often easier to develop the large definition without encapsulation and package it in encapsulated form once the design is completed.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Cast</b></span></h2>
<p class="p5"><span class="s1">A <b>cast</b> is an array that denotes an internal representation of a valid fragment of Q'Nial program text:</span></p>
<p class="p5"><span class="s1">   <i>&lt;cast&gt;</i> ::= <b>!</b> <i>&lt;identifier&gt;</i><br>
            | <b>!</b> ( <i>&lt;expression-sequence&gt;</i> )<br>
            | <b>!</b> ( <i>&lt;operation-expression&gt;</i> )<br>
            | <b>!</b> ( <i>&lt;transformer-expression&gt;</i> )</span></p>
<p class="p5"><span class="s1">The use of the exclamation symbol ( <b>!</b> ) before an identifier causes Q'Nial to select the internal represen tation for the identifier rather than the value of the array associated with the identifier. Its use before a parenthesized program fragment selects the internal representation of the program fragment. The internal representation is a nested array forming the parse tree of the construct.</span></p>
<p class="p5"><span class="s1">The major use of casts is in conjunction with the operations <i>assign</i> and <i>apply</i>. These operations mimic the Q'Nial constructs for assignment to a variable and application of an operation to an array. Casts permit passing an argument to an operation by variable name rather than by value. They also permit evaluation of a program fragment that has been stored in its internal form using the operation <i>eval</i> rather than requiring the use of the operation <i>execute</i> on the corresponding program text stored as a string. The details of the internal representation is not specified as part of the Nial language.</span></p>
<p class="p5"><span class="s1">The description of the syntactic construct <i>simple-expression</i> is now complete.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Assign Expression</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;assign-expression&gt;</i> ::= { variable }+ <b>:=</b> <i>&lt;expression&gt;</i><br>
                         | <i>&lt;indexed-variable</i>&gt; <b>:=</b> <i>&lt;expression</i>&gt;</span></p>
<p class="p5"><span class="s1">An <b>assign-expression</b> assigns an array value to one or more variables at the time of evaluation of the assign expression. The semantics of an assign expression is interpreted in two stages: when the expression is analysed (parsed) and when it is executed.</span></p>
<p class="p5"><span class="s1">During the parse of an assign-expression appearing in a block, each name on the variable list is sought in the local environment. If the name exists in the local environment, the assignment affects the local association. If a name does not exist in the local environment and no reference has been made to a nonlocal variable with the same name, a local variable is created in the block and the association is with this new variable. An assign-expression parsed in the global environment creates a global variable if a variable with that name does not already exist.</span></p>
<p class="p5"><span class="s1">When an assign expression is executed, the expression on the right of the assignment symbol ( <i>:=</i> ) is evaluated. If the variable list on the left has only one name, the value of the expression is assigned to that variable. That is, the value is associated with that name.</span></p>
<p class="p5"><span class="s1">If the variable list has several names, the items of the value are assigned to the variables in the order in which they appear. If the number of items does not match the number of variables, the fault <i>?assignment</i> is returned as the value of the assign-expression. Otherwise, the value of the assign-expression is the value of the expression on the right.</span></p>
<p class="p5"><span class="s1">When an indexed-variable is used on the left in an assign-expression, the parts of the array associated with the variable at the locations specified by the index are replaced by the values of the expression on the right.</span></p>
<p class="p5"><span class="s1">If the index expression for an indexed-variable assignment specifies a number of locations (at-all or slice indexing), there are two cases: if the value on the right is a single, the item of the single is placed in each location; otherwise, the value on the right must have the same number of items as the index expres sion indicates and the corresponding locations are updated with the items of the array value.</span></p>
<p class="p5"><span class="s1">The keyword <b>GETS</b> is a synonym for the assignment symbol <i>:=</i> .</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Selection Expression</b></span></h2>
<p class="p5"><span class="s1"><b>Selection-expressions</b> are used to describe computations in which one of many actions or values is to be evaluated.</span></p>
<p class="p5"><span class="s1">   <i>&lt;selection-expression&gt;</i> ::= <i>&lt;if-expression&gt;</i><br>
                            | <i>&lt;case-expression&gt;</i></span></p>
<p class="p5"><span class="s1">   <i>&lt;if-expression&gt;</i> ::= <b>IF</b> <i>&lt;simple-expression&gt;</i> <b>THEN</b><br>
                        <i>&lt;expression-sequence&gt;</i><br>
                     { <b>ELSEIF</b> <i>&lt;simple-expression&gt;</i> <b>THEN</b> <i>&lt;expression-sequence&gt;</i> }<br>
                     [ <b>ELSE</b> <i>&lt;expression-sequence&gt;</i> ]<br>
                     <b>ENDIF</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;case-expression&gt;</i> ::= <b>CASE</b> <i>&lt;simple-expression&gt;</i> <b>FROM</b><br>
                         { <i>&lt;constant&gt;</i> <b>:</b> <i>&lt;expression-sequence&gt;</i> <b>END</b> }+<br>
                         [ <b>ELSE</b> <i>&lt;expression-sequence&gt;</i> ]<br>
                       <b>ENDCASE</b></span></p>
<p class="p5"><span class="s1">In the <b>if-expression</b> the selection is made by evaluating the simple-expressions after the <i>if</i> and <i>elseif</i> keywords as boolean expressions. As soon as one of these evaluates to <i>true</i>, the expression-sequence following the corresponding <i>then</i> is evaluated and its value returned as the result of the if-expression.</span></p>
<p class="p5"><span class="s1">All the simple-expressions after the <i>if</i> and <i>elseif</i> may evaluate to <i>false</i>. If they do and an <i>else</i> is pre sent, the result is the value of the expression-sequence following the <i>else</i>. If all the simple-expressions after the <i>if</i> and <i>elseif</i> evaluate to <i>false</i> and there is no <i>else</i> present, the result is the fault <i>?noexpr</i>. If one of the simple-expres sions evaluates to a non-boolean value, the result is the fault <i>?L</i>.</span></p>
<p class="p5"><span class="s1">In the <b>case-expression</b>, the selection is made by evaluating the simple-expression following the <i>case</i> and comparing it to the constants preceding the colons. If the value matches a constant, the expression-sequence following the corresponding colon is returned as the result of the case-expression. If the value does not match one of the constants, the result returned by the case-expression is the value of the expression-sequence following the <i>else</i> if it is present; otherwise the result is the fault <i>?noexpr</i>.</span></p>
<p class="p5"><span class="s1">The case-expression form of selection is useful when the choice depends on a single atomic value and there are a large number of possible values the simple-expression can take on.</span></p>
<p class="p5"><span class="s1">Both of these forms can be used in a value oriented way or as an imperative. If the desired effect is to return a value, each expression-sequence must omit the final semicolon so that if it is selected, its value rather than the fault <i>?noexpr</i> is returned.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Loop Expression</b></span></h2>
<p class="p5"><span class="s1"><b>Loop expressions</b> are used to repeat a computation a number of times. In the three forms of loops, the computation is in the form of a loop-body. This is an expression-sequence as described above with the additional property that it, or expression-sequences embedded within it, can use the exit-expression as an additional form of expression.</span></p>
<p class="p5"><span class="s1">   <i>&lt;loop-expression&gt;</i> ::= <i>&lt;for-expression&gt;</i><br>
                       | <i>&lt;while-expression&gt;</i><br>
                       | <i>&lt;repeat-expression&gt;</i><br>
   <i>&lt;for-expression&gt;</i> ::= <b>FOR</b> <i>&lt;variable&gt;</i> <b>WITH</b> <i>&lt;simple-expression&gt;</i> <b>DO</b><br>
                           <i>&lt;loop-body&gt;</i><br>
                       <b>ENDFOR</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;while-expression&gt;</i> ::= <b>WHILE</b> <i>&lt;simple-expression&gt;</i> <b>DO</b><br>
                            <i>&lt;loop-body&gt;</i><br>
                        <b>ENDWHILE</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;repeat-expression&gt;</i> ::= <b>REPEAT</b><br>
                            <i>&lt;loop-body&gt;</i><br>
                         <b>UNTIL</b><br>
                            <i>&lt;simple-expression&gt;</i><br>
                         <b>ENDREPEAT</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;exit-expression&gt;</i> ::= <b>EXIT</b> <i>&lt;simple-expression&gt;</i></span></p>
<p class="p5"><span class="s1">In the <b>for-expression</b>, the simple-expression evalua tes to an array value used to control the loop. The loop-body is evaluated repeatedly with the variable taking on the items of the control array in turn. If the control array is empty, the loop-body is not evaluated.</span></p>
<p class="p5"><span class="s1">A <b>while-expression</b> implements a loop with a pretest. The simple-expression and the loop-body are evaluated alternately as long as the simple-expression evaluates to a boolean value and is <i>true</i>. If the simple-expression is <i>false</i> on the first evaluation, the loop-body is not executed.</span></p>
<p class="p5"><span class="s1">A <b>repeat-expression</b> implements a loop with a post test. The loop-body and the simple-expression are evaluated alternately until the simple-expression evaluates to a boolean value and is <i>true</i>. If the simple-expression is <i>true</i> on the first evaluation, the loop body is executed once.</span></p>
<p class="p5"><span class="s1">In all three loop forms, if an embedded exit-expression is evaluated, the loop terminates early and returns with the value of the simple-expression following the reserved word <i>exit</i>. The exit-expression cannot be used outside a loop-expression.</span></p>
<p class="p5"><span class="s1">The value of a loop expression in all three cases is the value of the expression-sequence on the last evaluation of the loop body. If the loop body is never evaluated, the value is the fault: <i>?noexpr</i>. In the last two forms, if the simple-expression does not return a boolean, the value of the loop is the logical fault <i>?L</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Comment</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;comment&gt;</i> ::= <b>%</b> <i>&lt;any text excluding a semicolon&gt;</i> <b>;</b></span></p>
<p class="p5"><span class="s1">A <b>comment</b> is a brief section of text included in a program fragment to assist readability. Comments may be placed anywhere in a block before or after declarations, definitions or expressions. Their purpose is to provide an explanation of the program fragment for the programmer who may be required to modify the definition at a later date. The value of a comment as an expression is the <i>?noexpr</i> fault. Comments are retained when a definition is translated into internal form and they appear in its creation in the canonical form used by the operations <i>see</i> and <i>defedit</i>.</span></p>
<p class="p5"><span class="s1">The description of the construct <i>expression</i> is now complete. The next three sections describe the constructs for <i>operation-expression</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Operation Expression</b></span></h2>
<p class="p5"><span class="s1">Q'Nial has a large number of predefined operations chosen both for their generality and for their practical utility in a wide variety of applications. Programming in Nial is achieved by defining new operations and using them to carry out a required computation. The following sections describe the program fragments that can be used as operation-expressions.</span></p>
<p class="p5"><span class="s1">   <i>&lt;operation-expression&gt;</i> ::= <i>&lt;operation-sequence&gt;</i><br>
                            | <i>&lt;operation-form&gt;</i><br>
                            | <i>&lt;curried-operation&gt;</i></span></p>
<p class="p5"><span class="s1">   <i>&lt;operation-sequence&gt;</i> ::= { <i>&lt;simple-operation&gt;</i> }+</span></p>
<p class="p5"><span class="s1">   <i>&lt;curried-operation&gt;</i> ::= <i>&lt;simple-expression&gt;</i> <i>&lt;simple-operation&gt;</i></span></p>
<p class="p5"><span class="s1">The result of applying an <b>operation-sequence</b> to an argument is determined by applying the simple-opera tions in the sequence in right-to-left order.</span></p>
<p class="p5"><span class="s1">The simple-operation on the right is applied to the argument giving an intermediate result. Then the simple-operation to the immediate left is applied to the result of the first application. Subsequent simple-operations are applied to the results in turn.</span></p>
<p class="p5"><span class="s1">Thus, the effect of applying an operation-sequence of two or more simple-operations to an argument is equivalent to the effect of applying the <b>functional composition</b> of the operations to the argument. (The word <i>effect</i> is used in this explanation because the application of an operation to an array will always produce a <i>result</i>; but some operations produce a <i>side-effect</i> such as, for example, writing a record to a file.)</span></p>
<p class="p5"><span class="s1">The result of applying a <b>curried-operation</b> is determined by applying the simple-operation to the pair formed from the value of the simple-expression and the argument to the curried-operation.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Simple Operation</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;simple-operation&gt;</i> ::= <i>&lt;named-operation&gt;</i><br>
                        | <i>&lt;atlas&gt;</i><br>
                        | <i>&lt;transform&gt;</i><br>
                        | <b>(</b> <i>&lt;operation&gt;</i> <b>)</b></span></p>
<p class="p5"><span class="s1">   <i>&lt;named-operation&gt;</i> ::= <i>&lt;identifier&gt;</i></span></p>
<p class="p5"><span class="s1">A <b>named-operation</b> is a predefined operation or an operation that is associated with a name through a definition.</span></p>
<p class="p5"><span class="s1">An operation does not need to be named. It can be created and used in place without being named. However, except for very brief operation-expressions, the normal procedure is to give an operation-expres sion a name using the definition mechanism.</span></p>
<p class="p5"><span class="s1">When a predefined operation is applied to an argument, the algorithm implied by the description of the operation (given briefly in Part 2, or in more detail in the <i>Nial Dictionary</i>) is followed.</span></p>
<p class="p5"><span class="s1">The effect of applying a user-defined operation is equivalent to the effect of evaluating the program text fragment with the following change: the occurrence of the name of the user-defined operation is replaced by the operation-expression ( possibly in parentheses if context requires it) which is associated with the user-defined operation name.</span></p>
<p class="p5"><span class="s1">An operation can be viewed as a black box with input and output. The argument is the input to the operation and the result is the output. The application of the operation may also produce side effects if the operation does input or output operations or if assignments are made to variables that are declared to be nonlocal.</span></p>
<p class="p5"><span class="s1">   <i>&lt;atlas&gt;</i> ::= <b>[</b> <i>&lt;operation-expression&gt;</i> { <b>,</b> <i>&lt;operation-expression&gt;</i> } <b>]</b></span></p>
<p class="p5"><span class="s1">An <b>atlas</b> is an operation made up of a list of component operations. The result of applying an atlas is a list of the same length as the atlas. Each operation in the atlas is applied in turn to the argument resulting in an array value that becomes the item of the result list in the corresponding position.</span></p>
<p class="p5"><span class="s1">   <i>&lt;transform&gt;</i> ::= <i>&lt;named-transformer&gt;</i> <i>&lt;simple-operation&gt;</i></span></p>
<p class="p5"><span class="s1">A <b>transform</b> is a simple-operation formed by modifying a given simple-operation. This is done by placing a transformer name before the given simple-operation. An operation-expression that is not a simple-operation can be modified by placing it in parentheses.</span></p>
<p class="p5"><span class="s1">The result of the modification denotes a new operation. This new operation is called a transform. When the transform is applied to an array, the operation that is part of the transform is used in the evaluation of the result in the manner determined by the transformer.</span></p>
<p class="p5"><span class="s1">A transformer usually specifies a general algorithm which can have one or more operations as parameters. For example, the <i>EACH</i> related transformers generalize a number of looping mechanisms for applying an operation to items of arrays.</span></p>
<p class="p5"><span class="s1">A user-defined transformer could provide the skeleton for processing the records of a file and allow an arbitrary operation to be applied to each record.</span></p>
<p class="p5"><span class="s1">If a transform is formed using a named-operation, it is the <i>name</i> of the operation to which the transform is bound. The transform is not bound to any specific definition of the operation. Thus, a subsequent redefinition of the named-operation will change the meaning of the transform.</span></p>
<p class="p5"><span class="s1">Any operation-expression is made into a simple-operation by enclosing it within parentheses. A simple-operation formed by parenthesizing an operation-sequence returns the same result as the operation-sequence. Parenthesized operations permit curried operations to appear within an operation-sequence and allow compositions of operations to be an argument of a transformer.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Operation Form</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;operation-form&gt;</i> ::= <b>OPERATION</b> { <i>&lt;identifiers&gt;</i> }+ <i>&lt;block&gt;</i><br>
                      | <b>OPERATION</b> { <i>&lt;identifiers&gt;</i> }+ <b>(</b> <i>&lt;expression-sequence&gt;</i> <b>)</b></span></p>
<p class="p5"><span class="s1">An <b>operation-form</b> is the syntactic structure used to describe an operation in terms of a parameterized expression-sequence. The identifiers following the keyword <i>operation</i> are called the <b>formal parameters</b>. The <b>body</b> of an operation-form is normally a block but it may be an expression-sequence in parentheses without automatic localization.</span></p>
<p class="p5"><span class="s1">An operation-form defines a local environment. The formal parameter names are names of local variables. If the body of the operation form is a block, the local environment of the block is extended to include the formal parameters.</span></p>
<p class="p5"><span class="s1">When the operation-form is applied, the formal parameter names are assigned from the value of the actual argument. If there is only one formal parameter, the actual argument is assigned to it as a whole; otherwise, the items of the actual argument are assigned to the formal parameters in corresponding order. If there is a length mismatch between the list of formal parameter names and the values of the actual argument, the fault <i>?op_parameter</i> is returned.</span></p>
<p class="p5"><span class="s1">The value of the application of the operation is the value of the body of the operation-form, which is evaluated with the local variables in the parameter list assigned as described above. In determining the association for a name that appears in the body of an operation form, Q'Nial looks for the name in the local environment. If the name is not found locally, the name is sought in surrounding environments until it is found or until the global environment is searched. If it is not found, a fault <i>?unknown identifier</i> is given when the operation-form is translated to internal form (parsed).</span></p>
<p class="p5"><span class="s1"><i>Operation-forms</i> are most frequently used in definitions where they are given an associated name. However, an operation-form can appear directly in an expression provided it is enclosed in parentheses. In this usage, it can be an argument to a transformer name or can be applied to an array argument.</span></p>
<p class="p5"><span class="s1">The description of the construct <i>operation-expression</i> is now complete.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Transformer Expression</b></span></h2>
<p class="p5"><span class="s1">A <b>transformer</b> is a functional object in Nial which, when applied to an operation, forms a new operation called a transform. Transformers provide a systematic way of modifying or generalizing operations. Q'Nial provides a number of predefined transformers that have proven useful in extending the expressive power of the language. A mechanism is provided to extend Nial with user defined transformers.</span></p>
<p class="p5"><span class="s1">Applying a transformer has no action associated with it other than capturing the environment where it is applied to an argument operation. When the resulting transform is applied, the captured environment is used as the environment in which to invoke the argument operation when it is used within the algorithm of the transformer.</span></p>
<p class="p5"><span class="s1">   <i>&lt;transformer-expression&gt;</i> ::= <i>&lt;named-transformer&gt;</i><br>
                              | <i>&lt;transformer-form&gt;</i></span></p>
<p class="p5"><span class="s1">   <i>&lt;named-transformer&gt;</i> ::= <i>&lt;identifier&gt;</i></span></p>
<p class="p5"><span class="s1">A <b>named-transformer</b> is one associated with a name by a definition or is a predefined transformer. A transformer cannot be used without being given a name. A predefined transformer modifies its operation argument according to the algorithm given in its description.</span></p>
<p class="p5"><span class="s1">A user defined transformer has the effect of the named-transformer expression with which it is associated. A transformer definition associates a name with a transformer-form or with another transformer name. In the latter case, it is the name of the other transformer that is bound not the trans former-expression defined by the other transformer.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Transformer Form</b></span></h2>
<p class="p5"><span class="s1">   <i>&lt;transformer-form&gt;</i> ::= <b>TRANSFORMER</b> { <i>&lt;identifier&gt;</i> }+ <i>&lt;operation-form&gt;</i><br>
                        | <b>TRANSFORMER</b> { <i>&lt;identifier&gt;</i> }+ <b>(</b> <i>&lt;operation-expression&gt;</i> <b>)</b></span></p>
<p class="p5"><span class="s1">A <b>transformer-form</b> is the syntactic structure used to describe a transformer in terms of an operation expression involving formal operation parameters. The names that follow the keyword <i>TRANSFORMER</i>in the transformer-form are called <b>formal operation parameters</b>. The body of a transformer-form is the operation-expression which uses these names. The first construct requires that the operation-expression be an operation-form; the second allows any operation-expression enclosed in parentheses to be used.</span></p>
<p class="p5"><span class="s1">The effect of applying a transformer-form to an operation-expression is the effect of the operation formed from the body of the transformer, such that wherever one of the formal operation parameters occurs, it is replaced with the corresponding argument operation-expression. If there is only one parameter then its occurrences are replaced by the argument. If there is more than one parameter then the operation-expression must be an atlas of the same length and the formal parameters are replaced by the corresponding operations of the argument atlas. If there is a mismatch between the number of formal operation parameters and the argument, the result of applying the transform is the fault <i>?tr_parameter</i>.</span></p>
<p class="p5"><span class="s1">The associations are made with the argument opera tion-expression in the environment where the trans former is applied. Thus, if the transformer is recursive, the formal parameter may have a different association on each recurrence.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Summary of Juxtapositional Syntax</b></span></h2>
<p class="p5"><span class="s1">The following table summarizes the uses of juxtaposition in Nial, where A and B are array-expressions, f and g are operation expressions, and T is a transformer</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1"><b>Form</b></span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1"><b>Name</b></span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1"><b>Object Class</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">A B</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">strand</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">array</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">A f</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">currying</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">operation</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">f A</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">prefix use</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">array</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">f g</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">composition</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">operation</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">T f</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">transform</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">operation</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">A f B</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">infix use</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">array</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td27">
        <p class="p8"><span class="s1">T f A</span></p>
      </td>
      <td valign="middle" class="td28">
        <p class="p8"><span class="s1">transform use</span></p>
      </td>
      <td valign="middle" class="td29">
        <p class="p8"><span class="s1">array</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">An informal description of the rules for parsing the juxtapositional forms is given in Chapter 3 of Part 1 of the Manual.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Synonyms</b></span></h2>
<p class="p5"><span class="s1">The <b>synonyms</b> given below abbreviate typing for interactive use or avoid difficulties with some termi nals on older compu ter systems that do not support the full character set used in the syntax rules. The following synonyms are available for keywords or delimiters used in the syntax rules:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1"><b>Usual</b></span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1"><b>Alternate</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">[</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">&lt;&lt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">]</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">&gt;&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">:=</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">GETS</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">{</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">BEGIN</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">}</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">END</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">OPERATION</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">OP</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td30">
        <p class="p8"><span class="s1">TRANSFORMER</span></p>
      </td>
      <td valign="middle" class="td17">
        <p class="p8"><span class="s1">TR</span></p>
      </td>
    </tr>
  </tbody>
</table>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 6 File Input and Output Operations</b></span></h1>
<p class="p5"><span class="s1">Q'Nial includes operations to create and manipulate files of textual information, to communicate with devices as read/write files and to provide direct access to component files holding arrays or strings. The files are stored externally to the workspace using the mechanisms of the host system.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Sequential Files</b></span></h2>
<p class="p5"><span class="s1">A sequential file corresponds to a sequence of lines of text with lines separated by an end-of-line indicator. The files are read and written in units of lines which are converted to and from Nial strings. A sequential file is opened for read, write, append, communications or as a pipe.</span></p>
<p class="p5"><span class="s1">The sequential file capabilities are:</span></p>
<p class="p8"><span class="s1"><b><i>open Fn Mode</i></b></span></p>
<p class="p5"><span class="s1">Open file <i>Fn</i> in mode <i>Mode</i> and return an integer file number <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>close F</i></b></span></p>
<p class="p5"><span class="s1">Close the file designated by <i>F</i></span></p>
<p class="p8"><span class="s1"><b><i>readfile F [N]</i></b></span></p>
<p class="p5"><span class="s1">If N is missing, return a string holding one record from the file designated by <i>F</i>, omitting the end of line indication; otherwise, return <i>N</i> characters from the file <i>F</i> including end of line characters; or return a fault <i>?eof</i> indicating end of file.</span></p>
<p class="p8"><span class="s1"><b><i>writefile F A [M]</i></b></span></p>
<p class="p5"><span class="s1">Write character array <i>A</i> to the file designated by <i>F</i>. If <i>M</i> is <i>true</i> or missing, write the end of line indica tion; if <i>M</i> is <i>false</i>, do not write the end of line indication.</span></p>
<p class="p8"><span class="s1"><b><i>getfile Fn</i></b></span></p>
<p class="p5"><span class="s1">Obtain all the records of file <i>Fn</i> as a list of strings.</span></p>
<p class="p8"><span class="s1"><b><i>putfile Fn S</i></b></span></p>
<p class="p5"><span class="s1">Write strings <i>S</i> to the file <i>Fn</i>.</span></p>
<p class="p8"><span class="s1"><b><i>appendfile Fn S</i></b></span></p>
<p class="p5"><span class="s1">Append strings <i>S</i> to end of file <i>Fn</i>.</span></p>
<p class="p8"><span class="s1"><b><i>Filestatus</i></b></span></p>
<p class="p5"><span class="s1">Return a list of triples giving the file number, filename and mode of use of each open file.</span></p>
<p class="p5"><span class="s1">A filename is specified by a phrase or a string. The name is given to the operation <i>open</i> along with a mode indication given by the following table</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><b>Indicator</b></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1"><b>Open Mode</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>"r</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">read</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>"w</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">write</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>"a</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">append</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>?c</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">communications</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>?pr</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">pipe read</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>?pw</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">pipe write</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td31">
        <p class="p8"><span class="s1"><i>?d</i></span></p>
      </td>
      <td valign="middle" class="td32">
        <p class="p8"><span class="s1">direct access</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">A file number, used in all subsequent operations on the file, is returned. A file opened in read mode can be used only for input with the operation <i>readfile</i>. A file opened in write or append mode can be used only for output with the operation <i>writefile</i>. Write mode creates a new file; append mode opens an existing file at the end, so that additional records can be written to it. If the file does not exist when <i>open</i> is used, append mode is equi valent to write mode.</span></p>
<p class="p5"><span class="s1">A file must be open to be used by <i>readfile</i> or <i>writefile</i>. Fault <i>?eof</i> is returned if an attempt is made to read beyond the end of the file. If the second argument to <i>writefile</i> is a table, one record is written for each row of the table.</span></p>
<p class="p5"><span class="s1">Communication mode assumes that the file is being used for both reading and writing. The version of <i>readfile</i> in which a number of characters can be specified, provides the low level control of the reading process. The version of <i>writefile</i> in which no end of line control is added, allows control over the charac ters transmitted to a communications device.</span></p>
<p class="p5"><span class="s1">Pipe read and pipe write modes are used for executing a host command that either reads the result of the execution using <i>readfile</i> or provides input to the execution using <i>writefile</i>. The command is given as a string in place of the file name. See the discussion of the operation host in Chapter 9.</span></p>
<p class="p5"><span class="s1">The operations <i>getfile</i> and <i>putfile</i> are intended for use on relatively small files in which all the data can be held in the workspace. <i>Getfile</i> is equivalent to opening the file in read mode, reading all its records and then closing the file. <i>Putfile</i> is the similar composite opera tion for the writing process.</span></p>
<p class="p5"><span class="s1">The first three file numbers are used as follows:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td33">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">stdin</span></p>
      </td>
      <td valign="middle" class="td34">
        <p class="p8"><span class="s1">the standard input stream</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td33">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">stdout</span></p>
      </td>
      <td valign="middle" class="td34">
        <p class="p8"><span class="s1">the standard output stream</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td33">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p8"><span class="s1">stderr</span></p>
      </td>
      <td valign="middle" class="td34">
        <p class="p8"><span class="s1">the error output stream</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">Thus, <i>readfile 0</i> accepts input from the keyboard, and <i>writefile 1 Data</i> sends the string <i>Data</i> to the display screen. These are useful for testing out a file-oriented program during debugging.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Q'Nial Specific Direct Access File Operations</b></span></h2>
<p class="p5"><span class="s1">Q'Nial supports a component style of direct access to binary files in two forms: files in which the components are alphanumeric records that are treated as Nial character strings; and files in which the components are representations of arbitrary array values.</span></p>
<p class="p5"><span class="s1">The same underlying mechanism is used to support both forms of direct access files. The direct access files are Q'Nial specific but use the host system files for their representation. Two files are used: a record file given the extension <i>.rec</i> and an index file given the extension <i>.ndx</i>.</span></p>
<p class="p5"><span class="s1">It is possible to treat an externally created file as a <i>record</i> direct file provided it is named appropriately and a suitable index file is created.</span></p>
<p class="p5"><span class="s1">A direct access file is prepared for use by calling the operation <i>open</i> with a file name without an extension and the mode indication <i>"d</i>. If the two corresponding host files exist, they are opened. If they do not exist they are created and initialized.</span></p>
<p class="p5"><span class="s1">The kind of direct access file is determined by the first write operation applied to it. The use of <i>writearray</i> creates a file of array components, whereas the use of <i>writerecord</i> creates a file of record components. All subsequent read and write accesses to the direct access file must be of the same kind.</span></p>
<p class="p5"><span class="s1">The operations that support direct access files are described as follows</span></p>
<p class="p8"><span class="s1"><b><i>open Fn "d</i></b></span></p>
<p class="p5"><span class="s1">Open the file <i>Fn</i> for direct access and return an integer.</span></p>
<p class="p8"><span class="s1"><b><i>filetally F</i></b></span></p>
<p class="p5"><span class="s1">Return the highest component number in the file designated by integer <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>readrecord F N</i></b></span></p>
<p class="p5"><span class="s1">Return string component <i>N</i> of the file designated by integer <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>readarray F N</i></b></span></p>
<p class="p5"><span class="s1">Return array component <i>N</i> from the file designated by integer <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>writerecord F N B</i></b></span></p>
<p class="p5"><span class="s1">Write the string <i>B</i> to component <i>N</i> of the file designated by integer <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>writearray F N B</i></b></span></p>
<p class="p5"><span class="s1">Write the array <i>B</i> to component <i>N</i> of the file designated by integer <i>F</i>.</span></p>
<p class="p8"><span class="s1"><b><i>eraserecord F N</i></b></span></p>
<p class="p5"><span class="s1">Erase component <i>N</i> in the file designated by integer <i>F</i>.</span></p>
<p class="p5"><span class="s1">In the above operations, <i>N</i> can be a list of component numbers. For a read, the corresponding list of components is obtained. For a write, <i>B</i> must be a corresponding number of components to be written. The components can be read or written in any order. Note that using an integer with the read operation returns the component as the result, and using a solitary integer, a list with one integer, returns a solitary list with the component as the item.</span></p>
<p class="p5"><span class="s1">There is no requirement that all the component numbers below the number returned by <i>filetally F</i> be in use. If there is no component at a position specified in <i>N</i> in a <i>readarray</i>, the result is the fault <i>?missing</i>. For <i>readrecord</i>, the result is the empty string. The result in both operations is the fault <i>?eof</i> if <i>N</i> is greater than the result of <i>filetally F</i>. In a <i>writearray</i> of <i>writerecord</i> operation, if <i>N</i> is greater than or equal to <i>filetally F</i>, then the record is written and the <i>filetally</i> is increased to one higher than <i>N</i>. Note that the index file used to implement direct access files has an entry for each possible record and hence leaving huge gaps in the record numbers can waste a substantial amount of space.</span></p>
<p class="p5"><span class="s1"><i>Eraserecord</i> is used for both kinds of files. If the component removed is the last one, any components immediately preceding it that are not in use are also removed and the filetally is adjusted accordingly. For a file of records it is not possible to distinguish between an unused record and a record consisting of an empty string.</span></p>
<p class="p5"><span class="s1">In the write operations, if a component already exists, its value is replaced. The physical host file used to hold the components is not necessarily in the same order as the component numbers. As components are overwritten, their previous space is used if possible, otherwise the information is appended to the end of the <i>.rec</i> file. For fixed length components, the order of the components is not changed because of an update.</span></p>
<p class="p5"><span class="s1">As components of a direct access file are rewritten out of place because of increased size, or as they are erased, unused space accumulates in the <i>.rec</i> file. A record is maintained on the amount of unused space in the file and, after every write or erase, if the unused space has become significant relative to the size of the file, an automatic compression process is executed which rebuilds the file so that the components are in index order.</span></p>
<p class="p5"><span class="s1">It is possible to use Q'Nial to access files created by another process. To do this, the file must be renamed to have the extension <i>.rec</i> and an index file that is appropriate to the data structure within the file must be built. If the file has a logical structure of fixed size that repeats, the index file need have only as many records as make up one unit of the logical structure. If the record number used in a <i>readrecord</i> is above <i>filetally</i>, the record file is checked to see if the file extends beyond the length indicated by the <i>filetally</i>. If so, the file is assumed to consist of a sequence of blocks of records of the same structure as indicated in the index file and the record selected is determined by <i>N mod filetally F</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Direct Access Operations for Host Files</b></span></h2>
<p class="p5"><span class="s1">Q'Nial also provides operations that can access the raw byte data of files on the host system. In these operations the name of the file is used as the argument and file open and closes are done implicitly.</span></p>
<p class="p8"><span class="s1"><b><i>readfield Fnm P N</i></b></span></p>
<p class="p5"><span class="s1">Return <i>N</i> bytes of the file <i>Fnm</i> starting at position <i>P</i> as a string.</span></p>
<p class="p8"><span class="s1"><b><i>writefield Fnm P S</i></b></span></p>
<p class="p5"><span class="s1">Write the string <i>S</i> to the file named <i>Fnm</i> at position <i>P</i>.</span></p>
<p class="p8"><span class="s1"><b><i>filelength Fnm</i></b></span></p>
<p class="p5"><span class="s1">Return the number of bytes in the file named <i>Fnm</i>.</span></p>
<p class="p5"><span class="s1">The direct access operations for host files are useful in applications where pre-existing files need to be accessed or modified under program control. The <i>readfield</i> operation can be used to read in any portion of a file as a string without interpretation of newline characters. If the position plus the length requested is greater than the filelength the fault <i>?eof</i> is returned.</span></p>
<p class="p5"><span class="s1">The operation <i>writefield</i> can write a string of any length to any position in a file. If it is written in a position beyond the current file length, the intervening space may be filled with arbitrary data. If the file does not exist, <i>writefield</i> will create it.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 7 Operations for the Interpreter Mechanisms</b></span></h1>
<p class="p5"><span class="s1">Q'Nial has operations that provide direct access by the user to most of the underlying mechanisms that support the evaluation of Nial constructs. These operations behave like most other operations in Q'Nial but they are dependent on the internal representations used in the Q'Nial implementation and may not produce identical results from one version to another. They should not be considered part of the Nial language; rather, they are extensions made specifically in the Q'Nial implementation.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Top Level Loop</b></span></h2>
<p class="p5"><span class="s1">Q'Nial7 is implemented as an interactive program running on a console or in a terminal emulation window. The direct input to the interpreter mechanism is a string representing Nial program text. The execution of the text is carried out in a three stage process. First, the string is scanned to produce a list of tokens that represent the component parts of the text. The result is a list beginning with a Token Stream Tag (the number 99) and followed by an alternating sequence of integer codes and phrases.</span></p>
<p class="p5"><span class="s1">There is no limitation on the size of tokens corresponding to the literal types. That is, a constant token for a literal string, phrase or fault can be as long as required for an application. However, identifiers are stored only up to a maximum length of 80 characters. The following segments from a log of a session illustrate the top level loop mechanism:</span></p>
<p class="p6"><span class="s1">set "decor;</span></p>
<p class="p6"><span class="s1">Token_list := scan 'A := 3*5.2'</span></p>
<p class="p6"><span class="s1">99 2 "A 1 ":= 16 "3 2 "* 18 "5.2</span></p>
<p class="p5"><span class="s1">The codes for tokens used by scan are:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1"><b>Code</b></span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1"><b>Meaning</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">reserved word or delimiter</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">identifier</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">14</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">string</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">15</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">phrase</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">16</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">integer</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">18</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">real number</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">22</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">fault</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">42</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">atomic character</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td35">
        <p class="p8"><span class="s1">40</span></p>
      </td>
      <td valign="middle" class="td36">
        <p class="p8"><span class="s1">atomic boolean or bitstring</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">To select the token pairs from the result of <i>scan</i>, the following expression is used:</span></p>
<p class="p6"><span class="s1">Token_pairs := lo cutall rest Token_list</span></p>
<p class="p6"><span class="s1">+----+-----+-----+----+-------+</span></p>
<p class="p6"><span class="s1">|2 "A|1 ":=|16 "3|2 "*|18 "5.2|</span></p>
<p class="p6"><span class="s1">+----+-----+-----+----+-------+</span></p>
<p class="p5"><span class="s1">To test which tokens are constants, the comparison is:</span></p>
<p class="p6"><span class="s1">EACH first Token_pairs &gt; 2</span></p>
<p class="p6"><span class="s1">oolol</span></p>
<p class="p5"><span class="s1">The last token pair represents a real number:</span></p>
<p class="p6"><span class="s1">Realtoken := last Token_pairs</span></p>
<p class="p6"><span class="s1">18 "5.2</span></p>
<p class="p5"><span class="s1">The value of a constant token pair can be obtained by executing the string of the token or by using parse as described below:</span></p>
<p class="p6"><span class="s1">tonumber second Realtoken</span></p>
<p class="p6"><span class="s1">5.2</span></p>
<p class="p5"><span class="s1">The second stage of executing the string of text is called the parsing stage. The token list is processed and a nested array that represents the structure of the expression denoted by the text is returned. The resulting data structure is a pair: the first item is a Parse Tree tag (the number 100), indicating that the data structure represents a parse data structure; the second item is a nested list of lists where each list is a node of the parse tree for the expression. Each node of the parse tree has an integer tag as the first item to indicate the type of construct that the node represents. The remaining items of a node are themselves nodes of the corresponding components of the construct or represent constants or names:</span></p>
<p class="p6"><span class="s1">Parse_tree := parse Token_list</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+---+------------------------------------------------------------+</span></p>
<p class="p6"><span class="s1">|100|+-+--------------------------------------------------------+|</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>||9|+--+-----------------+---------------------------------+||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|| ||13|+--+------------+|+--+----------+------+----------+|||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|| ||<span class="Apple-converted-space">  </span>||22|2 7670 43248|||49|3 1 3 82 1|1 3 "3|1 5.2 "5.2||||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|| ||<span class="Apple-converted-space">  </span>|+--+------------+|+--+----------+------+----------+|||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|| |+--+-----------------+---------------------------------+||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|+-+--------------------------------------------------------+|</span></p>
<p class="p6"><span class="s1">+---+------------------------------------------------------------+</span></p>
<p class="p5"><span class="s1">In the above example, the tags have the meanings described in the following table:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1"><b>Tag</b></span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1"><b>Meaning</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">100</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">parse tree</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">9</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">expression sequence</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">13</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">assignment expression</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">22</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">variable list</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">variable</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">49</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">binary operation application</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">3</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">basic operation</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td37">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td38">
        <p class="p8"><span class="s1">constant</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The parse trees are not intended for modification or for examination by program control. They provide an effective representation for expressions that can be used for evaluation or for recovery of the textual form as described below.</span></p>
<p class="p5"><span class="s1">However, they can be used in simple ways such as converting a constant token to its value. For example, to get the value corresponding to <i>Realtoken</i> we can form the corresponding parse tree by:</span></p>
<p class="p6"><span class="s1">parse (99 hitch Realtoken)</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">+---+--------------+</span></p>
<p class="p6"><span class="s1">|100|+-+----------+|</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>||9|1 5.2 "5.2||</span></p>
<p class="p6"><span class="s1">| <span class="Apple-converted-space">  </span>|+-+----------+|</span></p>
<p class="p6"><span class="s1">+---+--------------+</span></p>
<p class="p5"><span class="s1">The real number can be selected by</span></p>
<p class="p6"><span class="s1">R := second second parse (99 hitch Realtoken)</span></p>
<p class="p6"><span class="s1">5.2</span></p>
<p class="p5"><span class="s1">The third stage in the execution of the string of text is the evaluation stage. The evaluation is done by recursively "walking" the parse tree and evaluating each construct according to the semantic rules of Q'Nial:</span></p>
<p class="p6"><span class="s1">eval Parse_tree</span></p>
<p class="p6"><span class="s1">15.6</span></p>
<p class="p5"><span class="s1">We have illustrated that a string containing a Nial array expression can be evaluated by the composition of *eval**, parse* and <i>scan</i>, which is how the operation <i>execute</i> is defined:</span></p>
<p class="p6"><span class="s1">execute IS eval parse scan</span></p>
<p class="p6"><span class="s1">execute 'A := 3 \* 5.2'</span></p>
<p class="p6"><span class="s1">15.6</span></p>
<p class="p5"><span class="s1">It is not intended that users understand or manipulate the internals of parse tree representations of con structs. Q'Nial has few safeguards if <i>eval</i> is applied to data structures that are not created directly by the interpreter itself.</span></p>
<p class="p5"><span class="s1">In order to reduce the need for users to deal with parse trees, Q'Nial has a method to obtain the internal representation of a valid construct. This is the <b>cast</b> array-expression, designated by placing an exclamation mark before the construct.</span></p>
<p class="p5"><span class="s1">Q'Nial also has operations to recover the textual form from the internal representation. The operations <i>deparse</i> and <i>descan</i> accomplish this in two steps: <i>deparse</i> converts a parse tree to a token stream that has a few extra token symbols to indicate indentation and line breaks and <i>descan</i> converts a token stream into a list of strings. For example:</span></p>
<p class="p6"><span class="s1">New_token_list := deparse Parse_tree</span></p>
<p class="p6"><span class="s1">99 2 "A 1 ":= 16 "3 2 "\* 18 "5.2</span></p>
<p class="p6"><span class="s1">Link descan New_token_list</span></p>
<p class="p6"><span class="s1">'A := 3 \* 5.2 '</span></p>
<p class="p5"><span class="s1">When <i>descan</i> and <i>deparse</i> are applied to the parse trees for array expressions with control constructs such as <i>if-expressions</i> and <i>for-expressions</i>, the result is a list of lines which when written provide the construct in an indented form. In addition, all identifiers appear with their use encoded as follows:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1"><b>Type</b></span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1"><b>Canonical Form</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1">variable</span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1">First letter upper case, the rest lower case</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1">expression</span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1">First letter upper case, the rest lower case</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1">operation</span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1">all lower case</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1">transformer</span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1">all upper case</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td39">
        <p class="p8"><span class="s1">reserved word</span></p>
      </td>
      <td valign="middle" class="td40">
        <p class="p8"><span class="s1">all upper case</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1"><b>Figure 8-3 Canonical Form for Nial Identifiers</b></span></p>
<p class="p5"><span class="s1">The operation:</span></p>
<p class="p6"><span class="s1">canonical IS link descan deparse parse scan</span></p>
<p class="p5"><span class="s1">provides a canonical string representation for any valid Nial action, in the sense that for such a string <i>S</i>, the two following identities hold:</span></p>
<p class="p6"><span class="s1">canonical canonical S = canonical S</span></p>
<p class="p6"><span class="s1">execute canonical S = execute S</span></p>
<p class="p5"><span class="s1">The first identity states that the <i>canonical</i> operation has no effect on a string already in canonical form. The second states that the canonical form of an action has the same meaning as the action itself.</span></p>
<p class="p5"><span class="s1">The <i>deparse</i> and <i>descan</i> operations are used by <i>defedit</i> to transform the parse tree of a definition to textual form. They are also accessed implicitly in the operation <i>see</i>.</span></p>
<p class="p5"><span class="s1">The evaluation operations:</span></p>
<p class="p8"><span class="s1"><b><i>scan A</i></b></span></p>
<p class="p5"><span class="s1">The token stream corresponding to the string <i>A</i> as a program fragment.</span></p>
<p class="p8"><span class="s1"><b><i>parse A</i></b></span></p>
<p class="p5"><span class="s1">The parse tree corresponding to token stream <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>eval A</i></b></span></p>
<p class="p5"><span class="s1">The value obtained by evaluating a parse tree, cast or a named array expression <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>deparse A</i></b></span></p>
<p class="p5"><span class="s1">Canonical token stream corresponding to parse tree <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>descan A</i></b></span></p>
<p class="p5"><span class="s1">The list of strings corresponding to token stream <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>execute A</i></b></span></p>
<p class="p5"><span class="s1">The value derived by executing the string <i>A</i> as a program fragment.</span></p>
<p class="p5"><span class="s1">For console versions the top level loop of Q'Nial is informally described by:</span></p>
<p class="p6"><span class="s1">EndSignal := false ;</span></p>
<p class="p6"><span class="s1">Prompt := ' ' ;</span></p>
<p class="p6"><span class="s1">WHILE not EndSignal DO</span></p>
<p class="p6"><span class="s1">X := eval parse scan readscreen Prompt ;</span></p>
<p class="p6"><span class="s1">IF X \~= ??noexpr THEN</span></p>
<p class="p6"><span class="s1">writescreen picture X ;</span></p>
<p class="p6"><span class="s1">ENDIF</span></p>
<p class="p6"><span class="s1">ENDWHILE</span></p>
<p class="p5"><span class="s1">where it is assumed that the expressions <i>Bye</i> and <i>Continue</i> will set the variable <i>EndSignal</i> to <i>True</i>. Also this version of a top level loop does not implement the use of ?]? to capture the last value computed. A loop is easily written for an application to use a different prompt or a different convention with respect to output of the results of computations. In this way, the Q'Nial interpreter can be tailored for different styles of use.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Picture Operations</b></span></h2>
<p class="p5"><span class="s1">The five operations described below give access to the picture drawing capabilities.</span></p>
<p class="p8"><span class="s1"><b><i>picture A</i></b></span></p>
<p class="p5"><span class="s1">The character table that is the picture of <i>A</i> with the current mode settings. In the picture of <i>A</i>, all non-atomic arrays are left justified and numeric atoms are right justified.</span></p>
<p class="p8"><span class="s1"><b><i>sketch A</i></b></span></p>
<p class="p5"><span class="s1">The picture of <i>A</i> in the form that it takes when the mode switches are set to diagram and nodecor.</span></p>
<p class="p8"><span class="s1"><b><i>diagram A</i></b></span></p>
<p class="p5"><span class="s1">The picture of <i>A</i> in the form it takes when diagram mode is set and the decor mode uses its current setting.</span></p>
<p class="p8"><span class="s1"><b><i>display A</i></b></span></p>
<p class="p5"><span class="s1">A string which, when executed, returns <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>paste Sw A</i></b></span></p>
<p class="p5"><span class="s1">A character table constructed by pasting an array <i>A</i> of character tables together according to the settings in switch <i>Sw</i> for vertical edge spacing, horizontal edge spacing, vertical line switch, horizontal line switch, vertical justification indicator and horizontal justification indicator.</span></p>
<p class="p8"><span class="s1"><b><i>positions A</i></b></span></p>
<p class="p5"><span class="s1">The array of addresses in the picture of A where each item of A is placed.</span></p>
<p class="p5"><span class="s1">The <i>paste</i> operation is used internally by the <i>picture</i> operation. <i>Paste</i> allows a programmer to produce non-standard pictures of arrays.</span></p>
<p class="p5"><span class="s1">The justification indicator is an array of the shape of <i>A</i>, with integer codes for each item; or a single integer code applicable to all items. The justification codes are 0, 1 and 2 for left or top, centred and right or bottom respectively.</span></p>
<p class="p5"><span class="s1">The vertical edge spacing is an integer indicating the number of blank lines between rows of items. The horizontal edge spacing is an integer indicating the number of blank spaces between columns of items. The line switch is 1 to draw lines, or 0 to suppress lines.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Phrases, Names and Casts</b></span></h2>
<p class="p5"><span class="s1">The names used in Q'Nial in forming associations are represented internally as phrases. The associations are stored in arrays called <b>symbol tables</b> that record the environment in which the name is used and its role in that environment.</span></p>
<p class="p5"><span class="s1">Q'Nial uses two different mechanisms to refer to names at the scan and parse levels. At the scan level a name is a phrase, which has to be looked up in the correct environment by examining the symbol tables in an appropriate order while parsing the tokens. After the parse is done, a name is denoted by a parse tree that points to its symbol table entry. The cast notation <i>!Name</i> is used to denote the parse tree that represents the name. Note that at the top level , parentheses must be included around the use of the cast notation, e.g. (<i>!Name</i>), to avoid ambiguity with the use of ! to indicate a host command.</span></p>
<p class="p5"><span class="s1">Both representations of names are useful. The phrase is readable. It is looked up in the symbol tables in the context where it is used and hence refers to the object in a <b>dynamic</b> way. The cast, because it is analyzed in the context in which it appears, refers to a variable or definition in a <b>static</b> way.</span></p>
<p class="p5"><span class="s1">Q'Nial contains operations that mimic the underlying meaning of variables, expressions and operations in Q'Nial. The operations use strings, phrases or casts to represent the name of the object under consideration (except that <i>see</i> and <i>getdef</i> do not take casts).</span></p>
<p class="p8"><span class="s1"><b><i>value A</i></b></span></p>
<p class="p5"><span class="s1">Return the value of a variable nam ed by string, phrase or cast <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>A assign B</i></b></span></p>
<p class="p5"><span class="s1">Assign the array <i>B</i> to the variable named by string, phrase or cast <i>A</i>; return <i>B</i>.</span></p>
<p class="p8"><span class="s1"><b><i>A apply B</i></b></span></p>
<p class="p5"><span class="s1">Apply the operation named by string, phrase or cast <i>A</i> to array <i>B</i>; re turn the result of the operation.</span></p>
<p class="p8"><span class="s1"><b><i>getdef A</i></b></span></p>
<p class="p5"><span class="s1">Return the parse tree associated with the definition name by string or phrase <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>see A</i></b></span></p>
<p class="p5"><span class="s1">Display the definition named by the stri ng or phrase <i>A</i>.</span></p>
<p class="p8"><span class="s1"><b><i>update P A B</i></b></span></p>
<p class="p5"><span class="s1">Put array <i>B</i> at address <i>A</i> in the array associated with the vari able named by the phrase, string or cast <i>P</i>; return the new value of the array.</span></p>
<p class="p8"><span class="s1"><b><i>updateall P A B</i></b></span></p>
<p class="p5"><span class="s1">Put items of <i>B</i> at addresses <i>A</i> in the array associated with the variable named by the phrase, string or cas <i>P</i>; return the new value of the array.</span></p>
<p class="p8"><span class="s1"><b><i>deepupdate P A B</i></b></span></p>
<p class="p5"><span class="s1">Put array <i>B</i> at path <i>A</i> in the array associated with the variable named by the string, phrase or cast <i>P</i>; return new value of the array.</span></p>
<p class="p8"><span class="s1"><b><i>getname A</i></b></span></p>
<p class="p5"><span class="s1">Converts a parse tree symbol table reference A (a triple) to the corresponding name.</span></p>
<p class="p8"><span class="s1"><b><i>getsyms Nm</i></b></span></p>
<p class="p5"><span class="s1">Gets the parameters and local variables of definition Nm.</span></p>
<p class="p5"><span class="s1"><i>Assign</i> mimics the behaviour of <i>gets</i> or <i>:=</i> but does it dynamically. The left argument to <i>assign</i> is a phrase, string or a cast naming the variable to be changed or crea ted. The major difference between the operation <i>assign</i> and assigning using the <i>:=</i> construct is that the former occurs entirely during program execution, whereas the latter has a translation stage in which the scope of the variable name is determined and then an execution phase when the assignment is done. One effect of the difference is that a <i>new</i> variable created by the operation <i>assign</i> is always placed in the global environment. Another difference is that the operation <i>assign</i> does not have the restriction that the phrase or string obey the lexical rule for an identifier and hence it is possible to build associations that do not interfere with variables in the program text.</span></p>
<p class="p5"><span class="s1">An important use of <i>assign</i> is to mimic a <b>by-variable</b> form of parameter passing in place of Nial's <b>by-value</b> form. The result depends on what kind of name is provided, a phrase or a cast. If the name is provided as a phrase, the variable that is selected is determined by <i>assign</i> when it does the assignment by looking first in the local environment and then in the surrounding ones. If the name is provided as a cast, the variable selected is the one that exists at the point where the cast is formed. Thus, by-variable parameter passing is achieved by using the cast of the variable as an argument in the call; whereas in the body of the operation the formal parameter is assigned using <i>assign</i> and evaluated using <i>value</i>.</span></p>
<p class="p5"><span class="s1">The operation <i>apply</i> mimics the application of an operation to an array. The operation to be applied is provided as a phrase or a cast. One use of apply is to provide a dynamic switch, where the operation to be applied is selected from a list using <i>pick</i> and then applied with <i>apply</i>.</span></p>
<p class="p5"><span class="s1">The operation <i>see</i> writes the canonical form of a definition to the terminal screen. The character table is displayed as if:</span></p>
<p class="p6"><span class="s1">ITERATE writescreen descan deparse getdef Defnm</span></p>
<p class="p5"><span class="s1">were executed with <i>sketch</i> and <i>nodecor</i> display modes. It does not affect the settings of the display modes.</span></p>
<p class="p5"><span class="s1">The operations <i>update, updateall</i> and <i>deepupdate</i> mimic the indexed assignment notations for *at**, at-all* and <i>at-path</i> indexing. They are provided to allow selective updating of global variables with no copying.</span></p>
<p class="p5"><span class="s1">The operations <i>getname</i> and <i>getsyms</i> are provided for detailed parse tree analysis and are not intended for general use.</span></p>
<p class="p5"><span class="s1">Operations that give user access to the internal mechanisms should be used with due recognition that they may make programs implementation dependent.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Dynamic Execution of Name Associations</b></span></h2>
<p class="p5"><span class="s1">The operation <i>execute</i> can be used within the execution of a block to make an assignment to variables or to invoke the definition mechanism. If <i>execute</i> is used to make a new definition or to create a new variable, the resulting variable or definition is placed in the global environment. However, if the block has local variables or local definitions, <i>execute</i> can be used to change a local version dynamically. A similar situation occurs with dynamic alteration of variables using <i>assign</i>.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 8 Management of the Programming Environment</b></span></h1>
<p class="p5"><span class="s1">The topics in this chapter describe aspects of the programming environment for Q'Nial that are common to all versions.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>The Q'Nial Programming Environment</b></span></h2>
<p class="p5"><span class="s1">When Q'Nial is invoked, an area of memory is set aside for use during the interactive session. This area is called the <b>active workspace</b>. It holds all the definitions and variables that are created during a session. The size of the workspace can grow as more space is required as long as system space is available.</span></p>
<p class="p5"><span class="s1">After initialization, Q'Nial begins interaction, by entering a top level loop. It accepts program text interactively and executes it. Definitions and variables are created by entering actions interactively or by reading in a program text file using <i>loaddefs</i>.</span></p>
<p class="p5"><span class="s1">The active workspace can be saved and restarted at a later time. It can be cleared or reset to its status at the beginning of the session. A Q'Nial session ends when either <i>Bye</i> or <i>Continue</i> is executed.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Invoking Q'Nial</b></span></h2>
<p class="p5"><span class="s1">There are a number of command line options in invoking the console version of Q'Nial which provide flexibility for its use in applications. A Q'Nial session is invoked by the command:</span></p>
<p class="p6"><span class="s1">Nial</span></p>
<p class="p5"><span class="s1">It has the following syntax:</span></p>
<p class="p6"><span class="s1">Nial [(+\-)size Wssize] [-defs Filename] [-lws WSFilename] [-i] [-h]</span></p>
<p class="p5"><span class="s1">The parameters are shown within brackets [ ] to indicate that they are all optional. The order of the parameters does not matter. The meanings of the parameters are as follows:</span></p>
<p class="p8"><span class="s1"><b><i>Wsname</i></b></span></p>
<p class="p5"><span class="s1">The named workspace is loaded instead of the <i>clearws.nws</i> file that is normally entered or created on invocation. The workspace can contain a <i>Latent</i> expres sion and hence can trigger an applica tion. This feature gives direct control over where to start the work. If no name is given, Q'Nial looks for file <i>co tinue.nws</i> in the current directory. If it exists, the session is started with it rather than the clear workspace.</span></p>
<p class="p8"><span class="s1">*** (+|-)size Wssize***</span></p>
<p class="p5"><span class="s1">This option begins Q'Nial with a workspace of <i>Wssize</i> words. <i>Wssize</i> is an integer (.&gt;= 50000) with a possible suffix of M for megawords or K for kilowords. If <i>+size Wssize</i> is used, the workspace size is fixed at the specified size. If an operation cannot complete with the given size, a jump to the top level occurs with the message:</span></p>
<p class="p5"><span class="s1">Warning: workspace full Returning to top level.</span></p>
<p class="p8"><span class="s1"><b><i>-defs Filename</i></b></span></p>
<p class="p5"><span class="s1">After loading the starting workspace and executing its <i>Latent</i> expression if any, the definition file <i>Filename.ndf</i> is loaded using the <i>loaddefs</i> operation. The effect is equivalent to executing the expression <i>loaddefs</i> <i>Filename</i> when the first prompt is given. The definitions are not displayed when loaded. If the <i>Latent</i> expression enters an interaction loop, the file is not loaded until the loop terminates.</span></p>
<p class="p8"><span class="s1"><b><i>-i</i></b></span></p>
<p class="p5"><span class="s1">Run Q'Nial in interactive mode</span></p>
<p class="p8"><span class="s1"><b><i>-h</i></b></span></p>
<p class="p5"><span class="s1">display the help information for invoking Q?Nial.</span></p>
<p class="p5"><span class="s1">The options for invoking Q'Nial can be used in the following ways:</span></p>
<ol class="ol1">
  <li class="li5"><span class="s2"></span><span class="s1">During application development, the part of an application that is stable could be stored in a workspace, say <i>appl.nws</i>, and the current defini tions being debugged could be in <i>newdefs.ndf</i>. A system script file (.bat under MS-DOS) having the following line could be used to enter Nial with everything loaded:<br>
<i>nial -defs newdefs appl</i><br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">An application could be tailored for particular use by loading a predefined set of definitions using the <i>Wsname</i> or the <i>-defs</i> Filename options.<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">Q'Nial could be used as a filter that executes a program silently and then quits could be invoked with the following linewhere the expression <i>Bye</i> is placed at the end of file <i>Filename.ndf</i>. The actions in the file are executed but the top level loop is not entered.<br>
<i>nial -q -defs Filename</i><br>
</span></li>
</ol>
<p class="p5"><span class="s1">If the -q option is not used, a banner message such as the following is displayed:</span></p>
<p class="p6"><span class="s1">Q'Nial V7.0 Open Source Edition Intel x86 64bit Linux Feb 21 2016</span></p>
<p class="p6"><span class="s1">Copyright (c) NIAL Systems Limited</span></p>
<p class="p6"><span class="s1">clear workspace created</span></p>
<p class="p5"><span class="s1">If none of the <i>-defs, Filename</i> or <i>Wsname</i> options is used, the <i>clearws.nws</i> workspace is loaded. If the <i>clearws.nws</i> file does not exist in the current directory, it is sought in the <i>nialroot</i> directory. If it is not present in either place, it is created automatically by the initialization process and kept internal to Q'Nial. Once the initial workspace has been made, it can be saved using:**</span></p>
<p class="p6"><span class="s1">save "clearws</span></p>
<p class="p5"><span class="s1">When the clear workspace is loaded, the default prompt of five blank characters is displayed and the cursor is placed at the sixth position.</span></p>
<p class="p5"><span class="s1">Q'Nial views its input as a stream from the standard input file <i>stdin</i>. This means that a file of actions can be piped to Q'Nial to use Q'Nial as a filter. One side effect of this design is that one can end a Q'Nial session in the console versions by giving it the end of file signal interactively. On Unix systems by &lt;Ctrl d&gt;. Terminating a Q'Nial session in this manner is equivalent to using <i>Bye</i> and hence the current workspace is not saved.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Naming the Latest Result</b></span></h2>
<p class="p5"><span class="s1">Q'Nial retains the result of the most recent interaction. To give the last value computed a name, eg. <i>Var</i>, the right bracket symbol ( <b>]</b> ) is followed by the variable name.</span></p>
<p class="p6"><span class="s1">]Var</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Session Related Expressions and Operations</b></span></h2>
<p class="p5"><span class="s1">There are a number of operations that assist in workspace management, managing program development, interfacing with host facilities and debugging.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Restarting a Q'Nial Session</b></span></h2>
<p class="p5"><span class="s1">During a session, to start over with the workspace restored to its original contents, one of the expressions <i>Restart</i> or <i>Clearws</i> is used.</span></p>
<p class="p8"><span class="s1"><b><i>Restart</i></b></span></p>
<p class="p5"><span class="s1">Reset the active workspace to have the same content as that provided when Q'Nial was invoked and retun to top level.</span></p>
<p class="p8"><span class="s1"><b><i>Clearws</i></b></span></p>
<p class="p5"><span class="s1">Reset the active workspace to be cleared of all user defined variables and definitions.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Ending a Q'Nial Session</b></span></h2>
<p class="p5"><span class="s1">A session on Q'Nial is ended by the execution of one of the following expressions:</span></p>
<p class="p8"><span class="s1"><b><i>Bye</i></b></span></p>
<p class="p5"><span class="s1">End the session of Q'Nial and return to the host operating system. Information in the current workspace is lost.</span></p>
<p class="p8"><span class="s1"><b><i>Continue</i></b></span></p>
<p class="p5"><span class="s1">Save the workspace as <i>continue.nws</i> in the current directory; end the session of Q'Nial and return control to the host operating system. The workspace is restored in the next session started from the same directory using the invocation of <i>nial</i> without the <i>Ws name</i> option from the same direc tory.</span></p>
<p class="p5"><span class="s1">The continue workspace is a convenience for short term saving of current work. If a session that was started from a continue workspace is ended by using <i>Bye</i>, the file <i>continue.nws</i> is deleted.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Interrupts and Error Recovery</b></span></h2>
<p class="p5"><span class="s1">There are certain invalid computations or resource limitations that prevent Q'Nial from continuing with a computation. A message is displayed when such situations arise. Q'Nial can normally return to the top level loop when errors of this type occur. It calls the user-defined operation <i>recover</i> (if it exists) after cleaning up all the temporary values existing when the error occurred. The recovery may take a few seconds if there is extensive cleanup of temporary values to be done.</span></p>
<p class="p5"><span class="s1">In the definition of an operation or expression, a situation may occur which is best handled by interrupting the computation and returning control to the interaction loop. There are also situations when recovery is needed to prevent returning to the interaction loop. The expression Toplevel causes a return to top level.</span></p>
<p class="p5"><span class="s1">Q'Nial permits interruption of a computation by using an interrupt signal that is host system dependent. The interrupt signal is &lt;Ctrl c&gt; on most console versions of Q'Nial.</span></p>
<p class="p5"><span class="s1">A user initiated interrupt is equivalent to execution of <i>Toplevel</i>. When such an interrupt occurs and <i>recover</i> is present, <i>recover</i> is executed. Interrupts can be inhibited using the operation <i>setinterrupts</i>. It should be used for control of a process which must be completed, such as database updating or user identification.</span></p>
<p class="p8"><span class="s1"><b><i>Toplevel</i></b></span></p>
<p class="p5"><span class="s1">Return control to the user interaction loop after applying the operation <i>recover</i> if it is present in the workspace.</span></p>
<p class="p8"><span class="s1"><b><i>recover Msg</i></b></span></p>
<p class="p5"><span class="s1">The occurrence of any condition that forces a return to the interaction loop. The argument is the warning message which can be used to determine the cause of the jump.</span></p>
<p class="p8"><span class="s1"><b><i>setinterrupts A</i></b></span></p>
<p class="p5"><span class="s1">Permit or prevent the interruption of computation. If <i>A</i> is <i>true</i>, interrupts are permitted; if it is <i>false</i>, interrupts are blocked. The default is to permit interrupts.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Fault Triggering</b></span></h2>
<p class="p5"><span class="s1">Nial assumes that every computation that terminates results in an array value. However, there are many cases where a computation does not have a sensible answer. If division by zero occurs, for example, there is no suitable number to return. Nial uses special atomic arrays called <b>faults</b> to indicate such results. For division by zero it is <i>?div</i>.</span></p>
<p class="p5"><span class="s1">Q'Nial has two ways of handling a fault:</span></p>
<ul class="ul1">
  <li class="li5"><span class="s2"></span><span class="s1">a trigger mechanism is executed that causes an interruption when a fault is created during execution of a defined operation, expression or transformer, or<br>
</span></li>
  <li class="li5"><span class="s2"></span><span class="s1">the fault is treated as a normal atomic array.<br>
</span></li>
</ul>
<p class="p5"><span class="s1">When Q'Nial is invoked, the fault triggering mecha nism is turned on by default. (This effect can be suppressed by using an option in the setup for each version). During execution, the state of the triggering mechanism can be turned on or off using the operation <i>settrigger</i>. The operation <i>quiet_fault</i>, defined in <i>defs.ndf</i>, can be used to create a fault without causing fault triggering. Fault triggering can be controlled using the following operations.</span></p>
<p class="p5"><span class="s1"><b>Operation Action</b></span></p>
<p class="p8"><span class="s1"><b><i>settrigger A</i></b></span></p>
<p class="p5"><span class="s1">Permit or prevent the interruption of computation by the fault triggering mechanism. If <i>A</i> is <i>true</i>, a fault triggers an interrupt.</span></p>
<p class="p8"><span class="s1"><b><i>quiet_fault A</i></b></span></p>
<p class="p5"><span class="s1">Return the result of <i>fault A</i> without causing fault triggering.</span></p>
<p class="p5"><span class="s1">If fault triggering is set and a fault is generated during execution of a defined operation, execution is interrupted. On an interruption caused by a fault, a display mes sage appears giving the call stack of definitions currently executing and the line of text that caused the fault. For example, the definition:</span></p>
<p class="p6"><span class="s1">foo is op A B { A / B + 1 }</span></p>
<p class="p5"><span class="s1">followed by the evaluation of the expression</span></p>
<p class="p6"><span class="s1">foo 3 0</span></p>
<p class="p5"><span class="s1">results in the output:</span></p>
<p class="p6"><span class="s1">------------------------------------------------------------</span></p>
<p class="p6"><span class="s1">Fault interruption loop: enter expressions or</span></p>
<p class="p6"><span class="s1">type: \&lt;Return\&gt; to jump to top level</span></p>
<p class="p6"><span class="s1">current call stack :</span></p>
<p class="p6"><span class="s1">foo</span></p>
<p class="p6"><span class="s1">?div triggered in : ... A / B</span></p>
<p class="p6"><span class="s1">------------------------------------------------------------</span></p>
<p class="p6"><span class="s1">&gt;&gt;&gt;</span></p>
<p class="p5"><span class="s1">where the string <i>?</i><b><i>&gt;&gt;&gt;</i></b><i>?</i> is a special prompt indicating that a fault has occurred and execution has been interrupted. The prompt permits you to query the value of variables in the expression and its surrounding computation or to view the operation that has triggered the fault. The above session might continue as:</span></p>
<p class="p6"><span class="s1">&gt;&gt;&gt; see ?foo</span></p>
<p class="p6"><span class="s1">foo IS OPERATION A B {A / B + 1 }</span></p>
<p class="p6"><span class="s1">&gt;&gt;&gt; A</span></p>
<p class="p6"><span class="s1">3</span></p>
<p class="p6"><span class="s1">&gt;&gt;&gt; B</span></p>
<p class="p6"><span class="s1">0</span></p>
<p class="p6"><span class="s1">&gt;&gt;&gt;</span></p>
<p class="p5"><span class="s1">A variable in a definition that called the current one can be referenced by preceding the variables name by the definition name and a colon, e.g.<i>G:X</i> denotes variable <i>X</i> in definition<i>G</i>. You can execute any expressions you want at the prompt. A useful thing to do is to <i>see</i> the definition that has interrupted. When you are ready to resume, reply to the prompt with a <i>Return</i> and control returns to the top level loop without an attempt to recover.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Workspace Management</b></span></h2>
<p class="p5"><span class="s1">To assist in the management of the workspace, Q'Nial has expressions and operations that are used in the following ways:</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Saving and Loading the Workspace</b></span></h2>
<p class="p5"><span class="s1">Q'Nial includes mechanisms to save the contents of the current workspace in an external file and to load a previously saved workspace as the current one. During program development, workspaces can be used to avoid reloading a large definition file at the beginning of each session. Also, a workspace can encode an application that is shared with other users without providing the source to them.</span></p>
<p class="p5"><span class="s1">The storage scheme used to store the workspace, designed to permit rapid saving and loading, is not portable between versions of Q'Nial on different systems or between revised versions on the same system. Hence, it is always wise to retain definition files in order to be able to reconstruct a workspace. A library program <i>wsdump.ndf</i> is available to convert the contents of a workspace into a definition file.</span></p>
<p class="p5"><span class="s1">When a <i>save</i> or <i>load</i> is executed, the current computation is ended and the <i>Checkpoint</i> or <i>Latent</i> expression is done in the interaction loop environment. If a workspace being saved contains an expression named <i>Checkpoint</i>, the expression is executed following the saving of the workspace and prior to restarting the interaction loop. It can be used to restart a computational process after an intermediate dump of the workspace.</span></p>
<p class="p5"><span class="s1">If a workspace being loaded contains an expression named <i>Latent</i>, the expression is executed following the load of the workspace and prior to restarting the interaction loop. <i>Latent</i> can be used to initiate a comput ational process or to set internal system variables prior to entering the interaction loop.</span></p>
<p class="p8"><span class="s1"><b><i>save Wsname</i></b></span></p>
<p class="p5"><span class="s1">Save the current workspace under the name <i>Wsname</i> with extension <i>.nws</i>.</span></p>
<p class="p8"><span class="s1"><b><i>load Wsname</i></b></span></p>
<p class="p5"><span class="s1">Load the workspace in the file named <i>Wsname</i> having exten sion <i>.nws</i>.</span></p>
<p class="p8"><span class="s1"><b><i>Checkpoint</i></b></span></p>
<p class="p5"><span class="s1">User defined expression executed after a <i>save</i>.</span></p>
<p class="p8"><span class="s1"><b><i>Latent</i></b></span></p>
<p class="p5"><span class="s1">User defined expression executed after a <i>load</i>.</span></p>
<p class="p5"><span class="s1">With <i>load</i> or <i>save</i>, the extension <i>.nws</i> may be omitted in the filename. The filename can be specified as a phrase or a string. If the file naming convention on the host computer is sensitive to upper and lower case, care must be taken to spell the filename correctly.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Loading a Definition File</b></span></h2>
<p class="p5"><span class="s1">A definition file is a text file containing Q'Nial actions. It is viewed as a sequence of actions supplied to the system when the file is loaded. A definition file has the extension <i>.ndf</i> to distinguish it from other text files. The major purpose of definition files is to collect definitions of expressions, operations and transformers that form a module of code in an application. They may also provide a script of inputs for computations done without user interaction.</span></p>
<p class="p8"><span class="s1"><b><i>loaddefs Fn Switch</i></b></span></p>
<p class="p5"><span class="s1">Read and execute the actions in definition file <i>Fn</i>. If <i>Switch</i> is <i>o</i> or is omitted, do not display the definitions; if <i>Switch</i> is <i>l</i>, display them.</span></p>
<p class="p8"><span class="s1"><b><i>library Fn Switch</i></b></span></p>
<p class="p5"><span class="s1">Read and execute the actions in definition file <i>Fn</i> from directory <i>niallib</i>. If <i>Switch</i> is <i>o</i> or is omitted, do not display the definitions; if <i>Switch</i> is <i>l</i>, display them.</span></p>
<p class="p5"><span class="s1">In <i>loaddefs, Fn</i> may be any path that leads to a file with a <i>.ndf</i> extension. The assumption is that the path starts from the current directory unless a complete path is given. In <i>library, Fn</i> can be any path that starts in the <i>niallib</i> directory. <i>Fn</i> can be specified as a phrase or a string. With <i>loaddefs</i> or <i>library</i>, the extension <i>.ndf</i> may be omitted in the filename.</span></p>
<p class="p5"><span class="s1">The operation <i>library</i> uses the environment variable <i>nialroot</i> to find the directory that holds the subdirectory <i>niallib</i>and the other default libraries. The predefined variable <i>Libpath</i> can be set under program control to indicate other directories to be searched. The operation <i>library</i> is defined in the file <i>defs.ndf</i> and can be modified to provide an alternative library strategy.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Setting Workspace Switches</b></span></h2>
<p class="p5"><span class="s1">Q'Nial has a number of optional behaviours that depend on the value of internal switches. These are set by the mode setting operation <i>set</i>.</span></p>
<p class="p8"><span class="s1"><b><i>set Switch</i></b></span></p>
<p class="p5"><span class="s1">Set an internal switch that controls how execution is displayed, controls tracing, or controls the output to log files. Return the previous setting. The settings are <i>sketch, diagram, decor, nodecor, trace, notrace, log</i>and<i>nolog</i>.</span></p>
<p class="p5"><span class="s1">The switch setting can be specified as a phrase or a string in upper or lower case.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Workspace Status</b></span></h2>
<p class="p5"><span class="s1">The expression <i>Status</i> provides information about the workspace. Its results are explained as follows:</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1"><b>Position Value</b></span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1"><b>Value Given</b></span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1"><b>Meaning</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">0</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">number of free words</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">amount of space available in workspace</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">1</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">largest free block size</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">determines largest object that can be built</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">2</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">number of free blocks</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">indicates the fragmentation of memory</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">3</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">workspace size</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">gives the current size of the workspace</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">4</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">size of internal stack</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">used to hold intermediate values in evaluation</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">5</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">size of phrase/fault table</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">area used for hash table for phrases and faults</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td41">
        <p class="p8"><span class="s1">6</span></p>
      </td>
      <td valign="middle" class="td42">
        <p class="p8"><span class="s1">internal buffer size</span></p>
      </td>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">used for temporary space by many operations</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The last three items indicate the size of three internal areas that grow if required, but never shrink in size. After some large computations these components may be larger than needed. They are reset if the workspace saved and reloaded.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Symbol Table</b></span></h2>
<p class="p5"><span class="s1">Q'Nial maintains an internal <b>symbol table</b> holding the name and role of every object in the workspace. The following operations provide access to the symbol table information:</span></p>
<p class="p8"><span class="s1"><b><i>symbols Sw</i></b></span></p>
<p class="p5"><span class="s1">If <i>Sw</i> is <i>o</i>, return a list of pairs of names and roles of all user-defined objects in the global environment. If<i>Sw</i> is <i>l</i>, also include the names and roles of predefined objects.</span></p>
<p class="p8"><span class="s1"><b><i>erase A</i></b></span></p>
<p class="p5"><span class="s1">Erase the variable or definition specified by the phrase <i>A</i>.<br>
Leave the phrase <i>A</i> in the symbol table with its role unchanged but change its value to one of <i>?no_value, No_expr, no_op</i> or <i>NO_TR</i> depending on the role of <i>A</i>. This operation is used at top level to remove a user defined object from the current workspace. It permits the use of the identifier for a different purpose but not a differ ent role. It cannot be used to erase a name in a local scope.</span></p>
<p class="p8"><span class="s1"><b><i>Vars</i></b></span></p>
<p class="p5"><span class="s1">The list of global variables in the workspace.</span></p>
<p class="p8"><span class="s1"><b><i>Exprs</i></b></span></p>
<p class="p5"><span class="s1">The list of user-defined expressions in the workspace.</span></p>
<p class="p8"><span class="s1"><b><i>Ops</i></b></span></p>
<p class="p5"><span class="s1">The list of user-defined operations in the workspace.</span></p>
<p class="p8"><span class="s1"><b><i>Trs</i></b></span></p>
<p class="p5"><span class="s1">The list of user-defined transformers in the workspace.</span></p>
<p class="p5"><span class="s1">The operation <i>symbols</i> returns a list of the items in the table. The operation <i>erase</i> removes the definition or variable from the workspace although the name remains in the symbol table with the same role. The expressions <i>Vars</i>, <i>Exprs</i>, <i>Ops</i> and <i>Trs</i> return the names of user-defined objects in each of these roles.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Logging the Work of the Session</b></span></h2>
<p class="p5"><span class="s1">Q'Nial has a number of switches that can be set to permit logging the work of the session. The log file can also be renamed. The log file is opened and closed for each line that is written in order to ensure that it is retained if a session is terminated by an external process.</span></p>
<p class="p8"><span class="s1"><b><i>set Logsw</i></b></span></p>
<p class="p5"><span class="s1">Set a switch that controls how logging is to be handled. Return the previous setting. The switch setting can be a phrase or a string in upper or lower case. The possible settings are <i>log, nolog</i> and <i>nolog</i>.</span></p>
<p class="p8"><span class="s1"><b><i>setlogname Fn</i></b></span></p>
<p class="p5"><span class="s1">Set the name of the file used to log screen output to <i>Fn</i>, which can be a string or a phrase. The name is case sensitive if the host file system names are case sensitive.</span></p>
<p class="p5"><span class="s1">The information displayed on the screen during a Q'Nial session is recorded in a log file if logging is activated by the <i>set "log</i> action. The screen displays that occur during the host interface operations are not saved in the log file. The log file can be edited to make a working program from the series of trials made while working interactively. The default log file name is <i>auto.nlg</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Time Related Expressions</b></span></h2>
<p class="p5"><span class="s1">Q'Nial provides two expressions which access the internal clock of the computer.</span></p>
<p class="p8"><span class="s1"><b><i>Time</i></b></span></p>
<p class="p5"><span class="s1">System dependent timing information. On Unix, it is the processor time used for the user and system tasks for the process since the beginning of the session measured in seconds.</span></p>
<p class="p8"><span class="s1"><b><i>Timestamp</i></b></span></p>
<p class="p5"><span class="s1">The current date and time in the form of a string.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Display Related Settings</b></span></h2>
<p class="p5"><span class="s1">Q'Nial has a few settings that affect the way in which information is displayed on the screen.</span></p>
<p class="p8"><span class="s1"><b><i>setprompt A</i></b></span></p>
<p class="p5"><span class="s1">Set the Q'Nial prompt to <i>A</i>, where <i>A</i> is a string or a phrase. The maxi mum length prompt is 40 characters.</span></p>
<p class="p8"><span class="s1"><b><i>setwidth N</i></b></span></p>
<p class="p5"><span class="s1">Set the width of output displayed on the screen and sent to the log to <i>N</i> characters. The result is the previous screen width setting. Setting the output width to 0 allows the output to be of arbitrary length. Used by default in CGI-Nial.</span></p>
<p class="p8"><span class="s1"><b><i>setformat Str</i></b></span></p>
<p class="p5"><span class="s1"><i>Str</i> is a format specification for real numbers using the conventions for the <i>C</i> library routine <i>printf</i>. The result is the previous format setting.</span></p>
<p class="p8"><span class="s1"><b><i>setscroll Mode</i></b></span></p>
<p class="p5"><span class="s1">Set the scroll setting for window mode to <i>Mode</i>. (Console versions only)</span></p>
<p class="p8"><span class="s1"><b><i>Screensize</i></b></span></p>
<p class="p5"><span class="s1">Returns the height and width of the actual screen or window in use.</span></p>
<p class="p5"><span class="s1">The default prompt displayed by Q'Nial in the interaction loop is a string of five blank characters. If a more visible prompt is preferred, <i>setprompt</i> can be used to change it.</span></p>
<p class="p5"><span class="s1">Array pictures are written to the screen and to log files so that they fold as a unit; that is, if the array picture is too wide, all of its lines are displayed in the available space and then after a blank line the remain ing portion of the picture is displayed. The width of the display field defaults to the screen size but can be increased or decreased using <i>setwidth</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Real Number Formatting</b></span></h2>
<p class="p5"><span class="s1">The three styles of real number formats that can be set using <i>setformat</i> are given below:</span></p>
<p class="p8"><span class="s1"><b><i>'%f'</i></b></span></p>
<p class="p5"><span class="s1">displays a fixed number of places after the decimal point in a fixed size space with no scaling of the number,</span></p>
<p class="p8"><span class="s1"><b><i>'%e'</i></b></span></p>
<p class="p5"><span class="s1">displays the number in scientific notation with an exponent scaling the number to have one digit before the decimal point, and</span></p>
<p class="p8"><span class="s1"><b><i>'%g'</i></b></span></p>
<p class="p5"><span class="s1">displays the number in <i>f</i> format if possible but defaults to <i>e</i> format if the number is not within a suitable range.</span></p>
<p class="p5"><span class="s1">Finer detail format specification is achieved by placing two numbers separated by a period between the '%' and the letter. For example '%15.5f ' uses a field of width 15 to display a number in <i>f</i> format with 5 decimal places. In general, the first digit refers to the width of the field. For <i>f</i> format the second digit gives the number of places after the decimal, while for <i>e</i> and <i>g</i> it indicates the number of significant digits to be displayed. Either digit can be left out</span></p>
<p class="p5"><span class="s1">Because a real number display needs to be distinguishable from an integer, there are some cases where the field is one space wider than predicted by the format string in order to accommodate the decimal point added to the end. Also, if an <i>f</i> format is not wide enough for the number, it is widened so that the number is displayed.</span></p>
<p class="p5"><span class="s1">The format string <i>'%.17g'</i> is used by the operation <i>display</i> in depicting real numbers. This format accurately reproduces the same number when executed on most platforms.</span></p>
<p class="p5"><span class="s1">The default format is <i>'%g'</i>, which displays the number in a compact format displaying 5 significant digits. For numbers in the range 1e-5 &lt; x &lt; 1e6, it omits the exponent, for larger or smaller numbers the exponent is included. In both cases trailing zeros are removed.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>System Related Expressions</b></span></h2>
<p class="p5"><span class="s1">There are four expressions which hold information about Q'Nial:</span></p>
<p class="p8"><span class="s1"><b><i>Copyright</i></b></span></p>
<p class="p5"><span class="s1">The copyright message.</span></p>
<p class="p8"><span class="s1"><b><i>Version</i></b></span></p>
<p class="p5"><span class="s1">The release and version of Q'Nial being used.</span></p>
<p class="p8"><span class="s1"><b><i>System</i></b></span></p>
<p class="p5"><span class="s1">The operating system in use.</span></p>
<p class="p8"><span class="s1"><b><i>Nialroot</i></b></span></p>
<p class="p5"><span class="s1">A string showing the path to the <i>nialroot</i> directory.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Host Interface Operations</b></span></h2>
<p class="p5"><span class="s1">Q'Nial provides access to the operating system and to an editor of choice.</span></p>
<p class="p8"><span class="s1"><b><i>host Cmd</i></b></span></p>
<p class="p5"><span class="s1">Pass string or phrase <i>Cmd</i> to the host command processor for execution. The details of the use of <i>host</i> are specific to the operating system of the com puter being used. At the top level loop, an input line beginning with ! is treated as a host command. For most versions of Q?Nial, the host command causes Q'Nialto block until the command is completed.</span></p>
<p class="p8"><span class="s1"><b><i>edit Filename</i></b></span></p>
<p class="p5"><span class="s1">Edit the text file named by the phrase or string <i>Filename</i> using the host default editor. Definition files can be prepared and modified from within Q'Nial so that sessions of Q'Nial are not interrupted to handle editing.</span></p>
<p class="p8"><span class="s1"><b><i>defedit Def</i></b></span></p>
<p class="p5"><span class="s1">Place the definition named by phrase or string <i>Def</i> in a window in canonical form and invoke <i>editwindow</i> with the lines of the definition as strings in the window. After editing, execute the strings to load the definition. This is only available in the console versions of Q?Nial.</span></p>
<p class="p5"><span class="s1">The operation <i>host</i> is platform dependent. Its argument is a command line that is executed by the command processor for the host system. If the command processor supports output redirection for the command in use then the results of host command can be sent to a file and obtained with <i>getfile</i>. An alternative is to use the pipe read mode of the operation <i>open</i> to have the lines of output of the result available using <i>readfile</i>. The library operation <i>newhost</i>implements a version of <i>host</i>that uses pipes.</span></p>
<p class="p5"><span class="s1">The operation <i>edit</i> is used to access a standard text editor on the host system in console versions of Q'Nial. The editor to be used is determined by the environment variable <i>EDITOR</i> which the user can set in the operating system environment. If the variable is not set a default editor is chosen.</span></p>
<p class="p5"><span class="s1"><i>Defedit</i> is convenient for quick modification of an operation. Its definition is in file <i>defs.ndf</i>. It can be modified to suit individual tastes.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Session and Workspace Variables</b></span></h2>
<p class="p5"><span class="s1">During execution of Q'Nial, a number of global variables within the interpreter determine how the environment behaves. These are classified as session or workspace variables depending on whether or not they are saved with the workspace and cause the environment to change when a workspace is loaded. The two tables below contain some internal variables that are only used with console versions.</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1"><b>Session Variable</b></span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1"><b>Default Setting</b></span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1"><b>Setting Operation</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">log file setting</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">nolog</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">set ?log; set ?nolog</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">log file name</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">auto.nlg</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">setlogname Fnm</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">screen display width</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">80</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">setwidth N</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">trace setting</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">notrace</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">set ?trace; set ?notrace</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">interrupts enabled</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">true</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">setinterrupts M</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">fault triggering</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">on</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">settrigger M</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">messages</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">on</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">setmessages M</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">prompt string</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">5 blanks</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">setprompt Str</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">workspace size</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">200,000 words</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">command line option</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">stack size</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">3,000</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">N/A</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">phrase/fault table size</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">4,000</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">N/A</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td43">
        <p class="p8"><span class="s1">Internal buffer</span></p>
      </td>
      <td valign="middle" class="td44">
        <p class="p8"><span class="s1">1,000</span></p>
      </td>
      <td valign="middle" class="td45">
        <p class="p8"><span class="s1">N/A</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The following table describes the workspace variables.</span></p>
<table cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td46">
        <p class="p8"><span class="s1"><b>Workspace Variable</b></span></p>
      </td>
      <td valign="middle" class="td47">
        <p class="p8"><span class="s1"><b>Default Setting</b></span></p>
      </td>
      <td valign="middle" class="td48">
        <p class="p8"><span class="s1"><b>Setting Operation</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td46">
        <p class="p8"><span class="s1">sketch/diagram switch</span></p>
      </td>
      <td valign="middle" class="td47">
        <p class="p8"><span class="s1">sketch</span></p>
      </td>
      <td valign="middle" class="td48">
        <p class="p8"><span class="s1">set ?sketch; set ?diagram</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td46">
        <p class="p8"><span class="s1">decor/nodecor switch</span></p>
      </td>
      <td valign="middle" class="td47">
        <p class="p8"><span class="s1">nodecor</span></p>
      </td>
      <td valign="middle" class="td48">
        <p class="p8"><span class="s1">set ?decor; set ?nodecor</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td46">
        <p class="p8"><span class="s1">real format</span></p>
      </td>
      <td valign="middle" class="td47">
        <p class="p8"><span class="s1">'%g'</span></p>
      </td>
      <td valign="middle" class="td48">
        <p class="p8"><span class="s1">setformat Str</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td46">
        <p class="p8"><span class="s1">definition trace</span></p>
      </td>
      <td valign="middle" class="td47">
        <p class="p8"><span class="s1"><i>o</i> for all definitions setdeftrace Defnm [M]</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p5"><span class="s1">The sizes of the workspace, the stack and the phrase and fault table are automatically increased as required during the session while space is available. Some of the session variables can be set using start up options that differ from version to version.</span></p>
<p class="p5"><span class="s1">One approach to setting the programmable settings is to initialize them as desired in a <i>Latent</i> expression in a workspace that is loaded when a Q'Nial session is started. They session variables will then be set as Q'Nial is initialized or when the <i>Restart</i> expression is executed.</span></p>
<p class="p5"><span class="s1">Workspace variables are internal settings that are preserved with the workspace. The above figure describes them. For example, if a workspace is saved with <i>diagram</i> and <i>nodecor</i> modes set, the reloaded workspace will retain those settings. However, if the <i>log</i> setting is in effect when the workspace is saved, nothing is recorded in the saved workspace to restore that setting on a reload of the workspace.</span></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Chapter 9 Debugging and Profiling Nial Definitions</b></span></h1>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Debugging Definitions</b></span></h2>
<p class="p5"><span class="s1">The Q'Nialsystem provides an optional debugging facility that aids interactive debugging. It is active by default, but can be turned off for running production applications. See the detailed documentation for the various versions on how to turn off debugging.</span></p>
<p class="p5"><span class="s1">The debugging system is based on the idea of placing breaks in the code and stepping through the program code in a number of different ways. Due to constraints in the way Q'Nial is implemented, debugging is always done in the context of an expression sequence. A break point occurs either before the execution of the expression sequence in a definition, or at an explicit break expression within an expression sequence. There is also a watch mechanism that executes a defined action whenever the value of a variable changes, and an ability to monitor all uses of user defined objects and of the predefined operations.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Defining a Break Point</b></span></h2>
<p class="p5"><span class="s1">There are two ways to cause a break in a Nial definition: by using the expression <i>Break</i>in an expression sequence, or by using the operation <i>breakin</i> to set a break on entry to an operation or expression.</span></p>
<p class="p8"><span class="s1"><b><i>Break</i></b></span></p>
<p class="p5"><span class="s1">Suspend evaluation of the expression and pass control to an evaluation loop in the environment at the point of the Break. Variables accessible at that point can be displayed. This loop recognizes a number of commands described below.</span></p>
<p class="p8"><span class="s1"><b><i>breakin Nm [M]</i></b></span></p>
<p class="p5"><span class="s1">Set or reset an internal break flag for the definiton of <i>Nm</i>. If the boolean value <i>M</i> is omitted, the flag is toggled. If set, a break occurs before the execution of the expression sequence of the definition. The Nm must be the name of a defined expression or a defined operation using the operation form style of operation expression.</span></p>
<p class="p8"><span class="s1"><b><i>Breaklist</i></b></span></p>
<p class="p5"><span class="s1">Display the list of names of definitions with break flag set.</span></p>
<p class="p5"><span class="s1">For console versions supporting the alphanumeric windows package, break mode can also be entered when Q'Nial is awaiting keyboard entry in window mode (except in <i>editwindow</i>) by typing &lt;Ctrl b&gt;. When normal operation is resumed, the previous screen is displayed and the input request is still pending.</span></p>
<p class="p5"><span class="s1">When initially entering the "debug mode" because of a break caused by any of the above methods, a short banner is printed that indicates that the debug evaluation loop has been entered and it is followed by the expression to be executed and a prompt with a default debugging command.</span></p>
<p class="p6"><span class="s1">-------------------------------------------------------------</span></p>
<p class="p6"><span class="s1">Break debug loop: enter debug commands, expressions or</span></p>
<p class="p6"><span class="s1">type: resume to exit debug loop</span></p>
<p class="p6"><span class="s1">&lt;Return&gt; executes the indicated debug command</span></p>
<p class="p6"><span class="s1">current call stack :</span></p>
<p class="p6"><span class="s1">foo</span></p>
<p class="p6"><span class="s1">-------------------------------------------------------------</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">?.. C := A + ( + A + A )</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s1">--&gt;[stepv]</span></p>
<p class="p5"><span class="s1">Whenever you initially enter <i>debug mode</i>, the current callstack is printed to indicate where the break occurred. The debugging banner also reminds you that you can resume execution by typing resume and that hitting return will cause the debug action, indicated in square brackets at the prompt, to occur. The debugging action defaults to <i>stepv</i> but changes to the last debug command used if you execute another one.</span></p>
<p class="p5"><span class="s1">At the debug prompt, the user can explore the values of variables by entering the variables name, can evaluate any Nial expression, say to display the definition with <i>see</i> or to get the <i>shape</i> of a variable, or can execute one of the debug commands described below that moves the computation forward.</span></p>
<p class="p5"><span class="s1">A breakpoint set by the operation <i>breakin</i> sets an internal breakpoint flag. If the user reloads the definition (maybe as part of a <i>loaddefs</i>), then a breakpoint flag remains set if it was set. The breakpoint flag is also preserved if the workspace is saved and then subsequently loaded. Using <i>breakin</i> again or <i>erase</i> on the definition name clears the internal breakpoint flag. To clear all internal breakpoint flags execute</span></p>
<p class="p5"><span class="s1"><i>EACH breakin Breaklist</i></span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Access to Intermediate Scopes</b></span></h2>
<p class="p5"><span class="s1">Nial has lexical scoping, that is a name is only directly visible in a definition if it is defined in the definition or in a surrounding one. For debugging, we often wish to look at the value of a variable in an operation that called the operation we are currently in. The scoped variable reference, one of the forms of a primary expression, is used to observe the value of local variables in named expressions that are blocks and in named operations that are operation forms. The use of a scoped variable reference produces the value of the variable for the most recent use of the definition in the call stack. The syntax is</span></p>
<p class="p5"><span class="s1"><i>funname:varname</i></span></p>
<p class="p5"><span class="s1">This is general syntax that can be used under program control anywhere a variable reference is made, but can only be used to reference a variable, not to change it.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Debugging Commands</b></span></h2>
<p class="p5"><span class="s1">The debugging commands permit resumption of execution in several forms, with or without the display of data computed during execution. The</span></p>
<p class="p8"><span class="s1"><b><i>step(v) [N]</i></b></span></p>
<p class="p5"><span class="s1"><i>step</i> executes the next executable expression (displayed after<i>?..</i>) in either the current definition or in a definition called within the current expression. It <i>steps into</i> definitions called within<br>
an expression. If <i>stepv</i> is used, the value of the executed expression is displayed. If N is provided (N&gt;=1) then the command is executed N<br>
times before the user is prompted again.</span></p>
<p class="p8"><span class="s1"><b><i>next(v) [N]</i></b></span></p>
<p class="p5"><span class="s1"><i>next</i> is similar to <i>step</i> except that it does not go into definition calls, but rather, executes a definition within a the current expression quietly. It is used to trace the statements within one definition, without showing the detailed execution of definitions that are called by the current expression. If <i>nextv</i> is used, the value of the executed expression is displayed. If N is provided then the command is executed N times before the user is prompted again.</span></p>
<p class="p8"><span class="s1"><b><i>stepin [N]</i></b></span></p>
<p class="p5"><span class="s1"><i>stepin</i> is the same as <i>step</i> except that it traces the evaluation of the next expression to be executed. It is useful for seeing the details of how an expression is computing its value.</span></p>
<p class="p8"><span class="s1"><b><i>toend(v)</i></b></span></p>
<p class="p5"><span class="s1"><i>toend</i> executes to the end of a loop or of a definition. It is useful if you want to skip all of the remaining expressions within a loop or an expression sequence in a definition and stop on the first expression after the loop or definition call.</span></p>
<p class="p8"><span class="s1"><b><i>resume</i></b></span></p>
<p class="p5"><span class="s1"><i>resume</i> continues program execution until either another <i>break</i> or <i>fault</i> is encountered, or until the expression being executed completes.</span></p>
<p class="p5"><span class="s1">The debugging facilities can be used in a number of different ways. For example, you can step forward from a breakpoint using <i>nextv</i>, <i>stepv</i>, or <i>stepin</i>, depending on the details you wish to observe. If a <i>breakin</i> is used to break in a definition then you may want to use next to move quickly to the area where the problem is. Alternatively, you can edit the definition and insert a <i>Break</i> expression at the point of concern and reload the definition. Then execution will be interrupted at that point and you can enter variable references to observe the value of variables that affect the computation, or try out parts of the next expression to be executed to see why it is not working as expected.</span></p>
<p class="p5"><span class="s1">Another way to get debugging started at a convenient place is to place a watch on a variable with its corresponding action being a break. See the section below on the Watch Mechanism.</span></p>
<p class="p5"><span class="s1">The debugging commands <i>step</i> and <i>next</i> have special behaviour for the control structure expressions such as if-then-else and while-do expressions. When the next expression is a control structure expression only two lines of it are displayed. If <i>next</i> or <i>step</i> are given as the command, then the next expression becomes one of the components in the control structure expression. For example, in an if-expression, the next expression becomes the boolean expression following <i>IF</i>. Nothing is executed, just the focus of debugging has moved into the control construct. If the value versions of the command are used, then on the execution of the last expression in the control construct, both the value for the last expression and the value for the entire control construct are displayed.</span></p>
<p class="p5"><span class="s1">The <i>toend</i> command serves a dual purpose: it is used to terminate a loop, or to terminate a definition. If execution is in a loop and <i>toend</i> is given as the command, then all the remaining iterations of the loop are executed and execution stops after completion of the loop. If the current loop is nested within another, only the inner loop is executed to completion.</span></p>
<p class="p5"><span class="s1">If the <i>toend</i> command is given at the debug prompt and the current expression is not within a loop, then the execution continues to the end of the definition. If the definition had been called during the execution of an expression by using <i>step</i> or <i>stepv</i> then the execution will stop on the expression following the definition. If the break that started debug mode was in the definition, then <i>toend</i> behaves like <i>resume</i>.</span></p>
<p class="p5"><span class="s1">In the rare case where there is a conflict between a variable name and a debugging command you can precede an expression given in the debugging loop with a backslash (\) to indicate that it is an expression to be evaluated.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Repeating Debug Commands</b></span></h2>
<p class="p5"><span class="s1">All versions of the debug commands also allow the addition of an integer argument. This argument is interpreted as the number of times to execute the given debug command, before returning to the debug prompt. For example, using the debug command <i>nextv 10</i> will show all the results of <i>nextv</i> as if the command was issued ten times. After ten executions, the debug prompt is printed</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Monitoring Execution Flow</b></span></h2>
<p class="p5"><span class="s1">In trying to understand the behaviour of a program it is sometimes necessary to trace the flow of execution to see how the flow has gone. The operations described in the next table assist in this endeavour.</span></p>
<p class="p5"><span class="s1">Debugging is an art. There is no best way to use the debugging facilities to solve a problem. For complex situations where the problem involves deeply nested definition calls, it may be convenient to issue <i>Callstack</i> to find out what definition is executing, and at what level of nesting it is at. Also using <i>see</i> on the current definition helps to see the context in which the debugging is occurring.</span></p>
<p class="p8"><span class="s1"><b><i>Callstack</i></b></span></p>
<p class="p5"><span class="s1">Display the sequence of active definitions at the point of the break.</span></p>
<p class="p8"><span class="s1"><b><i>seeusercalls M</i></b></span></p>
<p class="p5"><span class="s1">Set the flag that controls display of entry to and exit from user definitions to boolean value M. If M is True then display the call information.</span></p>
<p class="p8"><span class="s1"><b><i>seeprimcalls M</i></b></span></p>
<p class="p5"><span class="s1">Set the flag that controls display of the execution of primitive functions to boolean value M. If M is True then display the call information.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Watch Mechanism</b></span></h2>
<p class="p5"><span class="s1">The debugging system also includes an ability to place a <i>watch</i> on a global or local variable. The capabilities are:</span></p>
<p class="p8"><span class="s1"><b><i>watch Var Expr</i></b></span></p>
<p class="p5"><span class="s1">Set a watch on the variable given by cast <i>Var</i> if <i>Expr</i> is a non-empty string. If <i>Expr</i> is empty, remove the watch from the variable.</span></p>
<p class="p8"><span class="s1"><b><i>Watchlist</i></b></span></p>
<p class="p5"><span class="s1">Return the list of watch variables and expressions that are currently set.</span></p>
<p class="p5"><span class="s1">The approach is to associate an expression to be executed when the value of the variable changes. The expression can display the value that has been assigned, or execute a <i>Break</i> expression to interrupt the computation. The variable is referenced by a <i>cast</i>, for a global variable <i>X</i>, the cast is<i>!X</i>, for a local variable <i>Y</i> in definition <i>G</i>, the cast is <i>!G:Y</i>. The action to be performed is given as a string of program text that denotes an expression.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Trace Mechanism</b></span></h2>
<p class="p5"><span class="s1">The trace facility has two capabilities: to trace the execution of expressions at the top level and to trace the evaluation of the application of a defined opera tion.</span></p>
<p class="p8"><span class="s1"><b><i>set Tracemode</i></b></span></p>
<p class="p5"><span class="s1">The action <i>set "trace</i> causes the execution of expressions at the top level to be traced. It presents the result of the application of a defined operation but does not trace the evaluation of the defined operation. Trace mode is turned off by the action <i>set "notrace</i>.</span></p>
<p class="p8"><span class="s1"><b><i>setdeftrace Def [Sw]</i></b></span></p>
<p class="p5"><span class="s1">Change the trace mode setting for definition <i>Def</i>. If <i>Sw</i> is <i>true</i>, turn on tracing; if it is <i>false</i>, turn it off. If <i>Sw</i> is omitted, reverse the setting.</span></p>
<p class="p5"><span class="s1">The trace mechanism provides a lot of output for the evaluation of an expression. The intermediate expressions within the expression being traced are displayed and their values printed. This is appropriate for small values, but becomes unwieldy for large data objects. Thus, debugging with tracing is best done with small arrays. The output produced by tracing is captured by the log facility and hence it possible to study the details of the execution <i>after the fact</i>.</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; line-height: 22.0px; font: 18.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Profiling Capability</b></span></h2>
<p class="p5"><span class="s1">Q'Nial has a profiling capability that can be used to gather relative execution times for defined operations, transformers and expressions. The data on execution times is collected relative to the tree of function calls, so that both the total time a routine is used and the time it is used from a specific other routine can be computed. The profiling capability makes it easier to find inefficiencies in Nial programs. The following summarizes the capabilities.</span></p>
<p class="p8"><span class="s1"><b><i>setprofile M</i></b></span></p>
<p class="p5"><span class="s1">sets the internal flag that turns on or off the collection of data on execution time to <i>M</i>. If <i>M</i> is True the data is gathered.</span></p>
<p class="p8"><span class="s1"><b><i>profile Fnm</i></b></span></p>
<p class="p5"><span class="s1">displays the profile data to the screen if <i>Fnm</i> is the empty string or writes it to the file named by <i>Fnm</i>.</span></p>
<p class="p8"><span class="s1"><b><i>Clearprofile</i></b></span></p>
<p class="p5"><span class="s1">clears the current profile information and reinitializes the profiling system.</span></p>
<p class="p8"><span class="s1"><b><i>profiletable</i></b></span></p>
<p class="p5"><span class="s1">provides the profile information as a table</span></p>
<p class="p8"><span class="s1"><b><i>profiletree</i></b></span></p>
<p class="p5"><span class="s1">provides detailed profile information in terms of the tree of calls.</span></p>
<p class="p5"><span class="s1">The profiling capabilities are described in more detail in the <i>Nial Dictionary</i>.</span></p>
</body>
</html>
